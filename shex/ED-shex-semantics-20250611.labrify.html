<!DOCTYPE html>
<html lang="en"><head><style>
.issue-label {
  text-transform: initial;
}

.warning > p:first-child {
  margin-top: 0;
}
.warning {
  padding: 0.5em;
  border-left-width: 0.5em;
  border-left-style: solid;
}
span.warning {
  padding: 0.1em 0.5em 0.15em;
}

.issue.closed span.issue-number {
  text-decoration: line-through;
}

.issue.closed span.issue-number::after {
  content: " (Closed)";
  font-size: smaller;
}

.warning {
  border-color: #f11;
  border-width: 0.2em;
  border-style: solid;
  background: #fbe9e9;
}

.warning-title:before {
  content: "⚠"; /*U+26A0 WARNING SIGN*/
  font-size: 1.3em;
  float: left;
  padding-right: 0.3em;
  margin-top: -0.3em;
}

li.task-list-item {
  list-style: none;
}

input.task-list-item-checkbox {
  margin: 0 0.35em 0.25em -1.6em;
  vertical-align: middle;
}

.issue a.respec-gh-label {
  padding: 5px;
  margin: 0 2px 0 2px;
  font-size: 10px;
  text-transform: none;
  text-decoration: none;
  font-weight: bold;
  border-radius: 4px;
  position: relative;
  bottom: 2px;
  border: none;
  display: inline-block;
}
</style><style>
dfn {
  cursor: pointer;
}

.dfn-panel {
  position: absolute;
  z-index: 35;
  min-width: 300px;
  max-width: 500px;
  padding: 0.5em 0.75em;
  margin-top: 0.6em;
  font-family: "Helvetica Neue", sans-serif;
  font-size: small;
  background: #fff;
  color: black;
  box-shadow: 0 1em 3em -0.4em rgba(0, 0, 0, 0.3),
    0 0 1px 1px rgba(0, 0, 0, 0.05);
  border-radius: 2px;
}
/* Triangle/caret */
.dfn-panel:not(.docked) > .caret {
  position: absolute;
  top: -9px;
}
.dfn-panel:not(.docked) > .caret::before,
.dfn-panel:not(.docked) > .caret::after {
  content: "";
  position: absolute;
  border: 10px solid transparent;
  border-top: 0;
  border-bottom: 10px solid #fff;
  top: 0;
}
.dfn-panel:not(.docked) > .caret::before {
  border-bottom: 9px solid #a2a9b1;
}

.dfn-panel * {
  margin: 0;
}

.dfn-panel b {
  display: block;
  color: #000;
  margin-top: 0.25em;
}

.dfn-panel ul a[href] {
  color: #333;
}

.dfn-panel > div {
  display: flex;
}

.dfn-panel a.self-link {
  font-weight: bold;
  margin-right: auto;
}

.dfn-panel .marker {
  padding: 0.1em;
  margin-left: 0.5em;
  border-radius: 0.2em;
  text-align: center;
  white-space: nowrap;
  font-size: 90%;
  color: #040b1c;
}

.dfn-panel .marker.dfn-exported {
  background: #d1edfd;
  box-shadow: 0 0 0 0.125em #1ca5f940;
}
.dfn-panel .marker.idl-block {
  background: #8ccbf2;
  box-shadow: 0 0 0 0.125em #0670b161;
}

.dfn-panel a:not(:hover) {
  text-decoration: none !important;
  border-bottom: none !important;
}

.dfn-panel a[href]:hover {
  border-bottom-width: 1px;
}

.dfn-panel ul {
  padding: 0;
}

.dfn-panel li {
  margin-left: 1em;
}

.dfn-panel.docked {
  position: fixed;
  left: 0.5em;
  top: unset;
  bottom: 2em;
  margin: 0 auto;
  /* 0.75em from padding (x2), 0.5em from left position, 0.2em border (x2) */
  max-width: calc(100vw - 0.75em * 2 - 0.5em - 0.2em * 2);
  max-height: 30vh;
  overflow: auto;
}
</style>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Shape Expressions Language 2.next</title>
    <!-- link rel="stylesheet" href="css/wgio.min.css"/ ask Iovka -->
    <link rel="stylesheet" href="local.css">
    <style>
/* overloads for IEEE */
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link {
    display: none !important;
}

h1, h2, h3 {
    color: #000 !important;
}
    </style>

    <!-- <script src='respec-ieee.js' defer class='remove'></script> -->
    
    <!-- <script src='../primer/respec-w3c-common.js' async class='remove'></script> -->
    <script src="jquery-2.1.4.min.js" type="text/javascript"></script>

    

    <script src="./shex-parser-browserify.js"></script>
    <script type="text/javascript" src="scripts.js"></script>
  <style id="respec-mainstyle">
@keyframes pop {
  0% {
    transform: scale(1, 1);
  }
  25% {
    transform: scale(1.25, 1.25);
    opacity: 0.75;
  }
  100% {
    transform: scale(1, 1);
  }
}

/* --- INLINES --- */
:is(h1, h2, h3, h4, h5, h6, a) abbr {
  border: none;
}

dfn {
  font-weight: bold;
}

a.internalDFN {
  color: inherit;
  border-bottom: 1px solid #99c;
  text-decoration: none;
}

a.externalDFN {
  color: inherit;
  border-bottom: 1px dotted #ccc;
  text-decoration: none;
}

a.bibref {
  text-decoration: none;
}

.respec-offending-element:target {
  animation: pop 0.25s ease-in-out 0s 1;
}

.respec-offending-element,
a[href].respec-offending-element {
  text-decoration: red wavy underline;
}
@supports not (text-decoration: red wavy underline) {
  .respec-offending-element:not(pre) {
    display: inline-block;
  }
  .respec-offending-element {
    /* Red squiggly line */
    background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=)
      bottom repeat-x;
  }
}

#references :target {
  background: #eaf3ff;
  animation: pop 0.4s ease-in-out 0s 1;
}

cite .bibref {
  font-style: normal;
}

a[href].orcid {
  padding-left: 4px;
  padding-right: 4px;
}

a[href].orcid > svg {
  margin-bottom: -2px;
}

/* --- TOC --- */

.toc a,
.tof a {
  text-decoration: none;
}

a .secno,
a .figno {
  color: #000;
}

ul.tof,
ol.tof {
  list-style: none outside none;
}

.caption {
  margin-top: 0.5em;
  font-style: italic;
}

/* --- TABLE --- */

table.simple {
  border-spacing: 0;
  border-collapse: collapse;
  border-bottom: 3px solid #005a9c;
}

.simple th {
  background: #005a9c;
  color: #fff;
  padding: 3px 5px;
  text-align: left;
}

.simple th a {
  color: #fff;
  padding: 3px 5px;
  text-align: left;
}

.simple th[scope="row"] {
  background: inherit;
  color: inherit;
  border-top: 1px solid #ddd;
}

.simple td {
  padding: 3px 10px;
  border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
  background: #f0f6ff;
}

/* --- DL --- */

.section dd > p:first-child {
  margin-top: 0;
}

.section dd > p:last-child {
  margin-bottom: 0;
}

.section dd {
  margin-bottom: 1em;
}

.section dl.attrs dd,
.section dl.eldef dd {
  margin-bottom: 0;
}

#issue-summary > ul {
  column-count: 2;
}

#issue-summary li {
  list-style: none;
  display: inline-block;
}

details.respec-tests-details {
  margin-left: 1em;
  display: inline-block;
  vertical-align: top;
}

details.respec-tests-details > * {
  padding-right: 2em;
}

details.respec-tests-details[open] {
  z-index: 999999;
  position: absolute;
  border: thin solid #cad3e2;
  border-radius: 0.3em;
  background-color: white;
  padding-bottom: 0.5em;
}

details.respec-tests-details[open] > summary {
  border-bottom: thin solid #cad3e2;
  padding-left: 1em;
  margin-bottom: 1em;
  line-height: 2em;
}

details.respec-tests-details > ul {
  width: 100%;
  margin-top: -0.3em;
}

details.respec-tests-details > li {
  padding-left: 1em;
}

.self-link:hover {
  opacity: 1;
  text-decoration: none;
  background-color: transparent;
}

aside.example .marker > a.self-link {
  color: inherit;
}

.header-wrapper {
  display: flex;
  align-items: baseline;
}

:is(h2, h3, h4, h5, h6):not(#toc > h2, .introductory > h2, #sotd > h2, .head > h2) {
  position: relative;
  left: -.5em;
}

:is(h2, h3, h4, h5, h6):not(#toc h2) + a.self-link {
  color: inherit;
  order: -1;
  position: relative;
  left: -1.1em;
  font-size: 1rem;
  opacity: 0.5;
}

:is(h2, h3, h4, h5, h6) + a.self-link::before {
  content: "§";
  text-decoration: none;
  color: var(--heading-text);
}

:is(h2, h3) + a.self-link {
  top: -0.2em;
}

:is(h4, h5, h6) + a.self-link::before {
  color: black;
}

@media (max-width: 767px) {
  dd {
    margin-left: 0;
  }
}

@media print {
  .removeOnSave {
    display: none;
  }
}
</style><link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/base.css"><link rel="stylesheet" href="//raw.githubusercontent.com/ericprud/respec-ieee/ieee/src/ieee/ieee.css"><style>
.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #383a42;
  background: #fafafa;
}

.hljs-comment,
.hljs-quote {
  color: #717277;
  font-style: italic;
}

.hljs-doctag,
.hljs-keyword,
.hljs-formula {
  color: #a626a4;
}

.hljs-section,
.hljs-name,
.hljs-selector-tag,
.hljs-deletion,
.hljs-subst {
  color: #ca4706;
  font-weight: bold;
}

.hljs-literal {
  color: #0b76c5;
}

.hljs-string,
.hljs-regexp,
.hljs-addition,
.hljs-attribute,
.hljs-meta-string {
  color: #42803c;
}

.hljs-built_in,
.hljs-class .hljs-title {
  color: #9a6a01;
}

.hljs-attr,
.hljs-variable,
.hljs-template-variable,
.hljs-type,
.hljs-selector-class,
.hljs-selector-attr,
.hljs-selector-pseudo,
.hljs-number {
  color: #986801;
}

.hljs-symbol,
.hljs-bullet,
.hljs-link,
.hljs-meta,
.hljs-selector-id,
.hljs-title {
  color: #336ae3;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

.hljs-link {
  text-decoration: underline;
}
</style><style>
var {
  position: relative;
  cursor: pointer;
}

var[data-type]::before,
var[data-type]::after {
  position: absolute;
  left: 50%;
  top: -6px;
  opacity: 0;
  transition: opacity 0.4s;
  pointer-events: none;
}

/* the triangle or arrow or caret or whatever */
var[data-type]::before {
  content: "";
  transform: translateX(-50%);
  border-width: 4px 6px 0 6px;
  border-style: solid;
  border-color: transparent;
  border-top-color: #000;
}

/* actual text */
var[data-type]::after {
  content: attr(data-type);
  transform: translateX(-50%) translateY(-100%);
  background: #000;
  text-align: center;
  /* additional styling */
  font-family: "Dank Mono", "Fira Code", monospace;
  font-style: normal;
  padding: 6px;
  border-radius: 3px;
  color: #daca88;
  text-indent: 0;
  font-weight: normal;
}

var[data-type]:hover::after,
var[data-type]:hover::before {
  opacity: 1;
}
</style><script id="initialUserConfig" type="application/json">{
  "varDesignation": "3330",
  "varDraftNumber": "3",
  "GorRPorSTD": "RP",
  "varTitlePAR": "Standard for Shape Expression Schemas",
  "varCommittee": "C/SABSC - Standards Activities Board Standards Committee ",
  "varSociety": "The Computer Society",
  "varApprovedDate": "12-03-2022",
  "scope": "This standard defines the syntax of Shape Expression schemas represented in JavaScript Object Notation (JSON), Resource Description Framework (RDF) and plain text. This standard includes formal semantics for validation of RDF knowledge graphs using Shape Expressions. This validation process includes the definition of ShapeMaps to associate nodes in RDF graphs with labeled Shape Expressions. A test suite covers all aspects of syntax and validation.",
  "github": {
    "repoURL": "https://github.com/shexSpec/spec/",
    "branch": "main"
  },
  "localBiblio": {
    "shex-vocab": {
      "authors": [
        "Gregg Kellogg"
      ],
      "title": "Shape Expression Vocabulary",
      "href": "http://www.w3.org/ns/shex#",
      "id": "shex-vocab"
    },
    "shape-map": {
      "authors": [
        "Eric Prud'hommeaux",
        "Thomas Baker"
      ],
      "title": "ShapeMap Structure and Language",
      "href": "http://shex.io/shape-map/",
      "id": "shape-map"
    }
  },
  "specStatus": "ED",
  "shortName": "shex-semantics",
  "latestVersion": "http://shex.io/shex-semantics/",
  "prevVersion": "http://shex.io/shex-semantics-20170713",
  "edDraftURI": "https://shexspec.github.io/spec/",
  "previousPublishDate": "2014-06-02",
  "previousMaturity": "Member-SUBM",
  "testSuiteURI": "https://github.com/shexSpec/shexTest",
  "DISABLED_implementationReportURI": "https://shexspec.github.io/shexTest/reports/#ShEx-validation-tests",
  "DISABLED_issueBase": "https://github.com/shexSpec/shex/issues",
  "editors": [
    {
      "name": "Eric Prud'hommeaux",
      "url": "http://www.w3.org/People/Eric/",
      "company": "W3C/MIT",
      "companyURL": "http://www.w3.org/"
    },
    {
      "name": "Iovka Boneva",
      "url": "http://cristal.univ-lille.fr/~boneva/",
      "company": "University of Lille",
      "companyURL": "http://www.univ-lille1.fr/"
    },
    {
      "name": "Jose Emilio Labra Gayo",
      "url": "http://di002.edv.uniovi.es/~labra/",
      "company": "University of Oviedo",
      "companyURL": "http://www.uniovi.es/"
    },
    {
      "name": "Katherine Thornton",
      "url": "https://github.com/emulatingkat"
    }
  ],
  "formerEditors": [
    {
      "name": "Gregg Kellogg",
      "url": "http://greggkellogg.net/",
      "company": "Spec-Ops",
      "companyURL": "https://spec-ops.io/",
      "w3cid": "44770"
    }
  ],
  "wg": "Shape Expressions Community Group",
  "wgURI": "https://www.w3.org/community/shex/",
  "otherLinks": [
    {
      "key": "Participate:",
      "data": [
        {
          "value": "GitHub shexSpec/spec",
          "href": "https://github.com/shexSpec/spec/"
        },
        {
          "value": "File an issue",
          "href": "https://github.com/shexSpec/spec/issues/"
        },
        {
          "value": "Commit history",
          "href": "https://github.com/shexSpec/spec/commits/main"
        },
        {
          "value": "Pull requests",
          "href": "https://github.com/shexSpec/spec/pulls/"
        }
      ]
    },
    {
      "key": "ShEx language",
      "data": [
        {
          "value": "Homepage",
          "href": "https://shex.io/"
        },
        {
          "value": "Gitter chat",
          "href": "https://gitter.im/shapeExpressions/Lobby"
        }
      ]
    }
  ],
  "publishISODate": "2025-06-11T00:00:00.000Z",
  "generatedSubtitle": "undefined June 11, 2025",
  "beforeSave": []
}</script></head>
  
  <body class="h-entry toc-inline">
    
    <section id="keywords" class="introductory flat"><!--OddPage--><h2>Keywords</h2>
      <p>
        RDF, Schema, Shape Expressions, Structure Definition, Structural Validation
      </p>
    </section><section id="copyright-page" class="introductory"><!--OddPage--><h2>Copyright Page</h2>

<div class="nohighlight" style="white-space: pre; font-size: .7em;">
The Institute of Electrical and Electronics Engineers, Inc. 
3 Park Avenue, New York, NY 10016-5997, USA 

Copyright © 2023 by The Institute of Electrical and Electronics Engineers, Inc. 
All rights reserved. Published <date published="">. Printed in the United States of America.

IEEE is a registered trademark in the U.S. Patent &amp; Trademark Office, owned by The Institute of Electrical and Electronics 
Engineers, Incorporated. 

PDF:	ISBN 978-0-XXXX-XXXX-X	STDXXXXX
Print:	ISBN 978-0-XXXX-XXXX-X	STDPDXXXXX

IEEE prohibits discrimination, harassment, and bullying.
For more information, visit https://www.ieee.org/about/corporate/governance/p9-26.html.
No part of this publication may be reproduced in any form, in an electronic retrieval system or otherwise, without the prior written permission of the publisher.
</date></div>
</section><section class="introductory" id="important-notices-and-disclaimers-concerning-ieee-standards-documents"><!--OddPage--><h2>Important Notices and Disclaimers Concerning IEEE Standards Documents</h2>

<p>IEEE Standards documents are made available for use subject to important notices and legal disclaimers. These notices and disclaimers, or a reference to this page (https://standards.ieee.org/ipr/disclaimers.html), appear in all standards and may be found under the heading “Important Notices and Disclaimers Concerning IEEE Standards Documents.”</p>
</section><section class="introductory" id="notice-and-disclaimer-of-liability-concerning-the-use-of-ieee-standards-documents"><!--OddPage--><h2>Notice and Disclaimer of Liability Concerning the Use of IEEE Standards Documents</h2>

<p>IEEE Standards documents are developed within IEEE Societies and subcommittees of IEEE Standards Association (IEEE SA) Board of Governors. IEEE develops its standards through an accredited consensus development process, which brings together volunteers representing varied viewpoints and interests to achieve the final product. IEEE standards are documents developed by volunteers with scientific, academic, and industry-based expertise in technical working groups. Volunteers are not necessarily members of IEEE or IEEE SA and participate without compensation from IEEE. While IEEE administers the process and establishes rules to promote fairness in the consensus development process, IEEE does not independently evaluate, test, or verify the accuracy of any of the information or the soundness of any judgments contained in its standards.</p>
<p>IEEE makes no warranties or representations concerning its standards, and expressly disclaims all warranties, express or implied, concerning this standard, including but not limited to the warranties of merchantability, fitness for a particular purpose and non-infringement IEEE Standards documents do not guarantee safety, security, health, or environmental protection, or guarantee against interference with or from other devices or networks. In addition, IEEE does not warrant or represent that the use of the material contained in its standards is free from patent infringement. IEEE Standards documents are supplied “AS IS” and “WITH ALL FAULTS.”</p>
<p>Use of an IEEE standard is wholly voluntary. The existence of an IEEE standard does not imply that there are no other ways to produce, test, measure, purchase, market, or provide other goods and services related to the scope of the IEEE standard. Furthermore, the viewpoint expressed at the time a standard is approved and issued is subject to change brought about through developments in the state of the art and comments received from users of the standard. </p>
<p>In publishing and making its standards available, IEEE is not suggesting or rendering professional or other services for, or on behalf of, any person or entity, nor is IEEE undertaking to perform any duty owed by any other person or entity to another. Any person utilizing any IEEE Standards document, should rely upon their own independent judgment in the exercise of reasonable care in any given circumstances or, as appropriate, seek the advice of a competent professional in determining the appropriateness of a given IEEE standard.</p>
<p>IN NO EVENT <em class="rfc2119">SHALL<!---0.294583%--></em> IEEE BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO: THE NEED TO PROCURE SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE PUBLICATION, USE OF, OR RELIANCE UPON ANY STANDARD, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE AND REGARDLESS OF WHETHER SUCH DAMAGE WAS FORESEEABLE.</p>
</section><section class="introductory" id="translations"><!--OddPage--><h2>Translations</h2>

<p>The IEEE consensus balloting process involves the review of documents in English only. In the event that an IEEE standard is translated, only the English version published by IEEE is the approved IEEE standard.</p>
</section><section class="introductory" id="official-statements"><!--OddPage--><h2>Official statements</h2>

<p>A statement, written or oral, that is not processed in accordance with the IEEE SA Standards Board Operations Manual shall not be considered or inferred to be the official position of IEEE or any of its committees and shall not be considered to be, nor be relied upon as, a formal position of IEEE. At lectures, symposia, seminars, or educational courses, an individual presenting information on IEEE standards shall make it clear that the presenter’s views should be considered the personal views of that individual rather than the formal position of IEEE, IEEE SA, the Standards Committee, or the Working Group. Statements made by volunteers may not represent the formal position of their employer(s) or affiliation(s).</p>
</section><section class="introductory" id="comments-on-standards"><!--OddPage--><h2>Comments on standards</h2>

<p>Comments for revision of IEEE Standards documents are welcome from any interested party, regardless of membership affiliation with IEEE or IEEE SA. However, IEEE does not provide interpretations, consulting information, or advice pertaining to IEEE Standards documents. </p>
<p>Suggestions for changes in documents should be in the form of a proposed change of text, together with appropriate supporting comments. Since IEEE standards represent a consensus of concerned interests, it is important that any responses to comments and questions also receive the concurrence of a balance of interests. For this reason, IEEE and the members of its Societies and subcommittees of the IEEE SA Board of Governors are not able to provide an instant response to comments, or questions except in those cases where the matter has previously been addressed. For the same reason, IEEE does not respond to interpretation requests. Any person who would like to participate in evaluating comments or in revisions to an IEEE standard is welcome to join the relevant IEEE working group. You can indicate interest in a working group using the Interests tab in the Manage Profile &amp; Interests area of the IEEE SA myProject system.1 An IEEE Account is needed to access the application.</p>
<p>Comments on standards should be submitted using the Contact Us form.2</p>
</section><section class="introductory" id="laws-and-regulations"><!--OddPage--><h2>Laws and regulations</h2>

<p>Users of IEEE Standards documents should consult all applicable laws and regulations. Compliance with the provisions of any IEEE Standards document does not constitute compliance to any applicable regulatory requirements. Implementers of the standard are responsible for observing or referring to the applicable regulatory requirements. IEEE does not, by the publication of its standards, intend to urge action that is not in compliance with applicable laws, and these documents may not be construed as doing so.</p>
</section><section class="introductory" id="data-privacy"><!--OddPage--><h2>Data privacy</h2>

<p>Users of IEEE Standards documents should evaluate the standards for considerations of data privacy and data ownership in the context of assessing and using the standards in compliance with applicable laws and regulations.</p>
</section><section class="introductory" id="copyrights"><!--OddPage--><h2>Copyrights</h2>

<p>IEEE draft and approved standards are copyrighted by IEEE under U.S. and international copyright laws. They are made available by IEEE and are adopted for a wide variety of both public and private uses. These include both use, by reference, in laws and regulations, and use in private self-regulation, standardization, and the promotion of engineering practices and methods. By making these documents available for use and adoption by public authorities and private users, neither IEEE nor its licensors waive any rights in copyright to the documents.</p>
</section><section class="introductory" id="photocopies"><!--OddPage--><h2>Photocopies</h2>

<p>Subject to payment of the appropriate licensing fees, IEEE will grant users a limited, non-exclusive license to photocopy portions of any individual standard for company or organizational internal use or individual, non-commercial use only. To arrange for payment of licensing fees, please contact Copyright Clearance Center, Customer Service, 222 Rosewood Drive, Danvers, MA 01923 USA; +1 978 750 8400; https://www.copyright.com/. Permission to photocopy portions of any individual standard for educational classroom use can also be obtained through the Copyright Clearance Center.</p>
</section><section class="introductory" id="updating-of-ieee-standards-documents"><!--OddPage--><h2>Updating of IEEE Standards documents</h2>

<p>Users of IEEE Standards documents should be aware that these documents may be superseded at any time by the issuance of new editions or may be amended from time to time through the issuance of amendments, corrigenda, or errata. An official IEEE document at any point in time consists of the current edition of the document together with any amendments, corrigenda, or errata then in effect. </p>
<p>Every IEEE standard is subjected to review at least every 10 years. When a document is more than 10 years old and has not undergone a revision process, it is reasonable to conclude that its contents, although still of some value, do not wholly reflect the present state of the art. Users are cautioned to check to determine that they have the latest edition of any IEEE standard.</p>
<p>In order to determine whether a given document is the current edition and whether it has been amended through the issuance of amendments, corrigenda, or errata, visit IEEE Xplore or contact IEEE.3 For more information about the IEEE SA or IEEE’s standards development process, visit the IEEE SA Website.</p>
</section><section class="introductory" id="errata"><!--OddPage--><h2>Errata</h2>

<p>Errata, if any, for all IEEE standards can be accessed on the IEEE SA Website.4 Search for standard number and year of approval to access the web page of the published standard. Errata links are located under the Additional Resources Details section. Errata are also available in IEEE Xplore. Users are encouraged to periodically check for errata.</p>
</section><section class="introductory" id="patents"><!--OddPage--><h2>Patents</h2>

<p>IEEE standards are developed in compliance with the IEEE SA Patent Policy.5</p>
<p>Attention is called to the possibility that implementation of this standard may require use of subject matter covered by patent rights. By publication of this standard, no position is taken by the IEEE with respect to the existence or validity of any patent rights in connection therewith. If a patent holder or patent applicant has filed a statement of assurance via an Accepted Letter of Assurance, then the statement is listed on the IEEE SA Website at https://standards.ieee.org/about/sasb/patcom/patents.html. Letters of Assurance may indicate whether the Submitter is willing or unwilling to grant licenses under patent rights without compensation or under reasonable rates, with reasonable terms and conditions that are demonstrably free of any unfair discrimination to applicants desiring to obtain such licenses.</p>
<p>Essential Patent Claims may exist for which a Letter of Assurance has not been received. The IEEE is not responsible for identifying Essential Patent Claims for which a license may be required, for conducting inquiries into the legal validity or scope of Patents Claims, or determining whether any licensing terms or conditions provided in connection with submission of a Letter of Assurance, if any, or in any licensing agreements are reasonable or non-discriminatory. Users of this standard are expressly advised that determination of the validity of any patent rights, and the risk of infringement of such rights, is entirely their own responsibility. Further information may be obtained from the IEEE Standards Association.</p>
</section><section class="introductory" id="important-notice"><!--OddPage--><h2>IMPORTANT NOTICE</h2>
<section id="technologies-application-of-technologies-and-recommended-procedures-in-various-industries-evolve-over-time-the-ieee-standards-development-process-allows-participants-to-review-developments-in-industries-technologies-and-practices-and-to-determine-what-if-any-updates-should-be-made-to-the-ieee-standard-during-this-evolution-the-technologies-and-recommendations-in-ieee-standards-may-be-implemented-in-ways-not-foreseen-during-the-standard-s-development-ieee-standards-development-activities-consider-research-and-information-presented-to-the-standards-development-group-in-developing-any-safety-recommendations-other-information-about-safety-practices-changes-in-technology-or-technology-implementation-or-impact-by-peripheral-systems-also-may-be-pertinent-to-safety-considerations-during-implementation-of-the-standard-implementers-and-users-of-ieee-standards-documents-are-responsible-for-determining-and-complying-with-all-appropriate-safety-security-environmental-health-and-interference-protection-practices-and-all-applicable-laws-and-regulations"><!--OddPage--><div class="header-wrapper"><h3 id="technologies-application-of-technologies-and-recommended-procedures-in-various-industries-evolve-over-time-the-ieee-standards-development-process-allows-participants-to-review-developments-in-industries-technologies-and-practices-and-to-determine-what-if-any-updates-should-be-made-to-the-ieee-standard-during-this-evolution-the-technologies-and-recommendations-in-ieee-standards-may-be-implemented-in-ways-not-foreseen-during-the-standard-s-development-ieee-standards-development-activities-consider-research-and-information-presented-to-the-standards-development-group-in-developing-any-safety-recommendations-other-information-about-safety-practices-changes-in-technology-or-technology-implementation-or-impact-by-peripheral-systems-also-may-be-pertinent-to-safety-considerations-during-implementation-of-the-standard-implementers-and-users-of-ieee-standards-documents-are-responsible-for-determining-and-complying-with-all-appropriate-safety-security-environmental-health-and-interference-protection-practices-and-all-applicable-laws-and-regulations-0">
<p>Technologies, application of technologies, and recommended procedures in various industries evolve over time. The IEEE standards development process allows participants to review developments in industries, technologies, and practices, and to determine what, if any, updates should be made to the IEEE standard. During this evolution, the technologies and recommendations in IEEE standards may be implemented in ways not foreseen during the standard’s development. IEEE standards development activities consider research and information presented to the standards development group in developing any safety recommendations. Other information about safety practices, changes in technology or technology implementation, or impact by peripheral systems also may be pertinent to safety considerations during implementation of the standard. Implementers and users of IEEE Standards documents are responsible for determining and complying with all appropriate safety, security, environmental, health, and interference protection practices and all applicable laws and regulations.</p>
</h3></div></section></section><section id="overview"><!--OddPage--><div class="header-wrapper"><h2 id="x1-overview">Overview</h2></div><!--OddPage-->
  
      <p>
        The Shape Expressions (ShEx) language describes <a data-cite="rdf11-concepts#dfn-node" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-node">RDF nodes</a> and <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">graph</a> structures.
        A <span class="math">node constraint</span> describes an RDF node (<a data-cite="rdf11-concepts#dfn-iri" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri">IRI</a>, <a data-cite="rdf11-concepts#dfn-blank-node" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node">blank node</a> or <a data-cite="rdf11-concepts#dfn-literal" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-literal">literal</a>) and a <span class="math">shape</span> describes the <a data-cite="rdf11-concepts#dfn-rdf-triple" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple">triples</a> involving nodes in an <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">RDF graph</a>.
        These descriptions identify <a data-lt="predicate" data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicates</a> and their associated cardinalities and datatypes.
        ShEx shapes can be used to communicate data structures associated with some process or interface, generate or validate data, or drive user interfaces.
      </p>
      <p>
        This document defines the ShEx language.
        See the <a href="../primer/index.html">Shape Expressions Primer</a> for a non-normative description of ShEx.
      </p>
    <!---0.294583%-->

  <section id="overview_scope"><div class="header-wrapper"><h3 id="x1-1-scope">Scope</h3></div><!--OddPage-->
    <p>This standard defines the syntax of Shape Expression schemas represented in JavaScript Object Notation (JSON), Resource Description Framework (RDF) and plain text. This standard includes formal semantics for validation of RDF knowledge graphs using Shape Expressions. This validation process includes the definition of ShapeMaps to associate nodes in RDF graphs with labeled Shape Expressions. A test suite covers all aspects of syntax and validation.<!---0.294583%--></p>
  </section>

  <section id="overview_wordUsage"><div class="header-wrapper"><h3 id="x1-2-word-usage">Word Usage</h3></div><!--OddPage-->
    <p>The word shall indicates mandatory requirements strictly to be followed in order to conform to the standard and from which no deviation is permitted (shall equals is required to).</p>
    <p>The word should indicates that among several possibilities one is recommended as particularly suitable, without mentioning or excluding others; or that a certain course of action is preferred but not necessarily required (should equals is recommended that).</p>
    <p>The word may is used to indicate a course of action permissible within the limits of the standard (may equals is permitted to).</p>
    <p>The word can is used for statements of possibility and capability, whether material, physical, or causal (can equals is able to).</p>
  </section>
</section><!--OddPage--><section id="draft"><!--OddPage--><div class="header-wrapper"><h2 style="color: red;" id="x2-draft">Draft</h2></div>
<p>This status of this document ED<!---0.294583%-->, it is NOT an IEEE specifiation.</p>


    <section id="security"><div class="header-wrapper"><h3 id="x2-1-security-considerations">Security Considerations</h3></div>
      
      <p>
        Revealing the structure of an RDF graph can reveal information about the content of conformant data.
        For instance, a schema with a predicate to describe cancer stage indicates that conforming graphs describe patients with cancer.
      </p>
      <p>
        The process of testing a graph's conformance to a schema may involve many detailed queries which could draw resources to respond to API calls or SPARQL queries.
      </p>
      <p>
        ShEx has an extension mechanism which can, in principle, evalute arbitrary code, possibly as some trusted agent.
        Such extensions should not be executed if they don't come from a trusted source.
      </p>
      <p>
        Since <a href="#dfn-shex" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shex-1">ShEx</a> is intended to be a pure data exchange format for validating <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">RDF graphs</a>, the <a href="#dfn-shexj" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexj-1">ShExJ</a> serialization <em class="rfc2119">SHOULD NOT<!---0.294583%--></em> be passed through a code execution mechanism such as JavaScript's <code>eval()</code> function to be parsed.
        An (invalid) document may contain code that, when executed, could lead to unexpected side effects compromising the security of a system.</p>
        <p>
          See also, <a href="#iana-considerations" class="sectionRef sec-ref">IANA Considerations</a>.
        </p>
    </section>
    
    <!-- <section id="idl-index" class="appendix informative"> -->
    <!-- </section> -->
  

<section id="normative-references"><div class="header-wrapper"><h3 id="x2-2-normative-references">Normative references<!---0.294583%--></h3></div>
    
    <dl class="bibliography"><dt id="bib-ecmascript-6.0">[ECMASCRIPT-6.0<!---0.294583%-->]</dt><dd>
      Allen Wirfs-Brock. <a href="http://www.ecma-international.org/ecma-262/6.0/index.html"><cite>ECMA-262 6th Edition, The ECMAScript 2015 Language Specification</cite></a>.  Ecma International. June 2015. Standard. URL: <a href="http://www.ecma-international.org/ecma-262/6.0/index.html">http://www.ecma-international.org/ecma-262/6.0/index.html</a><!---0.294583%-->
    </dd><dt id="bib-json-ld">[JSON-LD<!---0.294583%-->]</dt><dd>
      Manu Sporny; Gregg Kellogg; Markus Lanthaler. <a href="https://www.w3.org/TR/json-ld/"><cite>JSON-LD 1.0</cite></a>.  W3C. 3 November 2020. W3C Recommendation. URL: <a href="https://www.w3.org/TR/json-ld/">https://www.w3.org/TR/json-ld/</a><!---0.294583%-->
    </dd><dt id="bib-rdf11-concepts">[RDF11-CONCEPTS<!---0.294583%-->]</dt><dd>
      Richard Cyganiak; David Wood; Markus Lanthaler. <a href="https://www.w3.org/TR/rdf11-concepts/"><cite>RDF 1.1 Concepts and Abstract Syntax</cite></a>.  W3C. 25 February 2014. W3C Recommendation. URL: <a href="https://www.w3.org/TR/rdf11-concepts/">https://www.w3.org/TR/rdf11-concepts/</a><!---0.294583%-->
    </dd><dt id="bib-rdf11-mt">[rdf11-mt<!---0.294583%-->]</dt><dd>
      Patrick Hayes; Peter Patel-Schneider. <a href="https://www.w3.org/TR/rdf11-mt/"><cite>RDF 1.1 Semantics</cite></a>.  W3C. 25 February 2014. W3C Recommendation. URL: <a href="https://www.w3.org/TR/rdf11-mt/">https://www.w3.org/TR/rdf11-mt/</a><!---0.294583%-->
    </dd><dt id="bib-rfc3986">[RFC3986<!---0.294583%-->]</dt><dd>
      T. Berners-Lee; R. Fielding; L. Masinter. <a href="https://www.rfc-editor.org/rfc/rfc3986"><cite>Uniform Resource Identifier (URI): Generic Syntax</cite></a>.  IETF. January 2005. Internet Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc3986">https://www.rfc-editor.org/rfc/rfc3986</a><!---0.294583%-->
    </dd><dt id="bib-rfc4647">[rfc4647<!---0.294583%-->]</dt><dd>
      A. Phillips, Ed.; M. Davis, Ed.. <a href="https://www.rfc-editor.org/rfc/rfc4647"><cite>Matching of Language Tags</cite></a>.  IETF. September 2006. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc4647">https://www.rfc-editor.org/rfc/rfc4647</a><!---0.294583%-->
    </dd><dt id="bib-rfc7159">[rfc7159<!---0.294583%-->]</dt><dd>
      T. Bray, Ed.. <a href="https://www.rfc-editor.org/rfc/rfc7159"><cite>The JavaScript Object Notation (JSON) Data Interchange Format</cite></a>.  IETF. March 2014. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc7159">https://www.rfc-editor.org/rfc/rfc7159</a><!---0.294583%-->
    </dd><dt id="bib-shape-map">[shape-map<!---0.294583%-->]</dt><dd>
      Eric Prud'hommeaux; Thomas Baker. <a href="http://shex.io/shape-map/"><cite>ShapeMap Structure and Language</cite></a>. URL: <a href="http://shex.io/shape-map/">http://shex.io/shape-map/</a><!---0.294583%-->
    </dd><dt id="bib-shex-vocab">[shex-vocab<!---0.294583%-->]</dt><dd>
      Gregg Kellogg. <a href="http://www.w3.org/ns/shex#"><cite>Shape Expression Vocabulary</cite></a>. URL: <a href="http://www.w3.org/ns/shex#">http://www.w3.org/ns/shex#</a><!---0.294583%-->
    </dd><dt id="bib-sparql11-query">[sparql11-query<!---0.294583%-->]</dt><dd>
      Steven Harris; Andy Seaborne. <a href="https://www.w3.org/TR/sparql11-query/"><cite>SPARQL 1.1 Query Language</cite></a>.  W3C. 21 March 2013. W3C Recommendation. URL: <a href="https://www.w3.org/TR/sparql11-query/">https://www.w3.org/TR/sparql11-query/</a><!---0.294583%-->
    </dd><dt id="bib-turtle">[turtle<!---0.294583%-->]</dt><dd>
      Eric Prud'hommeaux; Gavin Carothers. <a href="https://www.w3.org/TR/turtle/"><cite>RDF 1.1 Turtle</cite></a>.  W3C. 25 February 2014. W3C Recommendation. URL: <a href="https://www.w3.org/TR/turtle/">https://www.w3.org/TR/turtle/</a><!---0.294583%-->
    </dd><dt id="bib-xml">[XML<!---0.294583%-->]</dt><dd>
      Tim Bray; Jean Paoli; Michael Sperberg-McQueen; Eve Maler; François Yergeau et al. <a href="https://www.w3.org/TR/xml/"><cite>Extensible Markup Language (XML) 1.0 (Fifth Edition)</cite></a>.  W3C. 26 November 2008. W3C Recommendation. URL: <a href="https://www.w3.org/TR/xml/">https://www.w3.org/TR/xml/</a><!---0.294583%-->
    </dd><dt id="bib-xmlschema-2">[xmlschema-2<!---0.294583%-->]</dt><dd>
      Paul V. Biron; Ashok Malhotra. <a href="https://www.w3.org/TR/xmlschema-2/"><cite>XML Schema Part 2: Datatypes Second Edition</cite></a>.  W3C. 28 October 2004. W3C Recommendation. URL: <a href="https://www.w3.org/TR/xmlschema-2/">https://www.w3.org/TR/xmlschema-2/</a><!---0.294583%-->
    </dd><dt id="bib-xpath-functions">[xpath-functions<!---0.294583%-->]</dt><dd>
      Ashok Malhotra; Jim Melton; Norman Walsh; Michael Kay. <a href="https://www.w3.org/TR/xpath-functions/"><cite>XQuery 1.0 and XPath 2.0 Functions and Operators (Second Edition)</cite></a>.  W3C. 14 December 2010. W3C Recommendation. URL: <a href="https://www.w3.org/TR/xpath-functions/">https://www.w3.org/TR/xpath-functions/</a><!---0.294583%-->
    </dd><dt id="bib-xpath-functions-31">[xpath-functions-31<!---0.294583%-->]</dt><dd>
      Michael Kay. <a href="https://www.w3.org/TR/xpath-functions-31/"><cite>XPath and XQuery Functions and Operators 3.1</cite></a>.  W3C. 21 March 2017. W3C Recommendation. URL: <a href="https://www.w3.org/TR/xpath-functions-31/">https://www.w3.org/TR/xpath-functions-31/</a><!---0.294583%-->
    </dd><dt id="bib-xpath20">[xpath20<!---0.294583%-->]</dt><dd>
      Anders Berglund; Scott Boag; Don Chamberlin; Mary Fernandez; Michael Kay; Jonathan Robie; Jerome Simeon et al. <a href="https://www.w3.org/TR/xpath20/"><cite>XML Path Language (XPath) 2.0 (Second Edition)</cite></a>.  W3C. 14 December 2010. W3C Recommendation. URL: <a href="https://www.w3.org/TR/xpath20/">https://www.w3.org/TR/xpath20/</a><!---0.294583%-->
    </dd><!---0.294583%--></dl>
  </section></section><section id="sotd">
      <p>
        This is an editor's draft of the Shape Expressions specification.
        ShEx 2.x differs significantly from the W3C ShEx Submission.
        The <a href="http://shex.io/shex-semantics-20170713/">July 2017 publication</a> included a <a href="#validation">definition of validation</a> which implied infinite recursion.
        This version explicitly includes recursion checks.
        No tests changed as a result of this and no implementations or applications are known to have been affected.
      </p>
      <p>
        If you wish to make comments regarding this document, please raise them as GitHub issues.
        There are separate interfaces for <a href="https://github.com/shexSpec/spec/issues">specification</a>, <a href="https://github.com/shexSpec/shex/issues">language</a> and <a href="https://github.com/shexSpec/shexTest/issues">test</a> issues.
        Only send comments to <a href="mailto:public-shex@w3.org">public-shex@w3.org</a>     (<a href="mailto:public-shex-request@w3.org?subject=subscribe">subscribe</a>,
    <a href="https://lists.w3.org/Archives/Public/public-shex/">archives</a>) if you are unable to raise issues on GitHub. All comments are welcome.
      </p>
    </section>

    

    <section id="introduction"><!--OddPage--><div class="header-wrapper"><h2 id="x3-introduction">Introduction</h2></div>
      
      <p>
        The Shape Expressions (<dfn id="dfn-shex" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">ShEx</dfn>) language provides a structural schema for RDF data.
        This can be used to document APIs or datasets, aid in development of API-conformant messages, minimize defensive programming, guide user interfaces, or anything else that involves a machine-readable description of data organization and typing requirements.
      </p>
      <p>
        ShEx describes <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">RDF graph</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">RDF11-CONCEPTS<!---0.294583%--></a></cite><!---0.294583%-->] structures as sets of potentially connected <a data-lt="shape" href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-1">Shapes</a>.
        These constrain the <a data-cite="rdf11-concepts#dfn-rdf-triple" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple">triples</a> involving nodes in an <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">RDF graph</a>.
        <code>Node Constraints</code> constrain RDF nodes by constraining their node kind (<a data-cite="rdf11-concepts#dfn-iri" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri">IRI</a>, <a data-cite="rdf11-concepts#dfn-blank-node" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node">blank node</a> or <a data-cite="rdf11-concepts#dfn-literal" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-literal">Literal</a>), enumerating permissible values in value sets, specifying their datatype, and constraining value ranges of Literals.
        Additionally, they constrain lexical forms of <a data-cite="rdf11-concepts#dfn-literal" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-literal">Literals</a>, <a data-cite="rdf11-concepts#dfn-iri" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri">IRIs</a> and <a data-cite="rdf11-concepts#dfn-blank-node-identifier" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier">labeled blank nodes</a>.
        Shape Expressions schemas share blank nodes with the constrained <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">RDF graphs</a> in the same way that graphs in <a data-cite="rdf11-concepts#dfn-rdf-dataset" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-dataset">RDF datasets</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">rdf11-concepts<!---0.294583%--></a></cite><!---0.294583%-->] share blank nodes.
      </p>
      <p>
        ShEx can be represented in JSON structures (<a href="#dfn-shexj" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexj-2">ShExJ</a>) or a compact syntax (<a href="#dfn-shexc" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexc-1">ShExC</a>).
        The compact syntax is intended for human consumption; the JSON structure for machine processing.
        This document defines ShEx in terms of <a href="#dfn-shexj" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexj-3">ShExJ</a> and includes a <a href="#shexc">section on the ShEx Compact Syntax (ShEx)</a>.
      </p>
    </section>

    <section id="defn-acro-abbrs"><!--OddPage--><div class="header-wrapper"><h2 id="x4-definitions-acronyms-and-abbreviations">Definitions, Acronyms, and Abbreviations</h2></div>
      

      <section id="definitions"><div class="header-wrapper"><h3 id="x4-1-definitions">Definitions</h3></div>
        
        <p>Shape expressions are defined using terms from RDF semantics [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-mt" title="RDF 1.1 Semantics">rdf11-mt<!---0.294583%--></a></cite><!---0.294583%-->]:</p>
        <ul>
          <li><dfn data-cite="rdf11-concepts#dfn-node" data-lt="nodes|rdf node|rdf nodes" id="dfn-nodes" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://www.w3.org/TR/rdf11-concepts/#dfn-node" data-cite="rdf11-concepts" data-cite-path="" data-cite-frag="#dfn-node">Node</a></dfn>: one of <dfn data-cite="rdf11-concepts#dfn-iri" data-lt="iris" id="dfn-iris" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri" data-cite="rdf11-concepts" data-cite-path="" data-cite-frag="#dfn-iri">IRI</a></dfn>, <dfn data-cite="rdf11-concepts#dfn-blank-node" data-lt="bnodes|blank nodes" id="dfn-bnodes" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node" data-cite="rdf11-concepts" data-cite-path="" data-cite-frag="#dfn-blank-node">blank node</a></dfn>, <dfn data-cite="rdf11-concepts#dfn-literal" data-lt="literal|literals|RDF Literal|RDF Literals" data-plurals="rdf literals|rdf literal" id="dfn-literal" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://www.w3.org/TR/rdf11-concepts/#dfn-literal" data-cite="rdf11-concepts" data-cite-path="" data-cite-frag="#dfn-literal">Literal</a></dfn></li>
          <li><dfn data-cite="rdf11-concepts#dfn-rdf-graph" data-lt="RDF Graph|RDF Graphs" data-plurals="rdf graphs|rdf graph" id="dfn-rdf-graph" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph" data-cite="rdf11-concepts" data-cite-path="" data-cite-frag="#dfn-rdf-graph">Graph</a></dfn>: a set of <dfn data-cite="rdf11-concepts#dfn-rdf-triple" data-lt="triple|rdf triple|rdf triples" id="dfn-triple" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple" data-cite="rdf11-concepts" data-cite-path="" data-cite-frag="#dfn-rdf-triple">Triples</a></dfn> of (<dfn data-cite="rdf11-concepts#dfn-subject" id="dfn-subject" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://www.w3.org/TR/rdf11-concepts/#dfn-subject" data-cite="rdf11-concepts" data-cite-path="" data-cite-frag="#dfn-subject">subject</a></dfn>, <dfn data-cite="rdf11-concepts#dfn-predicate" id="dfn-predicate" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate" data-cite="rdf11-concepts" data-cite-path="" data-cite-frag="#dfn-predicate">predicate</a></dfn>, <dfn data-cite="rdf11-concepts#dfn-object" id="dfn-object" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://www.w3.org/TR/rdf11-concepts/#dfn-object" data-cite="rdf11-concepts" data-cite-path="" data-cite-frag="#dfn-object">object</a></dfn>)</li>
        </ul>

        <p>
          The following functions access the elements of an <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">RDF graph</a> <span class="math">G</span> containing a node <span class="math">n</span>:</p>
        <ul>
          <li>
            <span class="math"><dfn id="dfn-arcsout" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">arcsOut</dfn>(G, n)</span> is the set of <a data-cite="rdf11-concepts#dfn-rdf-triple" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple">triples</a> in a <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">graph</a> <span class="math">G</span> with <a data-cite="rdf11-concepts#dfn-subject" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-subject">subject</a> <span class="math">n</span>.
          </li>
          <li>
            <span class="math"><dfn id="dfn-predicatesout" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">predicatesOut</dfn>(G, n)</span> is the set of <a data-lt="predicate" data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicates</a> in <span class="math"><a href="#dfn-arcsout" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-arcsout-1">arcsOut</a>(G, n)</span>.
          </li>
          <li>
            <span class="math"><dfn id="dfn-arcsin" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">arcsIn</dfn>(G, n)</span> is the set of <a data-cite="rdf11-concepts#dfn-rdf-triple" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple">triples</a> in a <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">graph</a> <span class="math">G</span> with <a data-cite="rdf11-concepts#dfn-object" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-object">object</a> <span class="math">n</span>.
          </li>
          <li>
            <span class="math"><dfn id="dfn-predicatesin" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">predicatesIn</dfn>(G, n)</span> is the set of <a data-lt="predicate" data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicates</a> in <span class="math"><a href="#dfn-arcsin" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-arcsin-1">arcsIn</a>(G, n)</span>.
          </li>
          <li>
            <span class="math"><dfn id="dfn-neigh" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">neigh</dfn>(G, n)</span>, the neighbourhood of the <a data-cite="rdf11-concepts#dfn-node" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-node">node</a> <span class="math">n</span> in a <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">graph</a> <span class="math">G</span>, is the union of <span class="math"><a href="#dfn-arcsout" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-arcsout-2">arcsOut</a>(G, n)</span> and <span class="math"><a href="#dfn-arcsin" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-arcsin-2">arcsIn</a>(G, n)</span>:<br><span class="math"><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-1">neigh</a>(G, n) = <a href="#dfn-arcsout" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-arcsout-3">arcsOut</a>(G, n) ∪ <a href="#dfn-arcsin" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-arcsin-3">arcsIn</a>(G, n)</span>.
          </li>
          <li>
            <span class="math"><dfn id="dfn-predicates" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">predicates</dfn>(G, n)</span> is the set of <a data-lt="predicate" data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicates</a> in <span class="math"><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-2">neigh</a>(G, n)</span>.<br><span class="math"><a href="#dfn-predicates" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-predicates-1">predicates</a>(G, n) = <a href="#dfn-predicatesout" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-predicatesout-1">predicatesOut</a>(G, n) ∪ <a href="#dfn-predicatesin" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-predicatesin-1">predicatesIn</a>(G, n)</span>.
          </li>
          <li>
            <span class="math"><dfn id="dfn-def" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">def</dfn>(Sch, label)</span> is the <span class="math">decl</span>.<span class="param">shapeExpr</span> where <span class="math">decl</span>.<span class="param">label</span> = <code>label</code>. <code>Sch</code> must have exactly one <code>def(Sch, label)</code>.
          </li>
          <li>
            <dfn data-lt="shapemap|fixed ShapeMap" data-dfn-type="dfn" id="dfn-shapemap" data-no-export="" tabindex="0" aria-haspopup="dialog"><a href="http://shex.io/shape-map/#dfn-fixed-shapemap">fixed ShapeMap</a></dfn> is a list of pairs of RDF node label and shape expression label as defined in the [<cite><a class="bibref" data-link-type="biblio" href="#bib-shape-map" title="ShapeMap Structure and Language">shape-map<!---0.294583%--></a></cite><!---0.294583%-->] specification.
          </li>
          <li>
            Given the <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">graph</a> <span class="math">G</span>, <a href="#dfn-shapes-schema" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapes-schema-1">schema</a> <span class="math">Sch</span>, and the fixed <a href="#dfn-shapemap" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapemap-1">ShapeMap</a> <span class="math">ism</span>, <span class="math"><dfn id="dfn-validation" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">validation</dfn>(G, Sch, ism)</span> is the process of assigning each node/shapeExpr pair in <span class="math">ism</span> a status of <var>conformant<!---0.294583%--></var> or <var>nonconformant<!---0.294583%--></var> reflecting whether the node in <span class="math">G</span> satisfies the shapeExpr in <span class="math">Sch</span>.
          </li>
      <p></p>

        </ul>

        <div class="example">
          <p>
            Consider the <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">RDF graph</a> <span class="math">G</span> represented in Turtle:
          </p>

          <pre class="data" aria-busy="false"><code class="hljs">PREFIX ex: http://schema.example/#
PREFIX inst: http://inst.example/#
PREFIX foaf: http://xmlns.com/foaf/
PREFIX xsd: http://www.w3.org/2001/XMLSchema#

inst:Issue1
    ex:state      ex:unassigned ;
    ex:reportedBy _:User2 .

_:User2
    foaf:name     "Bob Smith" ;
    foaf:mbox     &lt;mailto:bob@example.org&gt; .</code></pre>
          <p>
            There are two arcs out of <span class="pre">_:User2</span>; <span class="math"><a href="#dfn-arcsout" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-arcsout-4">arcsOut</a>(G, <span class="pre">_:User2</span>)</span>:
          </p>
          <pre class="data" aria-busy="false"><code class="hljs">_:User2  foaf:name  "Bob Smith" .
_:User2  foaf:mbox  &lt;mailto:bob@example.org&gt; .</code></pre>
          <p>
            There is one arc into <span class="pre">_:User2</span>; <span class="math"><a href="#dfn-arcsin" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-arcsin-4">arcsIn</a>(G, <span class="pre">_:User2</span>)</span>:
          </p>
          <pre class="data" aria-busy="false"><code class="hljs">inst:Issue1 ex:reportedBy  _:User2 .</code></pre>
          <p>
            There are three arcs in the neighbourhood of <span class="pre">_:User2</span> set, <span class="math"><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-3">neigh</a>(G, <span class="pre">_:User2</span>)</span>:
          </p>
          <pre class="data" aria-busy="false"><code class="hljs">_:User2  foaf:name  "Bob Smith" .
_:User2  foaf:mbox  &lt;mailto:bob@example.org&gt; .
inst:Issue1 ex:reportedBy  _:User2 .</code></pre>
        </div>
      </section>

      <section id="Acronyms and abbreviations"><div class="header-wrapper"><h3 id="x4-2-acronyms-and-abbreviations">Acronyms And Abbreviations</h3></div>
        
        <table id="acronyms" class="bare">
          <tbody>
            <tr><td>BNF</td> <td>Backus Naur Form</td></tr>
            <tr><td>CSS</td>   <td>Cascading Stylesheets</td></tr>
            <tr><td>IANA</td> <td>Internet Assigned Numbers Authority</td></tr>
            <tr><td>IRI</td>   <td>Internationalized Resource Identifier</td></tr>
            <tr><td>RDF</td>   <td>Resource Description Framework</td></tr>
            <tr><td>ShEx</td>  <td>Shape Expressions RDF schema language</td></tr>
            <tr><td>ShExC</td> <td>ShEx Compact syntax</td></tr>
            <tr><td>ShExJ</td> <td>ShEx JSON (or JSON-LD) syntax</td></tr>
            <tr><td>ShExR</td> <td>ShEx RDF syntax</td></tr>
            <tr><td>SPARQL</td> <td>RDF Query Language</td></tr>
            <tr><td>URL</td> <td>Uniform Resource Locator</td></tr>
            <tr><td>UTF-8</td> <td>Unicode Transformation Format</td></tr>
            <tr><td>XML</td> <td>Extensible Markup Language</td></tr>
            <tr><td>XPath</td> <td>Path Language for XML</td></tr>
          </tbody>
        </table>
      </section>
    </section>

    <section id="notation"><!--OddPage--><div class="header-wrapper"><h2 id="x5-notation">Notation</h2></div>
      
      <p>
        The JSON [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc7159" title="The JavaScript Object Notation (JSON) Data Interchange Format">rfc7159<!---0.294583%--></a></cite><!---0.294583%-->] Syntax serves as a serializable proxy for an abstract syntax.
      </p>

      <p>
        <a data-cite="rdf11-concepts/#dfn-rdf-term" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-term">RDF terms</a> are represented as <a data-cite="json-ld#dfn-node" href="https://www.w3.org/TR/json-ld/#dfn-node">JSON-LD nodes</a>.
        </p><ul>
          <li><a data-cite="rdf11-concepts#dfn-iri" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri">IRIs</a> are represented as a <a data-cite="rfc7159#section-7" href="https://www.rfc-editor.org/rfc/rfc7159#section-7">JSON string</a> consisting of the IRI string, e.g. <br><code class="json">"http://example.org/resource"</code></li>
          <li><a data-cite="rdf11-concepts#dfn-blank-node" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node">Blank nodes</a> are represented as a JSON string composed of the concatenation of "<code>_:</code>" and a <dfn data-cite="rdf11-concepts#dfn-blank-node-identifier" data-lt="blank node identifiers|labeled blank nodes" id="dfn-blank-node-identifiers" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier" data-cite="rdf11-concepts" data-cite-path="" data-cite-frag="#dfn-blank-node-identifier">blank node identifier</a></dfn>, e.g. <br><code class="json">"_:blank3"</code></li>
          <li><a data-cite="rdf11-concepts#dfn-literal" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-literal">Literals</a> are represented as a <a data-cite="rfc7159#section-4" data-link-type="dfn" href="https://www.rfc-editor.org/rfc/rfc7159#section-4">JSON object</a>s following the composition rules for <a data-cite="json-ld/#dfn-json-ld-value" href="https://www.w3.org/TR/json-ld/#dfn-json-ld-value">JSON-LD values</a>, i.e.
          <ul>
            <li>literals with the datatype <code>http://www.w3.org/2001/XMLSchema#string</code> are represented with the <span class="param">value</span> property, e.g. <br><code class="json">{ "value": "abc" }</code>.</li>
            <li><a data-cite="rdf11-concepts#dfn-language-tagged-string" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-language-tagged-string">language-tagged strings</a> are represented with an additional <span class="param">language</span> property, e.g. <br><code class="json">{ "value": "hello world", "langague": "en-US" }</code></li>
            <li>datatyped literals are represented with an additional <span class="param">datatype</span> property, e.g. <br><code class="json">{ "value": "123", "datatype": "http://www.w3.org/2001/XMLSchema#integer" }</code></li>
          </ul></li>
        </ul>
      <p></p>

      <section id="json-grammar"><div class="header-wrapper"><h3 id="x5-1-json-grammar">JSON Grammar</h3></div>
        
      <p>
        This specification uses a <dfn id="dfn-json-grammar" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">JSON grammar</dfn> to describe the set of JSON documents that can be interpreted as a ShEx schema.
        ShEx data structures are represented as <dfn data-cite="rfc7159#section-4" data-lt="json object" id="dfn-json-object" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://www.rfc-editor.org/rfc/rfc7159#section-4" data-cite="rfc7159" data-cite-path="" data-cite-frag="#section-4">JSON objects</a></dfn> with a member with the name "<code>type</code>" (i.e. an object with a <span class="param">type</span> attribute):
      </p>
      <div class="json">
        <pre class="json nohighlight">{ "type": "typeName", member<sub>0…n</sub> }</pre>
      </div>
      <p>
        These are expressed in JSON grammar as <span class="shexj">typeName { member* }</span>.
        <a data-cite="rfc7159#section-2" href="https://www.rfc-editor.org/rfc/rfc7159#section-2">RFC7159 Section 2</a> provides syntactic constraints for JSON — the grammar constraining those to valid <a href="#dfn-shexj" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexj-4">ShExJ</a> constructs is composed of:
      </p>
      <ul>
        <li><code>typeName</code> is the name of the typed data structure.
        Types are referenced in the definitions of object members and in the definitions of the semantics for those data structures.</li>
        <li><code>member*</code> is a list of zero or more terminals or references to other typeExpressions.</li>
        <li>A <code>typeExpression</code> is one of:
        <ul>
          <li><code>typeName</code> — an object of corresponding type</li>
          <li><code>array</code>: <span class="shexj">[ typeExpression+ ]</span>— an array of one or more JSON values matching the typeExpression.</li>
          <li><code>choice</code>: <span class="shexj">typeExpression1 | typeExpression2 | …</span>— a choice between two or more typeExressions.</li>
        </ul>
        </li>
        <li>Cardinalities are represented as by the strings <code>?</code>, <code>+</code>, <code>*</code> following the <a data-cite="XML#sec-notation" href="https://www.w3.org/TR/xml/#sec-notation">notation in the XML specification</a>[<cite><a class="bibref" data-link-type="biblio" href="#bib-xml" title="Extensible Markup Language (XML) 1.0 (Fifth Edition)">XML<!---0.294583%--></a></cite><!---0.294583%-->] or <code>{m,}</code> to indicate a that at least <code>m</code> elements are required.</li>
      </ul>

      <p>
        The following examples are excerpts from the definitions below.
        In the JSON notation,
      </p>

      <div class="shexj simupre"><a class="obj internalDFN" href="#dfn-shapes-schema" data-link-type="dfn" id="ref-for-dfn-shapes-schema-2">Schema</a> { <a class="param internalDFN" href="#dfn-startacts" data-link-type="dfn" id="ref-for-dfn-startacts-1">startActs</a>:[<a class="objref internalDFN" href="#dfn-semact" data-link-type="dfn" id="ref-for-dfn-semact-1">SemAct</a>+]? <a class="param internalDFN" href="#dfn-start" data-link-type="dfn" id="ref-for-dfn-start-1">start</a>:<a class="nobref internalDFN" href="#dfn-shapeexpr" data-link-type="dfn" id="ref-for-dfn-shapeexpr-1">shapeExpr</a>? <a class="param internalDFN" href="#dfn-import" data-link-type="dfn" id="ref-for-dfn-import-1">imports</a>:[<a data-cite="rdf11-concepts#dfn-iri" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri">IRI</a>+]? <a class="param internalDFN" href="#dfn-shapes" data-link-type="dfn" id="ref-for-dfn-shapes-1">shapes</a>:[<a class="nobref internalDFN" href="#dfn-shapeexpr" data-link-type="dfn" id="ref-for-dfn-shapeexpr-2">shapeExpr</a>+]? }</div>
      <p>
        signifies that a <code>Schema</code> has four optional components called <a class="param internalDFN" href="#dfn-startacts" data-link-type="dfn" id="ref-for-dfn-startacts-2">startActs</a>, <a class="param internalDFN" href="#dfn-start" data-link-type="dfn" id="ref-for-dfn-start-2">start</a>, <a class="param internalDFN" href="#dfn-import" data-link-type="dfn" id="ref-for-dfn-import-2">imports</a> and <a class="param internalDFN" href="#dfn-shapes" data-link-type="dfn" id="ref-for-dfn-shapes-2">shapes</a>:
      </p>
      <ul>
        <li><span class="param">startActs</span> is a list of one or more <a class="objref internalDFN" href="#dfn-semact" data-link-type="dfn" id="ref-for-dfn-semact-2">SemAct</a>.</li>
        <li><span class="param">start</span> is a <a class="objref internalDFN" href="#dfn-shapeexpr" data-link-type="dfn" id="ref-for-dfn-shapeexpr-3">shapeExpr</a>.</li>
        <li><span class="param">imports</span> is a list of one or more <a class="objref" data-cite="rdf11-concepts#dfn-iri" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri">IRI</a>.</li>
        <li><span class="param">shapes</span> is an array of <a class="nobref internalDFN" href="#dfn-shapeexpr" data-link-type="dfn" id="ref-for-dfn-shapeexpr-4">shapeExpr</a>.</li>
      </ul>

      <div class="shexj simupre"><a class="nob internalDFN" href="#dfn-shapeexpr" data-link-type="dfn" id="ref-for-dfn-shapeexpr-5">shapeExpr</a> = <a class="objref internalDFN" href="#dfn-shapeor" data-link-type="dfn" id="ref-for-dfn-shapeor-1">ShapeOr</a> | <a class="objref internalDFN" href="#dfn-shapeand" data-link-type="dfn" id="ref-for-dfn-shapeand-1">ShapeAnd</a> | <a class="objref internalDFN" href="#dfn-shapenot" data-link-type="dfn" id="ref-for-dfn-shapenot-1">ShapeNot</a>
          | <a class="objref internalDFN" href="#dfn-nodeconstraint" data-link-type="dfn" id="ref-for-dfn-nodeconstraint-1">NodeConstraint</a> | <a class="objref internalDFN" href="#dfn-shape" data-link-type="dfn" id="ref-for-dfn-shape-2">Shape</a> | <a class="objref internalDFN" href="#dfn-shapeexternal" data-link-type="dfn" id="ref-for-dfn-shapeexternal-1">ShapeExternal</a> ;</div>
      <p>
        signifies that a <a href="#dfn-shapeexpr" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexpr-6">shapeExpr</a> is one of seven object types: <a class="objref .shexj internalDFN" href="#dfn-shapeor" data-link-type="dfn" id="ref-for-dfn-shapeor-2">ShapeOr</a> | <a class="objref internalDFN" href="#dfn-shapeand" data-link-type="dfn" id="ref-for-dfn-shapeand-2">ShapeAnd</a> | ….
      </p>

      <div class="shexj simupre"><a class="obj internalDFN" href="#dfn-nodeconstraint" data-link-type="dfn" id="ref-for-dfn-nodeconstraint-2">NodeConstraint</a> { <span class="param">nodeKind</span>:(<span class="literal">"iri"</span> | <span class="literal">"bnode"</span> | <span class="literal">"nonliteral"</span> | <span class="literal">"literal"</span>)? <a class="nobref internalDFN" href="#dfn-xsfacet" data-link-type="dfn" id="ref-for-dfn-xsfacet-1">xsFacet</a>* }
<a class="nob internalDFN" href="#dfn-xsfacet" data-link-type="dfn" id="ref-for-dfn-xsfacet-2">xsFacet</a>        = <a class="nobref internalDFN" href="#dfn-stringfacet" data-link-type="dfn" id="ref-for-dfn-stringfacet-1">stringFacet</a> | <a class="nobref internalDFN" href="#dfn-numericfacet" data-link-type="dfn" id="ref-for-dfn-numericfacet-1">numericFacet</a> ;</div>
      <p>
        signifies that a <code>NodeConstraint</code> has a <code class="param">nodeKind</code> of one of the four literals followed by any number of <a class="objref .shexj internalDFN" href="#dfn-xsfacet" data-link-type="dfn" id="ref-for-dfn-xsfacet-3">xsFacet</a> and an <a class="objref .shexj internalDFN" href="#dfn-xsfacet" data-link-type="dfn" id="ref-for-dfn-xsfacet-4">xsFacet</a> is either a <a class="objref .shexj internalDFN" href="#dfn-stringfacet" data-link-type="dfn" id="ref-for-dfn-stringfacet-2">stringFacet</a> or a <a class="objref .shexj internalDFN" href="#dfn-numericfacet" data-link-type="dfn" id="ref-for-dfn-numericfacet-2">numericFacet</a>.
      </p>
        <div class="note" role="note" id="issue-container-generatedID"><div role="heading" class="note-title marker" id="h-note" aria-level="4"><span>Note</span><!---0.294583%--></div><p class="">
          The <a href="https://github.com/shexSpec/shexTest/blob/main/doc/ShExJ.jsg#L11">executable JSON grammar for ShExJ</a> specifically disables the requirement for a matching <code>"type"</code> attribute in <code>ObjectLiteral</code> as <code>"type"</code> is instead used for the datatype of a <a href="https://www.w3.org/TR/json-ld11/#dfn-typed-value">JSON-LD typed value</a>.
        </p></div>
      </section>

      <section id="shex-references"><div class="header-wrapper"><h3 id="x5-2-references">References</h3></div>
        
        <p>
          <a href="#dfn-shexj" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexj-5">ShExJ</a> is a dialect of JSON-LD [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD<!---0.294583%--></a></cite><!---0.294583%-->] and the member <dfn class="param" id="dfn-id" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">id</dfn> is used as a <a data-cite="JSON-LD#node-identifiers" href="https://www.w3.org/TR/json-ld/#node-identifiers">node identifier</a>.
          An ShapeDecl or tripleExpr may be represented inline or referenced by its <span class="param">id</span> which may be either a <a data-cite="rdf11-concepts#dfn-blank-node" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node">blank node</a> or an <a data-cite="rdf11-concepts#dfn-iri" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri">IRI</a>.
        </p>
        <div class="shexj simupre"><a class="obj internalDFN" href="#dfn-shapeor" data-link-type="dfn" id="ref-for-dfn-shapeor-3">ShapeOr</a>         { <a class="param internalDFN" href="#dfn-id" data-link-type="dfn" id="ref-for-dfn-id-1">id</a>:<a class="nobjref internalDFN" href="#dfn-shapeexprlabel" data-link-type="dfn" id="ref-for-dfn-shapeexprlabel-1">shapeExprLabel</a>? <a class="param internalDFN" href="#dfn-shapeexprs" data-link-type="dfn" id="ref-for-dfn-shapeexprs-1">shapeExprs</a>:[<a class="nobjref internalDFN" href="#dfn-shapeexpr" data-link-type="dfn" id="ref-for-dfn-shapeexpr-7">shapeExpr</a>{2,}] }
<a class="nob internalDFN" href="#dfn-shapeexprlabel" data-link-type="dfn" id="ref-for-dfn-shapeexprlabel-2">shapeExprLabel</a>  = <a class="nobref internalDFN" href="#dfn-iriref" data-link-type="dfn" id="ref-for-dfn-iriref-1">IRIREF</a> | <a class="objref internalDFN" href="#dfn-bnode" data-link-type="dfn" id="ref-for-dfn-bnode-1">BNODE</a> ;
<a class="obj internalDFN" href="#dfn-eachof" data-link-type="dfn" id="ref-for-dfn-eachof-1">EachOf</a>          { <a class="param internalDFN" href="#dfn-id" data-link-type="dfn" id="ref-for-dfn-id-2">id</a>:<a class="nobjref internalDFN" href="#dfn-tripleexprlabel" data-link-type="dfn" id="ref-for-dfn-tripleexprlabel-1">tripleExprLabel</a>? <a class="param internalDFN" href="#dfn-expressions" data-link-type="dfn" id="ref-for-dfn-expressions-1">expressions</a>:[<a class="nobjref internalDFN" href="#dfn-tripleexpr" data-link-type="dfn" id="ref-for-dfn-tripleexpr-1">tripleExpr</a>{2,}] ... }
<a class="nob internalDFN" href="#dfn-tripleexprlabel" data-link-type="dfn" id="ref-for-dfn-tripleexprlabel-2">tripleExprLabel</a> = <a data-cite="rdf11-concepts#dfn-iri" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri">IRI</a> | <a href="#dfn-bnode" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bnode-2">BNODE</a> ;</div>
        <p>
          The JSON structure may include references to <a data-lt="shape" href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-3">shape expressions</a> and <a href="#dfn-triple-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-triple-expressions-1">triple expressions</a>:
        </p>
        <div class="shexj simupre"><a class="obj internalDFN" href="#dfn-shapeexpr" data-link-type="dfn" id="ref-for-dfn-shapeexpr-8">shapeExpr</a>     = <a class="objref internalDFN" href="#dfn-shapeor" data-link-type="dfn" id="ref-for-dfn-shapeor-4">ShapeOr</a> | ... | <a class="nobjref internalDFN" href="#dfn-shapeexprref" data-link-type="dfn" id="ref-for-dfn-shapeexprref-1">shapeExprRef</a> ;
<a class="nob internalDFN" href="#dfn-shapeexprref" data-link-type="dfn" id="ref-for-dfn-shapeexprref-2">shapeExprRef</a>  = <a class="nobjref internalDFN" href="#dfn-shapeexprlabel" data-link-type="dfn" id="ref-for-dfn-shapeexprlabel-3">shapeExprLabel</a> ;
<a class="nobjref internalDFN" href="#dfn-tripleexpr" data-link-type="dfn" id="ref-for-dfn-tripleexpr-2">tripleExpr</a>    = <a class="objref internalDFN" href="#dfn-eachof" data-link-type="dfn" id="ref-for-dfn-eachof-2">EachOf</a> | ... | <a class="nobjref internalDFN" href="#dfn-tripleexprref" data-link-type="dfn" id="ref-for-dfn-tripleexprref-1">tripleExprRef</a> ;
<a class="nob internalDFN" href="#dfn-tripleexprref" data-link-type="dfn" id="ref-for-dfn-tripleexprref-2">tripleExprRef</a> = <a class="objref internalDFN" href="#dfn-tripleexprlabel" data-link-type="dfn" id="ref-for-dfn-tripleexprlabel-3">tripleExprLabel</a> ;</div>
        <p>
          An object with a circular reference must be referenced by an <span class="param">id</span>.
          This example uses a nested shape reference on a value expression (<a data-lt="TripleConstraint" href="#dfn-tripleconstraint" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleconstraint-1">defined below</a>).
        </p>
        <div class="json">
          <pre class="json nohighlight">{ "type": "Schema", "shapes": [
    { "id": "<span class="lookit">http://schema.example/#IssueShape</span>",
      "type": "Shape", "expression": {
        "type": "TripleConstraint", "predicate": "http://schema.example/#related",
        "valueExpr": "<span class="lookit">http://schema.example/#IssueShape</span>", "min": 0 } } ] }</pre>
        </div>
        <p>
          Not captured in this JSON syntax definition is the rule that every <a class="nobjref internalDFN" href="#dfn-shapeexpr" data-link-type="dfn" id="ref-for-dfn-shapeexpr-9">shapeExpr</a> nested in a schema's <a class="param internalDFN" href="#dfn-shapes" data-link-type="dfn" id="ref-for-dfn-shapes-3">shapes</a> must have an <span class="param">id</span> and no other <a class="nobjref internalDFN" href="#dfn-shapeexpr" data-link-type="dfn" id="ref-for-dfn-shapeexpr-10">shapeExpr</a> may have an <span class="param">id</span>.
          The JSON syntax definitition simplifies this by adding <span style="border: thin solid #888888; background-color: #F8F8F0;"><a class="param internalDFN" href="#dfn-id" data-link-type="dfn" id="ref-for-dfn-id-3">id</a>:<a class="nobjref internalDFN" href="#dfn-shapeexprlabel" data-link-type="dfn" id="ref-for-dfn-shapeexprlabel-4">shapeExprLabel</a>?</span> to every <a class="nobjref internalDFN" href="#dfn-shapeexpr" data-link-type="dfn" id="ref-for-dfn-shapeexpr-11">shapeExpr</a>.
          This example includes a nested shape. Nested shapes are not permitted to have <span class="param">ids</span>.
        </p>
        <div class="json">
          <pre class="json nohighlight">{ "type": "Schema", "shapes": [
    { "id": "http://schema.example/#IssueShape",
      "type": "Shape", "expression": {
        "type": "TripleConstraint", "predicate": "http://schema.example/#submittedBy",
        "valueExpr": {
          "type": "Shape", "expression": {
            "type": "TripleConstraint", "predicate": "http://schema.example/#name",
            "valueExpr": {
              "type": "NodeConstraint", "nodeKind": "literal"
            } } } } } ] }</pre>
        </div>
      </section>
      <section id="style"><div class="header-wrapper"><h3 id="x5-3-document-style">Document style</h3></div>
        
        <p>
          JSON examples are rendered in a <span class="json">.json</span> CSS style.
          Partial examples include ranges in a <span class="comment">.comment</span> CSS style to indicate text which would be substituted in a complete example.
          For example  <span class="json">{ "type": "ShapeAnd", "shapeExprs": [ <span class="comment">SE<sub>1</sub></span>, <span class="comment">…</span> ] }</span> indicates that both <span class="comment">SE<sub>1</sub></span> and <span class="comment">…</span> would be substituted in a complete example.
        </p>
        
      <!--div class="issue">
        <p id="json-triples">
          When stable, consider switching to the rdfjs task force's <a href="https://github.com/rdfjs/representation-task-force/blob/master/interface-spec.md#term">JSON representation</a> i.e.
        </p>
        <ul>
          <li>IRI: <code class="json">{ "termType": "NamedNode", "value": "http://example.org/resource" }</code></li>
          <li>blank node: <code class="json">{ "termType": "BlankNode", "value": "blank3" }</code></li>
          <li>literal:
          <ul>
            <li>literal with type <code>http://www.w3.org/2001/XMLSchema#</code>: <code class="json">{ "termType": "Literal", "value": "abc" }</code></li>
            <li><a>language-tagged string</a>: <code class="json">{ "termType": "Literal", "value": "hello world", "language": "en-us", "datatype": "http://www.w3.org/1999/02/22-rdf-syntax-ns#langString" }</code></li>
            <li>datatyped literal: <code class="json">{ "termType": "Literal", "value": "123", "language": "", "datatype": "http://www.w3.org/1999/02/22-rdf-syntax-ns#integer" }</code></li>
          </ul></li>
        </ul>
      </div-->
      </section>
      <section id="graphAccess"><div class="header-wrapper"><h3 id="x5-4-graph-access">Graph access</h3></div>
        
      <p>
        The validation process defined in this document relies on matching <a data-cite="sparql11-query#defn_TriplePattern" data-link-type="dfn" href="https://www.w3.org/TR/sparql11-query/#defn_TriplePattern">triple patterns</a> in the form <code>(subject, predicate, object)</code> where each position may be supplied by a constant, a previously defined term, or the underscore "<code>_</code>", which represents a previously undefined element or wildcard.
        This corresponds to a <dfn data-cite="sparql11-query#defn_TriplePattern" data-lt="triple pattern|triple patterns" id="dfn-triple-pattern" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://www.w3.org/TR/sparql11-query/#defn_TriplePattern" data-cite="sparql11-query" data-cite-path="" data-cite-frag="#defn_TriplePattern">SPARQL Triple Pattern</a></dfn> where each "_" is replaced by a unique <a data-cite="rdf11-concepts#dfn-blank-node" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node">blank node</a>.
        Matching such a <a data-cite="sparql11-query#defn_TriplePattern" data-link-type="dfn" href="https://www.w3.org/TR/sparql11-query/#defn_TriplePattern">triple pattern</a> against a <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">graph</a> is defined by <a data-cite="sparql11-query#BGPsparql" href="https://www.w3.org/TR/sparql11-query/#BGPsparql">SPARQL Basic Graph Pattern Matching</a> (BGP) with a BGP containing only that <a data-cite="sparql11-query#defn_TriplePattern" data-link-type="dfn" href="https://www.w3.org/TR/sparql11-query/#defn_TriplePattern">triple pattern</a>.
      </p>
      </section>
      <!-- button id="toggleRDF">Toggle RDF ("r")</button> <button id="toggleExamples">Toggle Examples ("e")</button> <button id="toggleSquished">Render only abstract syntax ("a")</button -->

      <section id="namespaces"><div class="header-wrapper"><h3 id="x5-5-namespaces">Namespaces</h3></div>
        

        <p>This specification makes use of the following namespaces:</p>
        <dl>
          <dt><code>foaf</code>:</dt>
          <dd><code>http://xmlns.com/foaf/0.1/</code></dd>
          <dt><code>rdf</code>:</dt>
          <dd><code>http://www.w3.org/1999/02/22-rdf-syntax-ns#</code></dd>
          <dt><code>rdfs</code>:</dt>
          <dd><code>http://www.w3.org/2000/01/rdf-schema#</code></dd>
          <dt><code>shex</code>:</dt>
          <dd><code>http://www.w3.org/ns/shex#</code></dd>
          <dt><code>xsd</code>:</dt>
          <dd><code>http://www.w3.org/2001/XMLSchema#</code></dd>
        </dl>
        </section>
      <!-- <p> -->
      <!--   The following HTML tags and CSS classes are used to highlight the roles of text in this document: -->
      <!-- </p> -->
      <!-- <ul> -->
      <!--   <li>&lt;dfn&gt;<dfn data-lt="dfn-shacl-defined-term">defined term</dfn>&lt;dfn&gt;</li> -->
      <!--   <li>&lt;a class="internalDFN"&gt;<a title="SHACL defined term" class="internalDFN">defined term</a>&lt;/a&gt;</li> -->
      <!--   <li><sup class="eval">eval</sup> &mdash; link to evaluation semantics</li> -->
      <!-- </ul> -->
    </section>

    <section id="shapes-language"><!--OddPage--><div class="header-wrapper"><h2 id="x6-the-shape-expressions-language">The Shape Expressions Language</h2></div>
      
      <p>
        A Shape Expressions (ShEx) schema is a collection of labeled <a data-lt="shape" href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-4">Shapes</a> and <a href="#node-constraints">Node Constraints</a>.
        These can be used to describe or test nodes in <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">RDF graphs</a>.
        ShEx does not prescribe a language for associating <a data-cite="rdf11-concepts#dfn-node" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-node">nodes</a> with <a data-lt="shape" href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-5">shapes</a> but several approaches are <a href="../primer/index.html#associating-nodes-with-shapes">described in the ShEx Primer</a>.
      </p>

      <section id="shapes-schema"><div class="header-wrapper"><h3 id="x6-1-shapes-schema">Shapes Schema</h3></div>
      
      <p>
        A shapes schema is captured in a <span class="jobjref"><dfn data-lt="shapes schema|Schema" id="dfn-shapes-schema" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Schema</dfn></span> object with a list of <span class="jobjref"><dfn data-lt="ShapeDecl|Shape Declarationss" data-plurals="shapedecls" id="dfn-shapedecl" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Shape Declarationss</dfn></span>:
      </p>
      <div class="shexjTable">
        <pre>   <b>Schema</b> { "@context":"http://www.w3.org/ns/shex.jsonld"? import:[IRIREF+]?       
         <b></b> &nbsp; startActs:[SemAct+]? start:shapeExpr? shapes:[ShapeDecl+]? }           
<b>ShapeDecl</b> {  id:shapeExprLabel abstract:BOOL? shapeExpr:shapeExpr | ShapeExternal }</pre>
      </div>
      <p>
        where <a class="param internalDFN" href="#dfn-shapes" data-link-type="dfn" id="ref-for-dfn-shapes-4">shapes</a> is a list of <a href="#dfn-shapedecl" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapedecl-3">ShapeDecls</a>.
      </p>
      <div class="repchoice incomplete" tabindex="0">
        <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
  { "id": "http://schema.example/#IssueShape", … },
  { "id": "_:UserShape", … },
  { "id": "http://schema.example/#EmployeeShape", … } ] }</pre>
        
      </div>
      </section>

      <section id="validation"><div class="header-wrapper"><h3 id="x6-2-validation-definition">Validation Definition</h3></div>
      

      <p>
        For a graph <span class="math">G</span>, a schema  <span class="math">Sch</span> and a fixed input <a href="#dfn-shapemap" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapemap-2">ShapeMap</a> <span class="math">ism</span>, <code class="function"><dfn id="dfn-isvalid" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">isValid</dfn>(<span class="math">G</span>, <span class="math">Sch</span>, <span class="math">ism</span>)</code> indicates that for every shape association <span class="math">(<span class="param">node</span>: n, <span class="param">shape</span>: sl, <span class="param">exact</span>: exact)</span> in <span class="math">ism</span>, the node <span class="math">n</span> satisfies the shape expression identified by <span class="math">sl</span>.
        If <span class="param">exact</span> is true, the result is
        <code class="function"><a href="#dfn-satisfies" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-satisfies-1">satisfies</a>(<span class="math">n</span>,  <a href="#dfn-def" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-def-1">def</a>(<span class="math">s.label</span>), <span class="math">G</span>, <span class="math">Sch</span>, <a href="#dfn-completetyping" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-completetyping-1"><code>completeTyping</code></a>(<span class="math">G</span>, <span class="math">Sch</span>), <span class="math">neigh(n)</span>)</code>
        , otherwise, the result is
        <code class="function"><a href="#dfn-satisfiesdescendant" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-satisfiesdescendant-1">satisfiesDescendant</a>(<span class="math">n</span>, <a href="#dfn-def" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-def-2">def</a>(<span class="math">s.label</span>), <span class="math">G</span>, <span class="math">Sch</span>, <a href="#dfn-completetyping" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-completetyping-2"><code>completeTyping</code></a>(<span class="math">G</span>, <span class="math">Sch</span>)</code>, <span class="math">neigh(n)</span>).
	The function <code class="function"><a href="#dfn-satisfies" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-satisfies-2">satisfies</a></code>  is defined for every kind of <a href="#dfn-shape-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-expressions-1">shape expression</a>.
      </p>

      
      <p>
	The validation of an RDF graph <span class="math">G</span> against a ShEx schema <span class="math">Sch</span> is based on the existence of <code class="function"><a href="#dfn-completetyping" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-completetyping-3"><code>completeTyping</code></a>(<span class="math">G</span>, <span class="math">Sch</span>)</code>.
	For an RDF graph <span class="math">G</span> and a shapes schema <span class="math">Sch</span>, a <dfn id="dfn-typing" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">typing</dfn> is a set of pairs of the form <span class="math">(n, l)</span> where <span class="math">n</span> is a node in <span class="math">G</span> and <span class="math">l</span> is a shape label that appears in the shape declarations of the schema. 
  A <dfn label="correct typing" id="dfn-correct-typing" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">correct typing</dfn> is a <span class="math">typing</span> such that for every RDF node/shape pair <span class="math">(n,l)</span>, satisfies(n, def(l), G, Sch, typing, neigh(n)) holds or satisfiesDescendant(n, def(l), G, Sch, typing, neigh(n)) holds.
  A <code class="function"><a href="#dfn-completetyping" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-completetyping-4"><code>completeTyping</code></a>(<span class="math">G</span>, <span class="math">Sch</span>)</code> is a unique correct typing that exists for every graph and every ShEx schema that satisfies the <a href="#schema-requirements">schema requirements</a>.
      </p>

      <p>
	The definition of <code class="function"><dfn id="dfn-completetyping" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">completeTyping</dfn>(<span class="math">G</span>, <span class="math">Sch</span>)</code> is based on a <a href="#dfn-stratification" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-stratification-1">stratification</a> of <span class="math">Sch</span>.
	
	The number of <dfn id="dfn-strata" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">strata</dfn> of <span class="math">Sch</span> is the number of maximal strongly connected components of the <a href="#dfn-hierarchy-and-dependency-graph" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hierarchy-and-dependency-graph-1">hierarchy and dependency graph</a> of <span class="math">Sch</span>.
	A <dfn id="dfn-stratification" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">stratification</dfn> of a schema <span class="math">Sch</span> with <span class="math">k</span> strata is a function <code class="function">stratum</code> that associates with every shape label from the shape declarations of <span class="math">Sch</span> a natural number between <span class="math">1</span> and <span class="math">k</span> such that:
      </p>
      <ul>
	<li>
	  If <span class="math">l1</span> and <span class="math">l2</span> belong to the same maximal strongly connected component, then <code class="function">stratum(<span class="math">l1</span>)</code> = <code class="function">stratum(<span class="math">l2</span>)</code>.
	</li>
	<li>
	  If there is a <a class="respec-offending-element" title="Linking error: not matching `&lt;dfn&gt;`" id="respec-offender-linking-error-not-matching-dfn">reference</a> from <span class="math">l1</span> to <span class="math">l2</span> and <span class="math">l1</span> and <span class="math">l2</span> do not belong to the same maximal strongly connected component, then <code class="function">stratum(<span class="math">s2</span>)</code> &lt; <code class="function">stratum(<span class="math">s1</span>)</code>.
	</li>
      </ul>
      <p>
	The existence of a stratification for every schema is guaranteed by the <a href="#negation-requirement">negation requirement</a>.
      </p>

      
      <p>
	Given a <a href="#dfn-stratification" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-stratification-2">stratification</a> <code class="function">stratum</code> of <span class="math">Sch</span> with <span class="math">k</span> strata, define inductively the series of <span class="math">k</span> typings <code class="function">completeTypingOn(<span class="math">1</span>, <span class="math">G</span>, <span class="math">Sch</span>)</code> … <code class="function">completeTypingOn(<span class="math">k</span>, <span class="math">G</span>, <span class="math">Sch</span>)</code>.
      </p>
      <ul>
	<li>
	  <code class="function">completeTypingOn(<span class="math">1</span>, <span class="math">G</span>, <span class="math">Sch</span>)</code> is the union of all correct typings that contain only RDF node/shape pairs <span class="math">(n,s)</span> with <code class="function">stratum(<span class="math">s</span>)</code> = <span class="math">1</span>;
	</li>
	<li>
	  for every <span class="math">i</span> between <span class="math">2</span> and <span class="math">k</span>, <code class="function">completeTypingOn(<span class="math">i</span>, <span class="math">G</span>, <span class="math">Sch</span>)</code> is the union of all correct typings that:
	  <ul>
	    <li> contain only RDF node/shape pairs <span class="math">(n,s)</span> with <code class="function">stratum(<span class="math">s</span>)</code> ≤ <span class="math">i</span>
	    </li>
	    <li> are equal to <code class="function">completeTypingOn(<span class="math">i</span>-1, <span class="math">G</span>, <span class="math">Sch</span>)</code> when restricted to their RDF node/shape pairs <span class="math">(n1,s1)</span> for which <code class="function">stratum(<span class="math">s1</span>)</code> &lt; i.
	    </li>
	  </ul>
	</li>
      </ul>
      <p>
	Then <code class="function">completeTyping(<span class="math">G</span>, <span class="math">Sch</span>)</code> = <code class="function">completeTypingOn(<span class="math">k</span>, <span class="math">G</span>, <span class="math">Sch</span>)</code>.
      </p>

      <div class="note" role="note" id="issue-container-generatedID-0"><div role="heading" class="note-title marker" id="h-note-0" aria-level="4"><span>Note</span><!---0.294583%--></div><div class="">
	The definition of strongly connected component and maximal strongly connected component of a graph can be found at Wikipedia: <a href="https://en.wikipedia.org/wiki/Strongly_connected_component">https://en.wikipedia.org/wiki/Strongly_connected_component</a>.
      </div></div>
      
      <div class="note" role="note" id="issue-container-generatedID-1"><div role="heading" class="note-title marker" id="h-note-1" aria-level="4"><span>Note</span><!---0.294583%--></div><div class="">
	<p>
	  The schema <span class="math">Sch</span> might have several different stratifications but <code class="function">completeTyping(<span class="math">G</span>, <span class="math">Sch</span>)</code> is the same for all these stratifications.
	  This property is reminiscent of the use of stratified negation in Datalog.
	</p>
	<p>
	  In order to decide <code class="function"><a href="#dfn-isvalid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-isvalid-1"><code>isValid</code></a>(<span class="math">Sch</span>, <span class="math">G</span>, <span class="math">m</span>)</code>, it is sufficient to compute only a portion of the complete typing using an appropriate algorithm.
	</p>
      </div></div>
      <div class="note" role="note" id="issue-container-generatedID-2"><div role="heading" class="note-title marker" id="h-note-2" aria-level="4"><span>Note</span><!---0.294583%--></div><div class="">
	<p>
	  Popular methods for constructing the input fixed ShapeMaps can be found at <a href="https://www.w3.org/2001/sw/wiki/ShEx/ShapeMap">https://www.w3.org/2001/sw/wiki/ShEx/ShapeMap</a>.
      </p>

      </div></div>

<!--
      <div class="note">
      <p>
  Validation of a <a>graph</a> <span class="math">G</span> does not necessarily require the construction of a <a>ShapeMap</a> with every node in <span class="math">G</span>.
  The validation semantics defined below imply a set of dependencies for validating some node as a shape.
  A validation process that tests every <a>node</a> in a <a>graph</a> against every <a>shape</a> in a <a>schema</a> can be considered to have an input <a>ShapeMap</a> associating each node with the set of all shapes in the schema.
      </p>
      </div>

      <p>
        Validation of a node against a shape in a schema requires that there is a consistent mapping from node to <!-\- @@set of -\-> shape for every node and shape visited during a validation process.
        The remainder of this document uses <span class="math">m</span> to indicate such a mapping.
      </p>
-->
      </section>

      <section id="shape-expressions"><div class="header-wrapper"><h3 id="x6-3-shape-expressions">Shape Expressions</h3></div>
        
        <p>
          A <dfn data-lt="shape expressions|shape expression" id="dfn-shape-expressions" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">shape expression</dfn> is composed of four kinds of objects combined with the algebraic operators <code>And<!---0.294583%--></code>, <code>Or<!---0.294583%--></code> and <code>Not<!---0.294583%--></code>:
        </p>
        <ul>
          <li>
            A node constraint (<span class="jobjref"><a href="#dfn-nodeconstraint" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-nodeconstraint-3">NodeConstraint</a></span>) defines the set of allowed values of a node.
            These include specification of RDF node kind, literal datatype, XML string and numeric facets and enumeration of value sets.
          </li>
          <li>
            A shape constraint (<span class="jobjref"><a href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-6">Shape</a></span>) defines a constraint on the allowed neighbourhood of a node, that is, the allowed triples that contain this node as subject or object.
          </li>
          <li>
            An external shape (<span class="jobjref"><a href="#dfn-shapeexternal" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexternal-3">ShapeExternal</a></span>) is an extension mechanism allowing a <span class="jobjref"><a href="#dfn-shapedecl" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapedecl-4">ShapeDecl</a></span> to denote an externally defined <span class="jobjref"><a href="#dfn-shapeexpr" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexpr-14">shapeExpr</a></span>. <span class="note">It can be used to reference e.g. functional shapes or prohibitively large value sets.</span>
          </li>
          <li>
            A shape reference (<span class="jobjref"><a href="#dfn-shapeexprlabel" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexprlabel-6">shapeExprLabel</a></span>) identifies another shape in the schema or an <a href="#import">imported schema</a>.
          </li>
        </ul>

        <section id="shape-expressions-shexj"><div class="header-wrapper"><h4 id="x6-3-1-json-syntax">JSON Syntax</h4></div>
          

      <div class="shexjTable">
        <pre>     <b>shapeExpr</b> = ShapeOr | ShapeAnd | ShapeNot | NodeConstraint | Shape | shapeExprRef ;
       <b>ShapeOr</b> { shapeExprs:[shapeExpr{2,}] }                                           
      <b>ShapeAnd</b> { shapeExprs:[shapeExpr{2,}] }                                           
      <b>ShapeNot</b> { shapeExpr:shapeExpr }                                                  
 <b>ShapeExternal</b> { }                                                                      
  <b>ShapeExprRef</b> { label:shapeExprLabel exact:BOOL? }                                     
<b>shapeExprLabel</b> = IRIREF | BNODE ;                                                       </pre>
      </div>
      <div class="example">
  <p>
    Examples of shape expressions:
  </p>

  <div class="repchoice incomplete" tabindex="0">
    <pre class="json nohighlight repchosen">{ "type": "Shape", … }   &nbsp;</pre>
    
  </div>
  <div style="clear:both;">&nbsp;</div>
  <div class="repchoice incomplete" tabindex="0">
    <pre class="json nohighlight repchosen">{ "type": "ShapeAnd", "shapeExprs": [
  { "type": "NodeConstraint", "nodeKind": "iri" },
  { "type": "ShapeOr", "shapeExprs": [
    "http://schema.example/#IssueShape",
    { "type": "ShapeNot", "shapeExpr": { "type": "Shape", … } }
    ] } ] }</pre>
    
  </div>
  <p>
    In this ShapeOr's <span class="param">shapeExprs</span>, "http://schema.example/#IssueShape" is a reference to the <a href="#dfn-shape-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-expressions-2">shape expression</a> with the id "http://schema.example/#IssueShape".
  </p>
      </div>
	</section>
      <section id="shape-expression-semantics"><div class="header-wrapper"><h4 id="x6-3-2-semantics">Semantics</h4></div>
        
        <p>
          For a node n of the graph G, <span class="math"><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-4">neigh</a>(G, n)</span> is the set of triples in <var>G<!---0.294583%--></var> that have <var>n<!---0.294583%--></var> either as subject or as object.
        </p>
      <p>
	For a shape expression <span class="var">se</span> we define its set of shapes <dfn id="dfn-nestedshapes" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">nestedShapes</dfn><span class="math">(<span class="param">se</span>)</span> recursively on the structure of <span class="var">se</span>:
      </p>
      <ul>
	<li>if <span class="var">se</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-nodeconstraint" data-link-type="dfn" id="ref-for-dfn-nodeconstraint-5">NodeConstraint</a></span>, then <span class="math"><a href="#dfn-nestedshapes" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-nestedshapes-1">nestedShapes</a>(<span class="var">se</span>) = emptyset</span></li>
	<li>if <span class="var">se</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-shape" data-link-type="dfn" id="ref-for-dfn-shape-8">Shape</a></span>, then <span class="math"><a href="#dfn-nestedshapes" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-nestedshapes-2">nestedShapes</a>(<span class="var">se</span>) = {se}</span></li>
	<li>if <span class="var">se</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-shapenot" data-link-type="dfn" id="ref-for-dfn-shapenot-3">ShapeNot</a></span>, then <span class="math"><a href="#dfn-nestedshapes" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-nestedshapes-3">nestedShapes</a>(<span class="var">se</span>) = shapes(se.shapeExpr)</span></li>
	<li>if <span class="var">se</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-shapeand" data-link-type="dfn" id="ref-for-dfn-shapeand-4">ShapeAnd</a></span> or <span class="jobjref"><a class="obj internalDFN" href="#dfn-shapeor" data-link-type="dfn" id="ref-for-dfn-shapeor-6">ShapeOr</a></span>, then <span class="math"><a href="#dfn-nestedshapes" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-nestedshapes-4">nestedShapes</a>(<span class="var">se</span>)</span> is the union of the sets <span class="math"><a href="#dfn-nestedshapes" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-nestedshapes-5">nestedShapes</a>(<span class="var">se2</span>)</span> for all <span class="var">se2</span> in <span class="param">se.shapeExprs</span></li>
	<li>if <span class="var">se</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-shapeexprref" data-link-type="dfn" id="ref-for-dfn-shapeexprref-4">shapeExprRef</a></span> with label <span class="var">lab</span>, then <span class="math"><a href="#dfn-nestedshapes" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-nestedshapes-6">nestedShapes</a>(<span class="var">se</span>) = <a href="#dfn-nestedshapes" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-nestedshapes-7">nestedShapes</a>(<a href="#dfn-def" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-def-3">def</a>(<span class="var">L</span>))</span></li>
	<li>if <span class="var">se</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-shapeexternal" data-link-type="dfn" id="ref-for-dfn-shapeexternal-4">ShapeExternal</a></span>, then <span class="math"><a href="#dfn-nestedshapes" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-nestedshapes-8">nestedShapes</a>(<span class="var">se</span>)</span> is the set of shapes denoted by <span class="var">se</span>. </li>
      </ul>
      <p>
	For shape expression labels <span class="var">label1</span>, <span class="var">label2</span>, we say that <span class="var">label2</span> <dfn id="dfn-directly-extends" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">directly extends</dfn> <span class="var">label1</span> if <span class="math"><a href="#dfn-nestedshapes" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-nestedshapes-9">nestedShapes</a>(<a href="#dfn-def" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-def-4">def</a>(<span class="var">label2</span>))<span class="math"> contains a Shape <span class="var">s</span> such that <span class="param">s.extends</span> contains <span class="var">label2</span>.
            The <dfn id="dfn-extension-hierarchy-graph" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">extension hierarchy graph</dfn> of a shapes schema is a directed graph whose nodes are the shape expression labels of the schema and that has an edge from <span class="var">label2</span> to <span class="var">label1</span> whenever <span class="var">label2</span> <a href="#dfn-directly-extends" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-directly-extends-1">directly extends</a> <span class="var">label1</span>. 
      </span></span></p>
      <p>
        <dfn id="dfn-satisfies" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">satisfies</dfn>: The expression <code class="function">satisfies(<span class="math">n</span>, <span class="math">se</span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">t</span>, <span class="math">R</span>)</code> indicates that a node <span class="math">n</span>, a subset <span class="math">R</span> of <span class="math">neigh(n)</span>, and a <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">graph</a> <span class="math">G</span> satisfy a <a href="#dfn-shape-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-expressions-3">shape expression</a> <span class="math">se</span> with <a href="#dfn-typing" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-typing-1">typing</a> <span class="math">t</span> for schema <span class="math">Sch</span>.<br>
        <dfn id="dfn-satisfiesdescendant" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">satisfiesDescendant</dfn>: The expression <code class="function">satisfiesDescendant(<span class="math">n</span>, <span class="var">shapeExprLabel</span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">t</span>, <span class="math">R</span>)</code> indicates that <span class="math">n</span>, a subset <span class="math">R</span> of <span class="math">neigh(n)</span>, and <span class="math">G</span> and some non-abstract <span class="var">child</span> of <span class="var">shapeExprLabel</span> in the <a href="#dfn-extension-hierarchy-graph" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-extension-hierarchy-graph-1">extension hierarchy graph</a> <code class="function"><a href="#dfn-satisfies" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-satisfies-3">satisfies</a>(<span class="math">n</span>, <span class="var">child</span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">t</span>, <span class="math">R</span>)</code>, with the given <a href="#dfn-typing" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-typing-2">typing</a> <span class="math">t</span>.
      </p>
      <p>
        <code class="function"><a href="#dfn-satisfies" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-satisfies-4">satisfies</a>(<span class="math">n</span>, <span class="math">se</span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">t</span>, <span class="math">R</span>)</code> is true if and only if:
      </p>

      <ul>
        <li id="satisfies-NodeConstraint"><span class="math">se</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-nodeconstraint" data-link-type="dfn" id="ref-for-dfn-nodeconstraint-6">NodeConstraint</a></span> and <code class="function"><a href="#satisfies2-NodeConstraint">satisfies2</a>(<span class="math">n</span>, <span class="math">se</span>)</code> as described below in <a href="#node-constraints">Node Constraints</a>.
        Note that testing if a node satisfies a node constraint does not require a <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">graph</a> or <a href="#dfn-typing" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-typing-3">typing</a>.</li>
        <li id="satisfies-Shape-proxy"><span class="math">se</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-shape" data-link-type="dfn" id="ref-for-dfn-shape-9">Shape</a></span> and <code class="function"><a href="#dfn-matchesshape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-matchesshape-1"><code>matchesShape</code></a>(<span class="math">n</span>, <span class="math">S</span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">m</span>, <span class="math">R</span>)</code> is true.
	</li>
        <li id="satisfies-ShapeOr"><span class="math">se</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-shapeor" data-link-type="dfn" id="ref-for-dfn-shapeor-7">ShapeOr</a></span> and there is some <a href="#dfn-shape-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-expressions-4">shape expression</a> <span class="math">se2</span> in <span class="math">se</span>.<span class="param">shapeExprs</span> such that <code class="function"><a href="#dfn-satisfies" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-satisfies-5">satisfies</a>(<span class="math">n</span>, <span class="math">se2</span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">t</span>, <span class="math">R</span>)</code>.</li>
        <li id="satisfies-ShapeAnd"><span class="math">se</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-shapeand" data-link-type="dfn" id="ref-for-dfn-shapeand-5">ShapeAnd</a></span> and for every <a href="#dfn-shape-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-expressions-5">shape expression</a> <span class="math">se2</span> in <span class="math">se</span>.<span class="param">shapeExprs</span>, <code class="function"><a href="#dfn-satisfies" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-satisfies-6">satisfies</a>(<span class="math">n</span>, <span class="math">se2</span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">t</span>, <span class="math">R</span>)</code>.</li>
        <li id="satisfies-ShapeNot"><span class="math">se</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-shapenot" data-link-type="dfn" id="ref-for-dfn-shapenot-4">ShapeNot</a></span> and for the <a href="#dfn-shape-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-expressions-6">shape expression</a> <span class="math">se2</span> at <span class="math">se</span>.<span class="param">shapeExpr</span>, <code class="function"><a href="#dfn-satisfies" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-satisfies-7">satisfies</a>(<span class="math">n</span>, <span class="math">se2</span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">t</span>, <span class="math">R</span>)</code> is false.</li>
        <li id="satisfies-ShapeExternal"><span class="math">se</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-shapeexternal" data-link-type="dfn" id="ref-for-dfn-shapeexternal-5">ShapeExternal</a></span> and implementation-specific mechansims not defined in this specification indicate success.</li>
        <li id="satisfies-shapeExprRef"><span class="math">se</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-shapeexprref" data-link-type="dfn" id="ref-for-dfn-shapeexprref-5">ShapeExprRef</a></span>. If <span class="param">ShapeExprRef.exact</span>, <code class="function"><a href="#dfn-satisfies" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-satisfies-8">satisfies</a>(<span class="math">n</span>, <a href="#dfn-def" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-def-5">def</a>(<span class="math">se.label</span>), <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">t</span>, <span class="math">R</span>)</code>, otherwise <code class="function"><a href="#dfn-satisfiesdescendant" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-satisfiesdescendant-2">satisfiesDescendant</a>(<span class="math">n</span>, <span class="math">se.label</span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">t</span>, <span class="math">R</span>)</code>.
	</li>
      </ul>

      <div class="example">
  <p>
    Given the three shape expressions <span class="math">SE<sub>1</sub></span>, <span class="math">SE<sub>2</sub></span>, <span class="math">SE<sub>3</sub></span> in a <span class="jobjref"><a class="obj internalDFN" href="#dfn-shapes-schema" data-link-type="dfn" id="ref-for-dfn-shapes-schema-4">Schema</a></span> <span class="math">Sch</span>, such that:
  </p>
  <ul>
    <li><code class="function"><a href="#dfn-satisfies" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-satisfies-9">satisfies</a>(<span class="math">n</span>, <span class="math">SE<sub>1</sub></span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">m</span>)</code></li>
    <li><code class="function"><a href="#dfn-satisfies" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-satisfies-10">satisfies</a>(<span class="math">n</span>, <span class="math">SE<sub>2</sub></span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">m</span>)</code></li>
    <li>NOT <code class="function"><a href="#dfn-satisfies" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-satisfies-11">satisfies</a>(<span class="math">n</span>, <span class="math">SE<sub>3</sub></span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">m</span>)</code></li>
  </ul>
  <p>
    the following hold:
  </p>

  <ul class="codelist">
    <li><div><div style="float:left;" class="code function">satisfies(</div><div style="float:left;" class="code"><span class="math">n</span>,<br><div class="inline json"><pre aria-busy="false"><code class="hljs css">{ "type": <span class="hljs-string">"ShapeAnd"</span>, <span class="hljs-string">"shapeExprs"</span>: [ SE1, SE2 ] }</code></pre></div>,<br> <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">m</span>)</div><div style="clear:both;"></div></div></li>
    <li><div><div style="float:left;" class="code function">satisfies(</div><div style="float:left;" class="code"><span class="math">n</span>,<br><div class="inline json"><pre aria-busy="false"><code class="hljs css">{ "type": <span class="hljs-string">"ShapeOr"</span>, <span class="hljs-string">"shapeExprs"</span>: [ SE1, SE2, SE3 ] }</code></pre></div>,<br> <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">m</span>)</div><div style="clear:both;"></div></div></li>
    <li><div>NOT &nbsp;<div style="float:left;" class="code function">satisfies(</div><div style="float:left;" class="code"><span class="math">n</span>,<br><div class="inline json code"><pre aria-busy="false"><code class="hljs css">{ "type": <span class="hljs-string">"ShapeNot"</span>, <span class="hljs-string">"shapeExpr"</span>: {
    { "type": <span class="hljs-string">"ShapeOr"</span>, <span class="hljs-string">"shapeExprs"</span>: [
        SE1,
        { "type": <span class="hljs-string">"ShapeAnd"</span>, <span class="hljs-string">"shapeExprs"</span>: [ SE2, SE3 ] }
      ] }
  } }</code></pre></div>,<br> <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">m</span>)</div><div style="clear:both;"></div></div></li>
    </ul>

    <p>
      If <span class="math">Sch</span>'s <a class="param internalDFN" href="#dfn-shapes" data-link-type="dfn" id="ref-for-dfn-shapes-5">shapes</a> maps "<code>http://schema.example/#shape1</code>" to <span class="math">SE<sub>1</sub></span> then the following holds:
    </p>
  <ul class="codelist">
    <li><div><div style="float:left;" class="code function">satisfies(</div><div style="float:left;" class="code"><span class="math">n</span>,<br><div class="inline json"><pre aria-busy="false"><code class="hljs javascript"><span class="hljs-attr">http</span>:<span class="hljs-comment">//schema.example/#shape1"</span></code></pre></div>,<br> <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">m</span>)</div><div style="clear:both;"></div></div></li>
    </ul>
      </div>

      <div class="example">
        <p>
          In this example, EmployeeShape <a href="#dfn-directly-extends" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-directly-extends-2">directly extends</a> PersonShape and transitively extends EntityShape
        </p>
        <div class="repchoice" tabindex="0">
          <pre class="json nohighlight repchosen">{"type" : "Schema",
  "shapes" : [ {
    "id" : "http://schema.example/#EntityShape",
    "type" : "Shape",
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#entityId"
    }
  },  {
    "id" : "http://schema.example/#PersonShape",
    "type" : "Shape",
    "extends" : [ "http://schema.example/#EntityShape" ],
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://xmlns.com/foaf/0.1/name"
    }
  }, {
    "id" : "http://schema.example/#EmployeeShape",
    "type" : "Shape",
    "extends" : [ "http://schema.example/#PersonShape" ],
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#employeeNumber"
    }
  } ] }</pre>
          
        </div>

      </div>

      <div class="example">
        <p>
          In this example, UserShape <a href="#dfn-directly-extends" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-directly-extends-3">directly extends</a> PersonShape, and PersonShape directly references a conjunct which <a href="#dfn-directly-extends" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-directly-extends-4">directly extends</a> EntityShape. Through this, UserShape transitively extends EntityShape.
        </p>
        <div class="repchoice" tabindex="0">
          <pre class="json nohighlight repchosen">{ "type": "Schema",
  "shapes": [
    { "id": "http://schema.example/#EntityShape",
      "type": "Shape",
      "closed": true,
      "expression": {
        "type": "TripleConstraint",
        "predicate": "http://schema.example/#entityId"
    } },
    { "id": "http://schema.example/#PersonShape",
      "type": "ShapeAnd",
      "shapeExprs": [
        { "type": "Shape",
          "extends": [ "http://schema.example/#EntityShape" ],
          "closed": true,
          "expression": {
            "type": "TripleConstraint",
            "predicate": "http://xmlns.com/foaf/0.1/name"
        } },
        { "type": "Shape",
          "expression": {
            "type": "TripleConstraint",
            "predicate": "http://schema.example/#entityId",
            "valueExpr": {
              "type": "NodeConstraint",
              "datatype": "http://www.w3.org/2001/XMLSchema#integer"
        } } }
    ] },
    { "id": "http://schema.example/#UserShape",
      "type": "Shape",
      "extends": [ "http://schema.example/#PersonShape" ],
      "expression": {
        "type": "TripleConstraint",
        "predicate": "http://schema.example/#userId"
    } }
] }</pre>
          
        </div>

      </div>

      </section>
      </section>

      <section id="node-constraints"><div class="header-wrapper"><h3 id="x6-4-node-constraints">Node Constraints</h3></div>
        
        <div class="shexjTable">
          <pre>   <b>NodeConstraint</b> { nodeKind:("iri" | "bnode" | "nonliteral" | "literal")?               
                 <b></b> &nbsp; datatype:IRIREF? xsFacet* values:[valueSetValue+]? }                 
          <b>xsFacet</b> = stringFacet | numericFacet ;                                         
      <b>stringFacet</b> = (length|minlength|maxlength):INTEGER | pattern:STRING flags:STRING? ;
     <b>numericFacet</b> = (mininclusive|minexclusive|maxinclusive|maxexclusive):numericLiteral 
                 <b></b> | (totaldigits|fractiondigits):INTEGER ;                               
   <b>numericLiteral</b> = INTEGER | DECIMAL | DOUBLE ;                                         
    <b>valueSetValue</b> = objectValue | IriStem | IriStemRange | LiteralStem | LiteralStemRange
                 <b></b> | Language | LanguageStem | LanguageStemRange ;                        
      <b>objectValue</b> = IRIREF | ObjectLiteral ;                                             
    <b>ObjectLiteral</b> { value:STRING language:STRING? type:STRING? }                         
          <b>IriStem</b> { stem:IRIREF }                                                        
     <b>IriStemRange</b> { stem:(IRIREF | Wildcard) exclusions:[IRIREF|IriStem+]? }             
      <b>LiteralStem</b> { stem:STRING }                                                        
 <b>LiteralStemRange</b> { stem:(STRING | Wildcard) exclusions:[STRING|LiteralStem+]? }         
         <b>Language</b> { languageTag:LANGTAG }                                                
     <b>LanguageStem</b> { stem:LANGTAG }                                                       
<b>LanguageStemRange</b> { stem:(LANGTAG | Wildcard) exclusions:[LANGTAG|LanguageStem+]? }      
         <b>Wildcard</b> { /* empty */ }                                                        </pre>
        </div>
        <section id="node-constraint-semantics"><div class="header-wrapper"><h4 id="x6-4-1-semantics">Semantics</h4></div>
          
          <p id="satisfies2-NodeConstraint">
            For a node <span class="param">n</span> and constraint <span class="param">nc</span>, <code class="function">satisfies2(<span class="math">n</span>, <span class="math">nc</span>)</code> if and only if for every <span class="param">nodeKind</span>, <span class="param">datatype</span>, <span class="param">xsFacet</span> and <span class="param">values</span> constraint value <span class="math">v</span> present in <span class="param">nc</span> <code class="function">nodeSatisfies(<span class="math">n</span>, <span class="math">v</span>)</code>.
            The following sections define <code class="function">nodeSatisfies</code> for each of these types of constraints:
          </p>
          <ul>
            <li><a href="#nodeKind">Node Kind Constraints</a></li>
            <li><a href="#datatype">Datatype Constraints</a></li>
            <li><a href="#xs-string">XML Schema String Facet Constraints</a></li>
            <li><a href="#xs-numeric">XML Schema Numeric Facet Constraints</a></li>
            <li><a href="#values">Values Constraints</a></li>
          </ul>
        </section>

        <section id="nodeKind"><div class="header-wrapper"><h4 id="x6-4-2-node-kind-constraints">Node Kind Constraints</h4></div>
          
          <p id="nodeSatisfies-nodeKind">
            For a node <span class="math">n</span> and constraint value <span class="math">v</span>, <code class="function">nodeSatisfies(<span class="math">n</span>, <span class="math">v</span>)</code> if:
          </p>
          <ul>
            <li><span class="math">v</span> = "iri" and <span class="math">n</span> is an <a data-cite="rdf11-concepts#dfn-iri" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri">IRI</a>.</li>
            <li><span class="math">v</span> = "bnode" and <span class="math">n</span> is a <a data-cite="rdf11-concepts#dfn-blank-node" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node">blank node</a>.</li>
            <li><span class="math">v</span> = "literal" and <span class="math">n</span> is a <a data-cite="rdf11-concepts#dfn-literal" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-literal">Literal</a>.</li>
            <li><span class="math">v</span> = "nonliteral" and <span class="math">n</span> is an <a data-cite="rdf11-concepts#dfn-iri" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri">IRI</a> or <a data-cite="rdf11-concepts#dfn-blank-node" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node">blank node</a>.</li>
          </ul>
          <div class="example">
            <div class="example-title marker"><span>Node Kind example 1</span></div>
            <p>
              The following examples use a <span class="jobjref"><a href="#dfn-tripleconstraint" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleconstraint-2">TripleConstraint</a></span> object described later in the document.
              The 
            </p>
            <div class="repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
  { "id": "http://schema.example/#IssueShape",
    "type": "Shape", "expression": {
      "type": "TripleConstraint", "predicate": "http://schema.example/#state",
      "valueExpr": { "type": "NodeConstraint", "nodeKind": "iri" } } } ] }</pre>
              
            </div>
            <pre class="data" aria-busy="false"><code class="hljs">&lt;issue1&gt; ex:state ex:HunkyDory .
&lt;issue2&gt; ex:taste ex:GoodEnough .
&lt;issue3&gt; ex:state "just fine" .</code></pre>
            <pre>node     | shape        | result | reason                                        
&lt;issue1&gt; | &lt;IssueShape&gt; | pass   |                                               
&lt;issue2&gt; | &lt;IssueShape&gt; | fail   | expected 1 ex:state property.                 
&lt;issue3&gt; | &lt;IssueShape&gt; | fail   | ex:state expected to be an IRI, literal found.</pre>
            <p>
              Note that &lt;issue2&gt; <span class="fail">fails</span> not because of a nodeKind violation but instead because of a <a href="#matches-cardinality">Cardinality</a> violation described below.
            </p>
          </div>
        </section>

        <section id="datatype"><div class="header-wrapper"><h4 id="x6-4-3-datatype-constraints">Datatype Constraints</h4></div>
          
          <p id="nodeSatisfies-datatype">
            For a node <span class="math">n</span> and constraint value <span class="math">v</span>, <code class="function">nodeSatisfies(<span class="math">n</span>, <span class="math">v</span>)</code> if <span class="math">n</span> is a Literal with the datatype <span class="math">v</span> and, if <span class="math">v</span> is in the set of <a data-cite="sparql11-query#operandDataTypes" href="https://www.w3.org/TR/sparql11-query/#operandDataTypes">SPARQL operand data types</a>[<cite><a class="bibref" data-link-type="biblio" href="#bib-sparql11-query" title="SPARQL 1.1 Query Language">sparql11-query<!---0.294583%--></a></cite><!---0.294583%-->], an XML schema string with a value of the lexical form of <span class="math">n</span> can be cast to the target type <span class="math">v</span> per <a data-cite="xpath-functions-31#casting" href="https://www.w3.org/TR/xpath-functions-31/#casting">XPath Functions 3.1 section 19 Casting</a>[<cite><a class="bibref" data-link-type="biblio" href="#bib-xpath-functions" title="XQuery 1.0 and XPath 2.0 Functions and Operators (Second Edition)">xpath-functions<!---0.294583%--></a></cite><!---0.294583%-->].
            The lexical form and numeric value (where applicable) of all datatypes required by <a data-cite="sparql11-query#FunctionMapping" href="https://www.w3.org/TR/sparql11-query/#FunctionMapping">SPARQL XPath Constructor Functions</a> <em class="rfc2119">MUST<!---0.294583%--></em> be tested for conformance with the corresponding XML Schema form.
            ShEx extensions <em class="rfc2119">MAY<!---0.294583%--></em> add support for other datatypes.
          </p>

          <div class="example">
            <div class="example-title marker"><span>Datatype example 1</span></div>
            <div class="repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
  { "id": "http://schema.example/#IssueShape",
    "type": "Shape", "expression": {
      "type": "TripleConstraint", "predicate": "http://schema.example/#submittedOn",
      "valueExpr": {
        "type": "NodeConstraint",
        "datatype": "http://www.w3.org/2001/XMLSchema#date"
      } } } ] }</pre>
              
            </div>
            <pre class="data" aria-busy="false"><code class="hljs">&lt;issue1&gt; ex:submittedOn "2016-07-08"^^xsd:date .
&lt;issue2&gt; ex:submittedOn "2016-07-08T01:23:45Z"^^xsd:dateTime .
&lt;issue3&gt; ex:submittedOn "2016-07"^^xsd:date .</code></pre>
            <pre>node     | shape        | result | reason                                                        
&lt;issue1&gt; | &lt;IssueShape&gt; | pass   |                                                               
&lt;issue2&gt; | &lt;IssueShape&gt; | fail   | ex:submittedOn expected to be an xsd:date, xsd:dateTime found.
&lt;issue3&gt; | &lt;IssueShape&gt; | fail   | 2016-07 is not a valid xsd:date.                              </pre>
          </div>

          <div class="note" role="note" id="issue-container-generatedID-3"><div role="heading" class="note-title marker" id="h-note-3" aria-level="5"><span>Note</span><!---0.294583%--></div><div class="">
            <p>
              In RDF 1.1, <dfn data-cite="rdf11-concepts#dfn-language-tagged-string" data-lt="language-tagged string" id="dfn-language-tagged-string" class="externalDFN" data-no-export="" data-dfn-type="dfn"><a href="https://www.w3.org/TR/rdf11-concepts/#dfn-language-tagged-string" data-cite="rdf11-concepts" data-cite-path="" data-cite-frag="#dfn-language-tagged-string">language-tagged strings</a></dfn>[<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">rdf11-concepts<!---0.294583%--></a></cite><!---0.294583%-->] have the datatype <code>http://www.w3.org/1999/02/22-rdf-syntax-ns#langString</code>.
            </p>
            <p>
              RDF 1.0 included <a data-cite="rdf11-concepts#dfn-literal" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-literal">RDF literals</a> with no datatype or language tag.
              These are called "<a data-cite="sparql11-query#simple_literal" href="https://www.w3.org/TR/sparql11-query/#simple_literal">simple literals</a>" in SPARQL11[<cite><a class="bibref" data-link-type="biblio" href="#bib-sparql11-query" title="SPARQL 1.1 Query Language">sparql11-query<!---0.294583%--></a></cite><!---0.294583%-->].
              In RDF 1.1, these literals have the datatype <code>http://www.w3.org/2001/XMLSchema#string</code>.
            </p>
          </div></div>
          <div class="example">
            <div class="example-title marker"><span>Datatype example 2</span></div>
            <div class="repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
  { "id": "http://schema.example/#IssueShape",
    "type": "Shape", "expression": {
      "type": "TripleConstraint",
      "predicate": "http://www.w3.org/2000/01/rdf-schema#label",
      "valueExpr": {
        "type": "NodeConstraint",
        "datatype": "http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"
      } } } ] }</pre>
              
            </div>
            <pre class="data" aria-busy="false"><code class="hljs">&lt;issue3&gt; rdfs:label "emits dense black smoke"@en .
&lt;issue4&gt; rdfs:label "unexpected odor" .</code></pre>
            <pre>node     | shape        | result | reason                                                        
&lt;issue3&gt; | &lt;IssueShape&gt; | pass   |                                                               
&lt;issue4&gt; | &lt;IssueShape&gt; | fail   | rdfs:label expected to be an rdf:langString, xsd:string found.</pre>
          </div>
        </section>
      
      <section id="xs-string"><div class="header-wrapper"><h4 id="x6-4-4-xml-schema-string-facet-constraints">XML Schema String Facet Constraints</h4></div>
        
        <!-- ul>
          <li><a href="#length">XML Schema Length Constraints</a></li>
          <li><a href="#minlength">XML Schema Minlength Constraints</a></li>
          <li><a href="#maxlength">XML Schema Maxlength Constraints</a></li>
          <li><a href="#pattern">XML Schema Pattern Constraints</a></li>
        </ul -->
        <p>
          String facet constraints apply to the lexical form of the <a data-cite="rdf11-concepts#dfn-literal" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-literal">RDF Literals</a> and <a data-cite="rdf11-concepts#dfn-iri" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri">IRIs</a> and <a data-cite="rdf11-concepts#dfn-blank-node-identifier" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier">blank node identifiers</a> (see <a href="#blank-node-label">note below</a> regarding access to <a data-cite="rdf11-concepts#dfn-blank-node-identifier" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier">blank node identifiers</a>).<br>
          Let <span class="math">lex</span> =
        </p>
        <ul>
          <li>if the value <span class="math">n</span> is an <a data-cite="rdf11-concepts#dfn-literal" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-literal">RDF Literal</a>, the <a data-cite="rdf11-concepts#dfn-lexical-form" href="https://www.w3.org/TR/rdf11-concepts/#dfn-lexical-form">lexical form</a> of the literal (see [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">rdf11-concepts<!---0.294583%--></a></cite><!---0.294583%-->] <a data-cite="rdf11-concepts#section-Graph-Literal" href="https://www.w3.org/TR/rdf11-concepts/#section-Graph-Literal">section 3.3 Literals</a>).</li>
          <li>if the value <span class="math">n</span> is an <a data-cite="rdf11-concepts#dfn-iri" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri">IRI</a>, the <a data-cite="rdf11-concepts#dfn-iri" href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri">IRI string</a> (see [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">rdf11-concepts<!---0.294583%--></a></cite><!---0.294583%-->] <a data-cite="rdf11-concepts#section-iris" href="https://www.w3.org/TR/rdf11-concepts/#section-iris">section 3.2 IRIs</a>).</li>
          <li>if the value <span class="math">n</span> is a <a data-cite="rdf11-concepts#dfn-blank-node" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node">blank node</a>, the <a data-cite="rdf11-concepts#dfn-blank-node-identifier" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier">blank node identifier</a> (see [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">rdf11-concepts<!---0.294583%--></a></cite><!---0.294583%-->] <a data-cite="rdf11-concepts#section-blank-nodes" href="https://www.w3.org/TR/rdf11-concepts/#section-blank-nodes">section 3.4 Blank Nodes</a>).</li>
        </ul>
        <p>
          Let <span class="math">len</span> = the number of unicode codepoints in <span class="math">lex</span><br>
          For a node <span class="math">n</span> and constraint value <span class="math">v</span>, <code class="function">nodeSatisfies(<span class="math">n</span>, <span class="math">v</span>)</code>:
        </p>
        <ul>
          <li id="nodeSatisfies-length">for "<code>length</code>" constraints, <span class="math">v = len</span>,</li>
          <li id="nodeSatisfies-minlength">for "<code>minlength</code>" constraints, <span class="math">v &gt;= len</span>,</li>
          <li id="nodeSatisfies-maxlength">for "<code>maxlength</code>" constraints, <span class="math">v &lt;= len</span>,</li>
          <li id="nodeSatisfies-pattern">
            for "<code>pattern</code>" constraints, <span class="math">v</span> is unescaped into a valid <a data-cite="xpath-functions-31#regex-syntax" href="https://www.w3.org/TR/xpath-functions-31/#regex-syntax">XPath 3.1 regular expression</a>[<cite><a class="bibref" data-link-type="biblio" href="#bib-xpath-functions-31" title="XPath and XQuery Functions and Operators 3.1">xpath-functions-31<!---0.294583%--></a></cite><!---0.294583%-->] <span class="math">re</span> and invoking <code class="function"><a data-cite="xpath-functions-31#func-matches" href="https://www.w3.org/TR/xpath-functions-31/#func-matches">fn:matches</a>(<span class="math">lex</span>, <span class="math">re</span>)</code> returns <code>fn:true</code>.
            If the <span class="param">flags</span> parameter is present, it is passed as a third argument to <code class="function">fn:matches</code>.
            The pattern may have XPath 3.1 regular expression escape sequences per the modified production [10] in <a href="https://www.w3.org/TR/xpath-functions-31/#matching-start-and-end">section 5.6.1.1</a> as well as numeric escape sequences of the form 'u' HEX HEX HEX HEX or 'U' HEX HEX HEX HEX HEX HEX HEX HEX.
            Unescaping replaces numeric escape sequences with the corresponding unicode codepoint.
          </li>
        </ul>
        <div class="example">
          <div class="example-title marker"><span>String Facets example 1</span></div>
          <div class="repchoice" tabindex="0">
            <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
  { "id": "http://schema.example/#IssueShape",
    "type": "Shape", "expression": {
      "type": "TripleConstraint",
      "predicate": "http://schema.example/#submittedBy",
      "valueExpr": { "type": "NodeConstraint", "minlength": 10 } } } ] }</pre>
            
          </div>
          <pre class="data" aria-busy="false"><code class="hljs">&lt;issue1&gt; ex:submittedBy &lt;http://a.example/bob&gt; . # 20 characters
&lt;issue2&gt; ex:submittedBy "Bob" . # 3 characters</code></pre>
          <pre>node     | shape        | result | reason                                                             
&lt;issue1&gt; | &lt;IssueShape&gt; | pass   |                                                                    
&lt;issue2&gt; | &lt;IssueShape&gt; | fail   | ex:submittedBy expected to be &gt;= 10 characters, 3 characters found.</pre>
        </div>

        <div class="note" role="note" id="blank-node-label"><div role="heading" class="note-title marker" id="h-note-4" aria-level="5"><span>Note</span><!---0.294583%--></div><div class="">
          <p>
            Access to <a data-cite="rdf11-concepts#dfn-blank-node-identifier" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier">blank node identifiers</a> may be impossible or unadvisable for many use cases.
            For instance, the SPARQL Query and SPARQL Update languages treat blank nodes in the query, labeled or otherwise, as variables.
            Lexical constraints on <a data-cite="rdf11-concepts#dfn-blank-node-identifier" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier">blank node identifiers</a> can only be implemented in systems which preserve such labels on data import.
          </p>
        </div></div>
        <div class="example">
          <div class="example-title marker"><span>String Facets example 2</span></div>
          <div class="repchoice" tabindex="0">
            <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
  { "id": "http://schema.example/#IssueShape",
    "type": "Shape", "expression": {
      "type": "TripleConstraint",
      "predicate": "http://schema.example/#submittedBy",
      "valueExpr": { "type": "NodeConstraint",
                     "pattern": "genuser[0-9]+", "flags": "i" }
} } ] }</pre>
            
          </div>
          <pre class="data" aria-busy="false"><code class="hljs">&lt;issue6&gt; ex:submittedBy _:genUser218 .
&lt;issue7&gt; ex:submittedBy _:genContact817 .</code></pre>
          <pre>node     | shape        | result | reason                                          
&lt;issue6&gt; | &lt;IssueShape&gt; | pass   |                                                 
&lt;issue7&gt; | &lt;IssueShape&gt; | fail   | _:genContact817 expected to match genuser[0-9]+.</pre>
        </div>

        <p>
          When expressed as JSON strings, regular expressions are subject to the JSON string escaping rules.
        </p>

        <div class="example">
          <div class="example-title marker"><span>String Facets example 3</span></div>
          <div class="repchoice" tabindex="0">
            <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
  { "id": "http://schema.example/#ProductShape",
    "type": "Shape", "expression": {
      "type": "TripleConstraint",
      "predicate": "http://schema.example/#trademark",
      "valueExpr": { "type": "NodeConstraint",
                     "pattern": "^/\\t\\\\\uD835\uDCB8\\?$" }
} } ] }</pre>
            
          </div>
          <pre class="data" aria-busy="false"><code class="hljs">&lt;product6&gt; ex:trademark "	\\𝒸?" .
&lt;product7&gt; ex:trademark "\t\\\U0001D4B8?" . # Turtle literals have escape characters [tbnrf"'\].
&lt;product8&gt; ex:trademark "\t\\\\U0001D4B8?" .</code></pre>
          <pre>node       | shape          | result | reason                                                 
&lt;product6&gt; | &lt;ProductShape&gt; | pass   |                                                        
&lt;product7&gt; | &lt;ProductShape&gt; | pass   |                                                        
&lt;product8&gt; | &lt;ProductShape&gt; | fail   | found "\U0001D4B8" instead of "𝒸" (codepoint U+1D4B8).</pre>
        </div>
      </section>

      <section id="xs-numeric"><div class="header-wrapper"><h4 id="x6-4-5-xml-schema-numeric-facet-constraints">XML Schema Numeric Facet Constraints</h4></div>
        
        <!-- ul>
          <li><a href="#mininclusive">XML Schema Mininclusive Constraints</a></li>
          <li><a href="#minexclusive">XML Schema Minexclusive Constraints</a></li>
          <li><a href="#maxinclusive">XML Schema Maxinclusive Constraints</a></li>
          <li><a href="#maxexclusive">XML Schema Maxexclusive Constraints</a></li>
          <li><a href="#totaldigits">XML Schema Totaldigits Constraints</a></li>
          <li><a href="#fractiondigits">XML Schema Fractiondigits Constraints</a></li>
        </ul -->
        <p>
          Numeric facet constraints apply to the numeric value of <a data-cite="rdf11-concepts#dfn-literal" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-literal">RDF Literals</a> with datatypes listed in <a data-cite="sparql11-query#operandDataTypes" href="https://www.w3.org/TR/sparql11-query/#operandDataTypes">SPARQL 1.1 Operand Data Types</a>[<cite><a class="bibref" data-link-type="biblio" href="#bib-sparql11-query" title="SPARQL 1.1 Query Language">sparql11-query<!---0.294583%--></a></cite><!---0.294583%-->].
          Numeric constraints on non-numeric values fail.
          <code>totaldigits</code> and <code>fractiondigits</code> constraints on values not derived from <code>xsd:decimal</code> fail.
        </p>
        <p>
          Let <span class="math">num</span> be the numeric value of <span class="math">n</span>.<br>
          For a node <span class="math">n</span> and constraint value <span class="math">v</span>, <code class="function">nodeSatisfies(<span class="math">n</span>, <span class="math">v</span>)</code>:
        </p>
        <ul>
          <li id="nodeSatisfies-mininclusive">for "<code>mininclusive</code>" constraints, <span class="math">v &lt;= num</span>,</li>
          <li id="nodeSatisfies-minexclusive">for "<code>minexclusive</code>" constraints, <span class="math">v &lt; num</span>,</li>
          <li id="nodeSatisfies-maxinclusive">for "<code>maxinclusive</code>" constraints, <span class="math">v &gt;= num</span>,</li>
          <li id="nodeSatisfies-maxexclusive">for "<code>maxexclusive</code>" constraints, <span class="math">v &gt; num</span>,</li>
          <li id="nodeSatisfies-totaldigits">for "<code>totaldigits</code>" constraints, <span class="math">v</span> is less than or equals the number of digits in the <a data-cite="xmlschema-2#dt-canonical-representation" href="https://www.w3.org/TR/xmlschema-2/#dt-canonical-representation">XML Schema canonical form</a>[<cite><a class="bibref" data-link-type="biblio" href="#bib-xmlschema-2" title="XML Schema Part 2: Datatypes Second Edition">xmlschema-2<!---0.294583%--></a></cite><!---0.294583%-->] of the value of <span class="math">n</span>,</li>
          <li id="nodeSatisfies-fractiondigits">for "<code>fractiondigits</code>" constraints, <span class="math">v</span> is less than or equals the number of digits to the right of the decimal place in the <a data-cite="xmlschema-2#dt-canonical-representation" href="https://www.w3.org/TR/xmlschema-2/#dt-canonical-representation">XML Schema canonical form</a>[<cite><a class="bibref" data-link-type="biblio" href="#bib-xmlschema-2" title="XML Schema Part 2: Datatypes Second Edition">xmlschema-2<!---0.294583%--></a></cite><!---0.294583%-->] of the value of <span class="math">n</span>, ignoring trailing zeros.</li>
        </ul>
        <p>
          The operators <span class="math">&lt;=</span>, <span class="math">&lt;</span>, <span class="math">&gt;=</span> and <span class="math">&gt;</span> are evaluated after performing <a data-cite="xpath20#promotion" href="https://www.w3.org/TR/xpath20/#promotion">numeric type promotion</a>[<cite><a class="bibref" data-link-type="biblio" href="#bib-xpath20" title="XML Path Language (XPath) 2.0 (Second Edition)">xpath20<!---0.294583%--></a></cite><!---0.294583%-->].
        </p>
        <div class="example">
          <div class="example-title marker"><span>Numeric Facets example 1</span></div>
          <div class="repchoice" tabindex="0">
            <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
  { "id": "http://schema.example/#IssueShape",
    "type": "Shape", "expression": {
      "type": "TripleConstraint",
      "predicate": "http://schema.example/#confirmations",
      "valueExpr": { "type": "NodeConstraint", "mininclusive": 1 } } } ] }</pre>
            
          </div>
            <pre class="data" aria-busy="false"><code class="hljs">&lt;issue1&gt; ex:confirmations 1 .
&lt;issue2&gt; ex:confirmations 2^^xsd:byte .
&lt;issue3&gt; ex:confirmations 0 .
&lt;issue4&gt; ex:confirmations "ii"^^ex:romanNumeral .</code></pre>
            <pre>node     | shape        | result | reason                                    
&lt;issue1&gt; | &lt;IssueShape&gt; | pass   |                                           
&lt;issue2&gt; | &lt;IssueShape&gt; | pass   |                                           
&lt;issue3&gt; | &lt;IssueShape&gt; | fail   | 0 is less than 1.                         
&lt;issue4&gt; | &lt;IssueShape&gt; | fail   | ex:romanNumeral is not a numeric datatype.</pre>
          </div>
      </section>

      <section id="values"><div class="header-wrapper"><h4 id="x6-4-6-values-constraint">Values Constraint</h4></div>
        
        <p>
          The <code>nodeSatisfies</code> semantics for <span class="jobjref"><a class="obj internalDFN" href="#dfn-nodeconstraint" data-link-type="dfn" id="ref-for-dfn-nodeconstraint-7">NodeConstraint</a></span> <span class="param">values</span> depends on a <code>nodeIn</code> function <a href="#nodeIn">defined below</a>.
        </p>
        <p>
          For a node <span class="math">n</span> and constraint value <span class="math">v</span>, <code class="function">nodeSatisfies(<span class="math">n</span>, <span class="math">v</span>)</code> if <span class="math">n</span> matches some <a class="nobref internalDFN" href="#dfn-valuesetvalue" data-link-type="dfn" id="ref-for-dfn-valuesetvalue-2">valueSetValue</a> <span class="math">vsv</span> in <span class="math">v</span>.
          A term matches a valueSetValue if:
        </p>
        <ul>
          <li><span class="math" id="nodeSatisfies-objectValue">vsv</span> is an <a class="nobref internalDFN" href="#dfn-objectvalue" data-link-type="dfn" id="ref-for-dfn-objectvalue-2">objectValue</a> and <span class="math">n = vsv</span>.</li>
          <li><span class="math">vsv</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-language" data-link-type="dfn" id="ref-for-dfn-language-2">Language</a></span> with <span class="param">languageTag</span> <span class="math">lt</span> and <span class="math">n</span> is a <a data-cite="rdf11-concepts#dfn-language-tagged-string" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-language-tagged-string">language-tagged string</a> with a <a data-cite="rdf11-concepts#dfn-language-tag" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-language-tag">language tag</a> <span class="math">l</span> and <span class="math function">l = lt</span>.</li>
          <li><span class="math" id="nodeSatisfies-Stem">vsv</span> is a <span class="jobjref"><a class="nobref internalDFN" href="#dfn-iristem" data-link-type="dfn" id="ref-for-dfn-iristem-3">IriStem</a></span>, <span class="jobjref"><a class="nobref internalDFN" href="#dfn-literalstem" data-link-type="dfn" id="ref-for-dfn-literalstem-3">LiteralStem</a></span> or <span class="jobjref"><a class="nobref internalDFN" href="#dfn-languagestem" data-link-type="dfn" id="ref-for-dfn-languagestem-3">LanguageStem</a></span> with <span class="param">stem</span> <span class="math">st</span> and <span class="math">nodeIn(n, st)</span>.</li>
          <li><span class="math" id="nodeSatisfies-StemRange">vsv</span> is a <span class="jobjref"><a class="nobref internalDFN" href="#dfn-iristemrange" data-link-type="dfn" id="ref-for-dfn-iristemrange-2">IriStemRange</a></span>, <span class="jobjref"><a class="nobref internalDFN" href="#dfn-literalstemrange" data-link-type="dfn" id="ref-for-dfn-literalstemrange-2">LiteralStemRange</a></span> or <span class="jobjref"><a class="nobref internalDFN" href="#dfn-languagestemrange" data-link-type="dfn" id="ref-for-dfn-languagestemrange-2">LanguageStemRange</a></span> with <span class="param">stem</span> <span class="math">st</span> and <span class="param">exclusions</span> <span class="math">excls</span> and <span class="math function">nodeIn(n, st)</span> and there is no <span class="math">x</span> in <span class="math">excls</span> such that <span class="math function">nodeIn(n, excl)</span>.</li>
          <li><span class="math" id="nodeSatisfies-Wildcard">vsv</span> is a <span class="jobjref"><a class="nobref internalDFN" href="#dfn-wildcard" data-link-type="dfn" id="ref-for-dfn-wildcard-4">Wildcard</a></span> with <span class="param">exclusions</span> <span class="math">excls</span> and there is no <span class="math">x</span> in <span class="math">excls</span> such that <span class="math function">nodeIn(n, excl)</span>.</li>
        </ul>
        <p>
          <span class="label" id="nodeIn">nodeIn</span>: asserts that an RDF node <span class="math">n</span> is equal to an RDF term <span class="math">s</span> or is in a set defined by a <span class="jobjref"><a class="obj internalDFN" href="#dfn-iristem" data-link-type="dfn" id="ref-for-dfn-iristem-4">IriStem</a></span>, <span class="jobjref"><a class="obj internalDFN" href="#dfn-literalstem" data-link-type="dfn" id="ref-for-dfn-literalstem-4">LiteralStem</a></span> or <span class="jobjref"><a class="obj internalDFN" href="#dfn-languagestem" data-link-type="dfn" id="ref-for-dfn-languagestem-4">LanguageStem</a></span>.<br>
          The expression <code class="function">nodeIn(<span class="math">n</span>, <span class="math">s</span>)</code> is satisfied if:
        </p>
        <ul>
          <li><span class="math">n = s</span>.</li>
          <li><span class="math">s</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-iristem" data-link-type="dfn" id="ref-for-dfn-iristem-5">IriStem</a></span>, <span class="jobjref"><a class="obj internalDFN" href="#dfn-literalstem" data-link-type="dfn" id="ref-for-dfn-literalstem-5">LiteralStem</a></span> or <span class="jobjref"><a class="obj internalDFN" href="#dfn-languagestem" data-link-type="dfn" id="ref-for-dfn-languagestem-5">LanguageStem</a></span> with <span class="param">stem</span> <span class="math">st</span> and:
          <ul>
            <li><span class="math">s</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-iristem" data-link-type="dfn" id="ref-for-dfn-iristem-6">IriStem</a></span> and <span class="math">n</span> is an <a data-cite="rdf11-concepts#dfn-iri" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-iri">IRI</a> and <span class="math function"><a data-cite="xpath-functions-31#func-starts-with" href="https://www.w3.org/TR/xpath-functions-31/#func-starts-with">fn:starts-with</a>(n, st)</span>.</li>
            <li><span class="math">s</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-literalstem" data-link-type="dfn" id="ref-for-dfn-literalstem-6">LiteralStem</a></span> and <span class="math">n</span> is an <a data-cite="rdf11-concepts#dfn-literal" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-literal">RDF Literal</a> with a lexical value <span class="math">l</span> and <span class="math function"><a data-cite="xpath-functions-31#func-starts-with" href="https://www.w3.org/TR/xpath-functions-31/#func-starts-with">fn:starts-with</a>(l, st)</span>.</li>
            <li>
              <span class="math">s</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-languagestem" data-link-type="dfn" id="ref-for-dfn-languagestem-6">LanguageStem</a></span>, <span class="math">n</span> is a <a data-cite="rdf11-concepts#dfn-language-tagged-string" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-language-tagged-string">language-tagged string</a> with a <a data-cite="rdf11-concepts#dfn-language-tag" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-language-tag">language tag</a> <span class="math">l</span>, <span class="math">st</span> is a basic language range  per <a class="norm" href="http://www.ietf.org/rfc/rfc4647.txt">Matching of Language Tags</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc4647" title="Matching of Language Tags">rfc4647<!---0.294583%--></a></cite><!---0.294583%-->] section 2.1 and <span class="math">l</span> matches <span class="math">st</span> per the basic filtering scheme defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc4647" title="Matching of Language Tags">rfc4647<!---0.294583%--></a></cite><!---0.294583%-->] section 3.3.1.
              The basic language range wildcard ("*") is represented by an empty <span class="param">stem</span> ("").
            </li>
          </ul></li>
        </ul>
        <div class="example">
          <div class="example-title marker"><span>Values Constraint example 1</span></div>
          <p>NoActionIssueShape requires a state of Resolved or Rejected:</p>
          <div class="repchoice" tabindex="0">
            <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
  { "id": "http://schema.example/#NoActionIssueShape",
    "type": "Shape", "expression": {
      "type": "TripleConstraint",
      "predicate": "http://schema.example/#state",
      "valueExpr": {
        "type": "NodeConstraint", "values": [
          "http://schema.example/#Resolved",
          "http://schema.example/#Rejected" ] } } } ] }</pre>
            
          </div>
          <pre class="data" aria-busy="false"><code class="hljs">&lt;issue1&gt; ex:state ex:Resolved .
&lt;issue2&gt; ex:state ex:Unresolved .</code></pre>
          <pre>node     | shape                | result | reason                                                                  
&lt;issue1&gt; | &lt;NoActionIssueShape&gt; | pass   |                                                                         
&lt;issue2&gt; | &lt;NoActionIssueShape&gt; | fail   | ex:state expected to be ex:Resolved or ex:Rejected, ex:Unresolved found.</pre>
        </div>

        <div class="example">
          <div class="example-title marker"><span>Values Constraint example 2</span></div>
          <p>An employee must have an email address that is the string "N/A" or starts with "engineering-"  or "sales-" but not "sales-contacts" or "sales-interns":</p>
          <div class="repchoice" tabindex="0">
            <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
  { "id": "http://schema.example/#EmployeeShape",
    "type": "Shape", "expression": {
      "type": "TripleConstraint",
      "predicate": "http://xmlns.com/foaf/0.1/mbox",
      "valueExpr": {
        "type": "NodeConstraint", "values": [
          {"value": "N/A"},
          { "type": "IriStem", "stem": "mailto:engineering-" },
          { "type": "IriStemRange", "stem": "mailto:sales-", "exclusions": [
              { "type": "IriStem", "stem": "mailto:sales-contacts" },
              { "type": "IriStem", "stem": "mailto:sales-interns" }
            ] }
        ] } } } ] }</pre>
            
          </div>
          <pre class="data" aria-busy="false"><code class="hljs">&lt;issue3&gt; foaf:mbox "N/A" .
&lt;issue4&gt; foaf:mbox &lt;mailto:engineering-2112@a.example&gt; .
&lt;issue5&gt; foaf:mbox &lt;mailto:sales-835@a.example&gt; .
&lt;issue6&gt; foaf:mbox "missing" .
&lt;issue7&gt; foaf:mbox &lt;mailto:sales-contacts-999@a.example&gt; .</code></pre>
          <pre>node     | shape           | result | reason                                            
&lt;issue3&gt; | &lt;EmployeeShape&gt; | pass   |                                                   
&lt;issue4&gt; | &lt;EmployeeShape&gt; | pass   |                                                   
&lt;issue5&gt; | &lt;EmployeeShape&gt; | pass   |                                                   
&lt;issue6&gt; | &lt;EmployeeShape&gt; | fail   | "missing" is not in value set.                    
&lt;issue7&gt; | &lt;EmployeeShape&gt; | fail   | &lt;mailto:sales-contacts-999@a.example&gt; is excluded.</pre>
        </div>

        <div class="example">
          <div class="example-title marker"><span>Values Constraint example 3</span></div>
          <p>An employee must not have an email address that starts with "engineering-"  or "sales-":</p>
          <div class="repchoice" tabindex="0">
            <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
  { "id": "http://schema.example/#EmployeeShape",
    "type": "Shape", "expression": {
      "type": "TripleConstraint",
      "predicate": "http://xmlns.com/foaf/0.1/mbox",
      "valueExpr": {
        "type": "NodeConstraint", "values": [
          { "type": "IriStemRange", "stem": {"type": "Wildcard"},
            "exclusions": [
              { "type": "IriStem", "stem": "mailto:engineering-" },
              { "type": "IriStem", "stem": "mailto:sales-" }
            ] }
        ] } } } ] }</pre>
            
          </div>
          <pre class="data" aria-busy="false"><code class="hljs">&lt;issue8&gt; foaf:mbox 123 .
&lt;issue9&gt; foaf:mbox &lt;mailto:core-engineering-2112@a.example&gt; .
&lt;issue10&gt; foaf:mbox &lt;mailto:engineering-2112@a.example&gt; .</code></pre>
          <pre>node      | shape           | result | reason                                          
&lt;issue8&gt;  | &lt;EmployeeShape&gt; | pass   |                                                 
&lt;issue9&gt;  | &lt;EmployeeShape&gt; | pass   |                                                 
&lt;issue10&gt; | &lt;EmployeeShape&gt; | fail   | &lt;mailto:engineering-2112@a.example&gt; is excluded.</pre>
        </div>

        <p>
          A value set can have a single value in it.
          This is used to indicate that a specific value is required, e.g. that an ex:state must be equal to &lt;http://schema.example/#Resolved&gt; or the rdf:type of some node must be foaf:Person.
        </p>
      </section>
    </section>
      <section id="shapes-and-TEs"><div class="header-wrapper"><h3 id="x6-5-shapes-and-triple-expressions">Shapes and Triple Expressions</h3></div>
        
      
      <p>
        Triple expressions are used for defining patterns composed of triple constraints.
        Shapes associate <a href="#dfn-triple-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-triple-expressions-2">triple expressions</a> with flags indicating whether triples match if they do not correspond to triple constraints in the <a href="#dfn-triple-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-triple-expressions-3">triple expression</a>.
        A <dfn data-lt="triple expressions|triple expression" id="dfn-triple-expressions" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">triple expression</dfn> is composed of <span class="jobjref"><a href="#dfn-tripleconstraint" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleconstraint-3">TripleConstraint</a></span> and <span class="jobjref"><a href="#dfn-tripleexprref" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleexprref-3">tripleExprRef</a></span> objects composed with grouping and choice operators.
      </p>
      
      <section id="triple-expressions-abstract-syntax"><div class="header-wrapper"><h4 id="x6-5-1-json-syntax">JSON Syntax</h4></div>
      

      <div class="shexjTable">
        <pre>           <b>Shape</b> { extends:[shapeExprRef]? closed:BOOL?                                   
                <b></b> &nbsp; extra:[IRIREF+]? expression:tripleExpr?                                
                <b></b> &nbsp; semActs:[SemAct+]? annotations:[Annotation+]? }                        
      <b>tripleExpr</b> = EachOf | OneOf | TripleConstraint | tripleExprRef ;                    
          <b>EachOf</b> { id:tripleExprLabel? expressions:[tripleExpr{2,}]                       
                <b></b> &nbsp; min:INTEGER? max:INTEGER?                                              
                <b></b> &nbsp; semActs:[SemAct+]? annotations:[Annotation+]? }                        
           <b>OneOf</b> { id:tripleExprLabel? expressions:[tripleExpr{2,}]                       
                <b></b> &nbsp; min:INTEGER? max:INTEGER?                                              
                <b></b> &nbsp; semActs:[SemAct+]? annotations:[Annotation+]? }                        
<b>TripleConstraint</b> { id:tripleExprLabel? inverse:BOOL? predicate:IRIREF valueExpr:shapeExpr?
                <b></b> &nbsp; min:INTEGER? max:INTEGER?                                              
                <b></b> &nbsp; semActs:[SemAct+]? annotations:[Annotation+]? }                        
   <b>tripleExprRef</b> = tripleExprLabel ;                                                      
 <b>tripleExprLabel</b> = IRIREF | BNODE ;                                                       </pre>
      </div>
      </section>
      
      <section id="triple-expressions-semantics"><div class="header-wrapper"><h4 id="x6-5-2-semantics">Semantics</h4></div>
        
        <p id="satisfies-Shape">
          The semantics of the <code>matchesShape</code> function are based on the <code>matches</code> function <a href="#matches">defined below</a>.
          A <a href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-10">shape</a> may have an <span class="param">expression</span>.
          For the purposes of evaluation, we define an <dfn id="dfn-emptyexpression" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">EmptyExpression</dfn> which has no <span class="jobjref"><a class="obj internalDFN" href="#dfn-tripleconstraint" data-link-type="dfn" id="ref-for-dfn-tripleconstraint-5">TripleConstraint</a>s</span>.
        </p>
        <p>
	  <dfn id="dfn-parentshapelabels" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">parentShapeLabels</dfn> is a function from a <a href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-11">shape</a> <span class="var">label</span> to the set of <a href="#dfn-shapeexprlabel" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexprlabel-7">shapeExprLabels</a> parents of the labels in shape.extends as well as their parents in the <a href="#dfn-extension-hierarchy-graph" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-extension-hierarchy-graph-2">extension hierarchy graph</a>.
        </p>
        <p>
	  For a <a data-cite="rdf11-concepts#dfn-node" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-node">node</a> <span class="math">n</span>, <a href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-12">shape</a> <span class="math">S</span>, <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">graph</a> <span class="math">G</span>, a ShExSchema <span class="math">Sch</span>, a <a href="#dfn-typing" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-typing-4">typing</a> <span class="math">m</span>, and a subset  <span class="math">R</span> of neigh(n), <code class="function"><dfn id="dfn-matchesshape" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">matchesShape</dfn>(<span class="math">n</span>, <span class="math">S</span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">m</span>, <span class="math">R</span>)</code> if and only if:
        </p>
        <ul>
          <li><dfn id="dfn-parents" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">parents</dfn> is the set parentShapeLabels(S). If s.extends does not exist, then parentShapeLabels(s) is the empty set. </li>
          <li><dfn class="math" id="dfn-ncard" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">nCard</dfn> is the length of parents.</li>
          <li>
            R can be partitioned into two sets <span class="math">matched</span> and <span class="math">remainder</span></li>
          <li><span class="math">matched</span> is partitioned into <code class="math">nCard+1</code> parts <code class="math">R<sub>0</sub></code>, <code class="math">R<sub>1</sub></code> ... <code class="math">R<sub>nCard</sub></code> such that
            <ul>
            <li><code class="function">matches(<span class="math">R<sub>0</sub></span>, S.tripleExpr, <span class="math">m</span>)</code></li>
            <li>satisfies(n, constraint(L), G, Sch, m, matched)</li>
            <li> for every i in 1..nCard, <code class="function">matches(<span class="math">R<sub>i</sub></span>, mainShape(parents<sub>i</sub>), <span class="math">m</span>)</code> </li>
            <li> for every i in 1..nCard, satisfies(n, constraint(parent<sub>i</sub>), G, Sch, m, R<sub>i</sub> ∪ Q) where Q is the union of all the R<sub>j</sub> s.t. parent<sub>j</sub> is a parent of parent<sub>i</sub>.</li>
            </ul>
            </li>
          <li>
            Let <span class="label">outs</span> be the <span class="math"><a href="#dfn-arcsout" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-arcsout-5">arcsOut</a></span> in <span class="math">remainder</span>:
            <code class="function"><span class="math">outs</span> = <span class="math">remainder</span> ∩ <a href="#dfn-arcsout" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-arcsout-6">arcsOut</a>(<span class="math">G</span>, <span class="math">n</span>)</code>.
          </li>
          <li>
            Let <span class="label">matchables</span> be the triples in <span class="math">outs</span> whose <a data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicate</a> appears in a <span class="jobjref"><a class="obj internalDFN" href="#dfn-tripleconstraint" data-link-type="dfn" id="ref-for-dfn-tripleconstraint-6">TripleConstraint</a></span> in one of the mainShape(parents<sub>i</sub>) or in S.expression.
          </li>
          <li>
            There is no triple in <span class="label">matchables</span> which matches a <span class="jobjref"><a class="obj internalDFN" href="#dfn-tripleconstraint" data-link-type="dfn" id="ref-for-dfn-tripleconstraint-7">TripleConstraint</a></span> in one of the mainShape(parents<sub>i</sub>) nor one of the TripleConstraint in S.expression.<br>
            Let <span class="label">unmatchables</span> be the triples in <span class="math">outs</span> which are not in <span class="math">matchables</span>.
            <code class="function"><span class="math">matchables</span> ∪ <span class="math">unmatchables</span> = <span class="math">outs</span></code>.
          </li>
          <li>
            There is no triple in <span class="math">matchables</span> whose <a data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicate</a> does not appear in <span class="param">extra</span>.
          </li>
          <li><span class="param">closed</span> is false or <span class="math">unmatchables</span> is empty.</li>
          <div class="note" role="note" id="issue-container-generatedID-4"><div role="heading" class="note-title marker" id="h-note-5" aria-level="5"><span>Note</span><!---0.294583%--></div><p class="">
            The complexity of partitioning is described briefly in the <a href="../primer/#partition-complexity">ShEx2 Primer</a>.
          </p></div>
        </ul>
      <p>
        <span class="label" id="matches">matches</span>: asserts that a <a href="#dfn-triple-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-triple-expressions-4">triple expression</a> is matched by a set of triples that come from the neighbourhood of a node in an <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">RDF graph</a>.
        The expression <code>matches(<span class="math">T</span>, <span class="math">expr</span>, <span class="math">m</span>)</code> indicates that a set of triples <span class="math">T</span> can satisfy these rules:
      </p>
      <ul>
        <li>
          <p id="matches-semActs"><span class="math">expr</span> has <span class="param">semActs</span> and <code class="function">matches(<span class="math">T</span>, <span class="math">expr</span>, <span class="math">m</span>)</code> by the remaining rules in this list and the evaluation of <span class="param">semActs</span> succeeds according to the section below on <a href="#semantic-actions">Semantic Actions</a>.</p>
          <div class="example">
            <div class="math"><div style="float:left;">matches(</div><div style="float:left;">T,<br>
            <div class="inline repchoice incomplete" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "OneOf", "shapeExprs": [te1, te2, …], "min": 2, "max": 3,
  "semActs": [SemAct1, SemAct2, …] }</pre>
              
              </div>,<br>
              m)</div>
            </div>
            <div style="clear:both;">evaluates as:</div>
            <div class="math"><div style="float:left;">matches(</div><div style="float:left;">T,<br>
            <div class="inline repchoice incomplete" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "OneOf", "shapeExprs": [te1, te2, …], "min": 2, "max": 3 }    &nbsp;</pre>
              
              </div>,<br>
              m)</div>
            </div>
            <div style="clear:both;"></div>
            <span class="math function">and <a href="#semActsSatisfied">semActsSatisfied</a>(<span class="inline json">[<span class="comment">SemAct<sub>1</sub></span>, <span class="comment">SemAct<sub>2</sub>, …</span>]</span>)</span>
          </div>
        </li>
        <li>
          <p id="matches-cardinality"><span class="math">expr</span> has a <dfn id="dfn-cardinality" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">cardinality</dfn> of <span class="param">min</span> and/or <span class="param">max</span> not equal to 1, where a <span class="param">max</span> of -1 is treated as unbounded, and <span class="math">T</span> can be partitioned into <span class="math">k</span> subsets <span class="math function">T<sub>1</sub></span>, <span class="math">T<sub>2</sub></span>,…<span class="math">T<sub>k</sub></span> such that <span class="math">min ≤ k ≤ max</span> and for each <span class="math">T<sub>n</sub></span>, <code class="function">matches(<span class="math">T<sub>n</sub></span>, <span class="math">expr</span>, <span class="math">m</span>)</code> by the remaining rules in this list.</p>
          <div class="example">
            <div class="math"><div style="float:left;">matches(</div><div style="float:left;">T,<br>
            <div class="inline repchoice incomplete" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "OneOf", "shapeExprs": [te1, te2, …], "min": 2, "max": 3 }    &nbsp;</pre>
              
              </div>,<br>
              m)</div>
            </div>
            <div style="clear:both;">evaluates as:</div>
            <div class="math"><div style="float:left;">Let e =&nbsp;</div><div style="float:left;">
            <div class="inline repchoice incomplete" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "OneOf", "shapeExprs": [te1, te2, …] }    &nbsp;</pre>
              
            </div></div>
            <div style="clear:both;"></div>
            (<span class="math function">matches(T<sub>1</sub>, e, m)</span> and
             <span class="math function">matches(T<sub>2</sub>, e, m)</span><br>
             &nbsp;and T = T<sub>1</sub> ∪ T<sub>2</sub>)<br>
            or<br>
            (<span class="math function">matches(T<sub>1</sub>, e, m)</span> and
              <span class="math function">matches(T<sub>2</sub>, e, m)</span> and
              <span class="math function">matches(T<sub>3</sub>, e, m)</span><br>
              &nbsp;and T = T<sub>1</sub> ∪ T<sub>2</sub> ∪ T<sub>3</sub>)</div>
          </div>
          <!-- div class="example">
            <div class="math"><div style="float:left;">matches(</div><div style="float:left;">T,<br/>
            <div class="inline json">
              <pre>{ "type": "OneOf", "shapeExprs": [<span class="comment">te<sub>1</sub></span>, <span class="comment">te<sub>2</sub>, …</span>], "min": 2, "max": 2 }</pre></div>,<br/>
              m)</div>
            </div>
            <div style="clear:both;">evaluates as:</div>
            <div class="math"><div style="float:left;">Let subExpr = </div><div style="float:left;">
            <div class="inline json">
              <pre>{ "type": "OneOf", "shapeExprs": [<span class="comment">te<sub>1</sub></span>, <span class="comment">te<sub>2</sub>, …</span>] }</pre></div></div>
            </div>
            <div style="clear:both;"></div>
            <div class="math"><div style="float:left;">matches(</div><div style="float:left;"><span class="math">T<sub>1</sub></span>,<br/>
            <div class="inline json">
              <pre>{ "type": "OneOf", "shapeExprs": [<span class="comment">te<sub>1</sub></span>, <span class="comment">te<sub>2</sub>, …</span>] }</pre></div>,<br/>
              m)</div>
            </div>
            <div style="clear:both;"></div>
            <div class="math"><div style="float:left;">and matches(</div><div style="float:left;"><span class="math">T<sub>2</sub></span>,<br/>
            <div class="inline json">
              <pre>{ "type": "OneOf", "shapeExprs": [<span class="comment">te<sub>1</sub></span>, <span class="comment">te<sub>2</sub>, …</span>] }</pre></div>,<br/>
              m)</div>
            </div>
            <div style="clear:both;"></div>
            <div class="math function" >and T = T<sub>1</sub> ∪ T<sub>2</sub></div>
          </div -->
        </li>
        <li>
          <p id="matches-OneOf"><span class="math">expr</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-oneof" data-link-type="dfn" id="ref-for-dfn-oneof-2">OneOf</a></span> and there is some <a href="#dfn-shape-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-expressions-7">shape expression</a> <span class="math">se2</span> in <span class="param">shapeExprs</span> such that <code class="function">matches(<span class="math">T</span>, <span class="math">se2</span>, <span class="math">m</span>)</code>.</p>
          <div class="example">
            <div class="math"><div style="float:left;">matches(</div><div style="float:left;">T,<br>
            <div class="inline repchoice incomplete" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "OneOf", "shapeExprs": [
  { "type": "EachOf", "shapeExprs": [te3, te4, …] },
  { "type": "TripleExpression", "min": 1, "max": -1,
    "predicate": "http://xmlns.com/foaf/0.1/name" }
] }</pre>
              
              </div>,<br>
              m)</div>
            </div>
            <div style="clear:both;">evaluates as:</div>
            <div class="math"><div style="float:left;">matches(</div><div style="float:left;">T,<br>
            <div class="inline repchoice incomplete" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "EachOf", "shapeExprs": [te3, te4, …] }    &nbsp;</pre>
              
              </div>,<br>
              m)</div>
            </div>
            <div style="clear:both;"></div>
            <div class="math"><div style="float:left;">or matches(</div><div style="float:left;">T,<br>
            <div class="inline repchoice incomplete" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "TripleExpression", "min": 1, "max": -1,
    "predicate": "http://xmlns.com/foaf/0.1/name" }</pre>
              
              </div>,<br>
              m)</div>
            </div>
          </div>
        </li>
        <li>
          <p id="matches-EachOf"><span class="math">expr</span> is an <span class="jobjref"><a class="obj internalDFN" href="#dfn-eachof" data-link-type="dfn" id="ref-for-dfn-eachof-4">EachOf</a></span> and there is some partition of <span class="math">T</span> into <span class="math">T<sub>1</sub></span>, <span class="math">T<sub>2</sub></span>,… such that for every expression <span class="function"><span class="math">expr<sub>1</sub></span>, <span class="math">expr<sub>2</sub></span>,…</span> in <span class="param">shapeExprs</span>, <code class="function">matches(<span class="math">T<sub>n</sub></span>, <span class="math">expr<sub>n</sub></span>, <span class="math">m</span>)</code>.</p>
          <div class="example">
            <div class="math"><div style="float:left;">matches(</div><div style="float:left;">T,<br>
            <div class="inline repchoice incomplete" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "EachOf", "shapeExprs": [
  { "type": "TripleExpression",
    "predicate": "http://xmlns.com/foaf/0.1/givenName" },
  { "type": "TripleExpression",
    "predicate": "http://xmlns.com/foaf/0.1/familyName" }
] }</pre>
              
             </div>,<br>
              m)</div>
            </div>
            <div style="clear:both;">evaluates as:</div>
            <div class="math"><div style="float:left;">matches(</div><div style="float:left;">T<sub>1</sub>,<br>
            <div class="inline repchoice incomplete" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "TripleExpression",
    "predicate": "http://xmlns.com/foaf/0.1/givenName" }</pre>
              
              </div>,<br>
              m)</div>
            </div>
            <div style="clear:both;"></div>
            <div class="math"><div style="float:left;">and matches(</div><div style="float:left;">T<sub>2</sub>,<br>
            <div class="inline repchoice incomplete" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "TripleExpression",
    "predicate": "http://xmlns.com/foaf/0.1/familyName" }</pre>
              
              </div>,<br>
              m)</div>
            </div>
            <div style="clear:both;"></div>
            <span class="math">and T = T<sub>1</sub> ∪ T<sub>2</sub></span>
          </div>
        </li>
        <li>
          <p id="matches-TripleConstraint"><span class="math">expr</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-tripleconstraint" data-link-type="dfn" id="ref-for-dfn-tripleconstraint-8">TripleConstraint</a></span> and:</p>
          <ul>
            <li>
              <span class="math">T</span> is a set of one triple.<br>
              Let <span class="label">t</span> be the sole triple in <span class="math">T</span>.
            </li>
            <li>
              <span class="math">t</span>'s <a class="param" data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicate</a> equals <span class="math">expr</span>'s <a data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicate</a>.<br>
              Let <span class="label">value</span> be <span class="math">t</span>'s subject if <span class="param">inverse</span> is true, else <span class="math">t</span>'s object.
            </li>
            <li>
              if <span class="param">inverse</span> is true, <span class="math">t</span> is in <span class="math"><a href="#dfn-arcsin" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-arcsin-5">arcsIn</a></span>, else <span class="math">t</span> is in <span class="math"><a href="#dfn-arcsout" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-arcsout-7">arcsOut</a></span>.
            </li>
            <li>either
            <ul>
              <li>
                <p><span class="math">expr</span> has no <span class="param">valueExpr</span></p>
                <div class="example">
                  <div class="math"><div style="float:left;">matches(</div><div style="float:left;">T,<br>
                  <div class="inline repchoice incomplete" tabindex="0">
                    <pre class="json nohighlight repchosen">{ "type": "TripleExpression",
  "predicate": "http://xmlns.com/foaf/0.1/givenName" }</pre>
                    
                  </div>,<br>
              m)</div>
                  </div>
                  <div style="clear:both;">holds if
                  <ul class="tight">
                    <li><span class="math">T</span> has exactly one triple <span class="math">t</span>.</li>
                    <li><span class="math">t</span> has the <a data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicate</a> "<code>http://xmlns.com/foaf/0.1/givenName</code>"</li>
                  </ul></div>
                </div>
              </li>
              <li>or expr.valueExpr is a shapeExprRef, then shapeExprRef.label is in m(value)
              </li>
              <li>
                <p>or expr.valueExpr is not a shapeExprRef, then <code class="function">satisfies(<span class="math">value</span>, <span class="param">valueExpr</span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">m</span>, neigh(value))</code>.</p>
                <div class="example">
                  <div class="math"><div style="float:left;">matches(</div><div style="float:left;">T,<br>
                  <div class="inline repchoice incomplete" tabindex="0">
                    <pre class="json nohighlight repchosen">{ "type": "TripleConstraint", "inverse": true,
  "predicate": "http://purl.org/dc/elements/1.1/author",
  "valueExpr": "http://schema.example/#IssueShape" }</pre>
                    
                  </div>,<br>
              m)</div>
                  </div>
                  <div style="clear:both;">holds if
                  <ul class="tight">
                    <li><span class="math">T</span> has exactly one triple <span class="math">t</span>.</li>
                    <li><span class="math">t</span> has the <a data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicate</a> "<code>http://purl.org/dc/elements/1.1/author</code>"</li>
                    <li><span class="math">t</span> has a subject <span class="math">n2</span></li>
                    <li>The schema's <a class="param internalDFN" href="#dfn-shapes" data-link-type="dfn" id="ref-for-dfn-shapes-6">shapes</a> maps "<code>http://schema.example/#IssueShape</code>" to <span class="math">se2</span></li>
                    <li><span class="math function">satisfies(n2, se2, G, Sch, m)</span></li>
                  </ul></div>
                </div>
                <!--
                <p class="issue">[Editorial] The following is a more verbose description of the above. Which is preferred?</p>
                <div class="example">
                  For the schema<br/>
                  <div class="inline json">
                    <pre>{ "type": "Schema", "shapes": [
  { "id": "http://schema.example/#UserShape",
    "type": "Shape", "expression": {
      "type": "TripleConstraint", "inverse": true,
      "predicate": "http://purl.org/dc/elements/1.1/author",
      "valueExpr": {
        "type": "ShapeAnd", "shapeExprs": [
          { "type": "NodeConstraint", "nodeKind": "iri", "pattern": "http:.*" },
          "http://schema.example/#IssueShape"
        ] } } },
  { "id": "http://schema.example/#IssueShape", "type": "Shape" } ] }</pre>
                  </div><div style="clear:both;"></div>
                  <span class="math"><div style="float:left;">matches(</div><div style="float:left;">T,<br/>
                  <div class="inline json">
                    <pre>{ "type": "TripleConstraint", "inverse": true,
  "predicate": "http://purl.org/dc/elements/1.1/author",
  "valueExpr": { … } }</pre></div>,<br/>
              m)</div>
                  </span>
                  <div style="clear:both;">holds if
                  <ul class="tight">
                    <li><span class="math">T</span> has exactly one triple <span class="math">t</span>.</li>
                    <li><span class="math">t</span> has the predicate "<code>http://purl.org/dc/elements/1.1/author</code>"</li>
                    <li><span class="math">t</span> has a subject <span class="math">n2</span></li>
                    <li>The schema's <a class="param">shapes</a> maps "<code>http://schema.example/#IssueShape</code>" to <span class="math">se2</span></li>
                    <li><span class="math function" >satisfies(n2, se2, G, m)</span></li>
                  </ul></div>
                </div>
                -->
              </li>
            </ul></li>
          </ul>
        </li>
        <li>
          <p id="matches-tripleExprRef">
            <span class="math">expr</span> is a <span class="jobjref"><a class="obj internalDFN" href="#dfn-tripleexprref" data-link-type="dfn" id="ref-for-dfn-tripleexprref-5">tripleExprRef</a></span> and <code class="function">satisfies(<span class="math">value</span>, tripleExprWithId(<span class="param">tripleExprRef</span>), <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">Sch</span>, <span class="math">m</span>)</code>.<br>
            The <code class="function"><a href="#dfn-tripleexprwithid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleexprwithid-1"><code>tripleExprWithId</code></a></code> function is defined in <a href="#tripleExprRef-requirement">Triple Expression Reference Requirement</a> below.
          </p>
          <div class="example">
            For the schema<br>
            <div class="inline repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
  { "id": "http://schema.example/#EmployeeShape",
    "type": "Shape", "expression": {
      "type": "EachOf", "expressions": [
        "http://schema.example/#nameExpr",
        { "type": "TripleConstraint",
          "predicate": "http://schema.example/#empID",
          "valueExpr": { "type": "NodeConstraint",
            "datatype": "http://www.w3.org/2001/XMLSchema#integer" } } ] } },
  { "id": "http://schema.example/#PersonShape",
    "type": "Shape", "expression": {
      "id": "http://schema.example/#nameExpr",
      "type": "TripleConstraint",
      "predicate": "http://xmlns.com/foaf/0.1/name" } } ] }</pre>
              
            </div><div style="clear:both;"></div>
            <div class="math"><div style="float:left;">matches(</div><div style="float:left;">T,<br>
            <div class="inline json">
              <pre aria-busy="false"><code class="hljs abnf"><span class="hljs-string">"http://schema.example/#PersonShape"</span></code></pre></div>,<br>
              m)</div>
            </div>
            <div style="clear:both;">holds if
            <ul class="tight">
              <li>The schema has a shape <span class="math">se2</span> with the <span class="param">id</span> "<code>http://schema.example/#PersonShape</code>"</li>
              <li><span class="math function">satisfies(n, se2, G, Sch, m)</span></li>
            </ul></div>
          </div>
        </li>
      </ul>
    </section>
      </section>
      
      
    <section id="import"><div class="header-wrapper"><h3 id="x6-6-shex-import">ShEx Import</h3></div>
      
      <p>
        The presence of <a class="param internalDFN" href="#dfn-import" data-link-type="dfn" id="ref-for-dfn-import-3">imports</a> requires that:
      </p>
      <ul>
        <li>each IRI in <a class="param internalDFN" href="#dfn-import" data-link-type="dfn" id="ref-for-dfn-import-4">imports</a> be resolved and</li>
        <li>the returned representation of that IRI be interpreted as a ShEx <span class="math">S</span> and</li>
        <li>each <a class="jobjref internalDFN" href="#dfn-shapeexpr" data-link-type="dfn" id="ref-for-dfn-shapeexpr-19">shapeExpr</a> in <span class="math">S</span>.<span class="param">shapes</span> be in scope for resolving shape expression references and</li>
        <li>each <a class="jobjref internalDFN" href="#dfn-tripleexpr" data-link-type="dfn" id="ref-for-dfn-tripleexpr-6">tripleExpr</a> with a <a class="jobjref internalDFN" href="#dfn-tripleexprlabel" data-link-type="dfn" id="ref-for-dfn-tripleexprlabel-8">tripleExprLabel</a> be in scope for resolving triple expression references.</li>
      </ul>
      <p>
        If any imported schema imports other schemas, shape and triple expression labels from those schemas are also in scope.
      </p>
          <div class="example">
            <div class="example-title marker"><span>Import example 1 - Shape and Triple Expressions</span></div>
            <div class="repchoice incomplete" tabindex="0">
              <pre class="json nohighlight repchosen">schema1:
{ "type": "Schema", "imports": ["http://schema.example/schema2"], "shapes": [
  { "id": "http://schema.example/#EmployeeShape",
    "type": "Shape", "expression": {
      "type": "EachOf", "expressions": [
        "http://schema.example/#nameExpr",
        { "type": "TripleConstraint",
          "predicate": "http://schema.example/#empID",
          "valueExpr": { "type": "NodeConstraint",
            "datatype": "http://www.w3.org/2001/XMLSchema#integer" } } ] } } ] }
schema2:
{ "type": "Schema", "shapes": [
  { "id": "http://schema.example/#PersonShape",
    "type": "Shape", "expression": {
      "id": "http://schema.example/#nameExpr",
      "type": "TripleConstraint",
      "predicate": "http://xmlns.com/foaf/0.1/name" } } ] }</pre>
              
            </div>
            <p>
              Both the shape expression <code>&lt;PersonShape&gt;</code> and the triple expression <code>&lt;nameExpr&gt;</code> are in scope.<br>
              <span class="label">schema2</span>'s <code>&lt;nameExpr&gt;</code> is referenced in <span class="label">schema1</span>'s <code>&lt;EmployeeShape&gt;</code>
            </p>
          </div>
      <p>
        Redundant imports are treated as a single import.
        This includes circular imports:
      </p>
          <div class="example">
            <div class="example-title marker"><span>Import example 2 - Circular Import</span></div>
            <div class="repchoice incomplete" tabindex="0">
              <pre class="json nohighlight repchosen">schema1:
{ "type": "Schema",
  "imports": ["http://schema.example/schema2", "http://schema.example/schema3"],
  "shapes": [
  { "id": "http://schema.example/schema1#S1",
    "type": "Shape", "expression": {
      "type": "TripleConstraint", "predicate": "http://schema.example/#p1",
      "valueExpr": "http://schema.example/schema1#S2"
    } } ] }
schema2:
{ "type": "Schema",
  "imports": ["http://schema.example/schema3"],
  "shapes": [
  { "id": "http://schema.example/schema1#S2",
    "type": "Shape", "expression": {
      "type": "TripleConstraint", "predicate": "http://schema.example/#p2",
      "valueExpr": "http://schema.example/schema1#S3"
    } } ] }
schema3:
{ "type": "Schema",
  "imports": ["http://schema.example/schema1"],
  "shapes": [
  { "id": "http://schema.example/schema1#S3",
    "type": "Shape", "expression": {
      "type": "TripleConstraint", "predicate": "http://schema.example/#p3",
      "valueExpr": "http://schema.example/schema1#S1", "min": 0,
    } } ] }</pre>
              
            </div>
          </div>
      <p>
        When some schema <span class="math">A</span> imports schema <span class="math">B</span>, <span class="math">B</span>'s <a class="jobjref internalDFN" href="#dfn-start" data-link-type="dfn" id="ref-for-dfn-start-3">start</a> member is ignored.
      </p>
          <div class="example">
            <div class="example-title marker"><span>Import example 3 - Ignored Start In Import</span></div>
            <div class="repchoice incomplete" tabindex="0">
              <pre class="json nohighlight repchosen">schema1:
{ "type": "Schema",
  "imports": ["http://schema.example/schema2"],
  "shapes": [
  { "id": "http://schema.example/schema1#S1",
    "type": "Shape", "expression": {
      "type": "TripleConstraint", "predicate": "http://schema.example/#p1",
      "valueExpr": "http://schema.example/schema1#S2"
    } } ] }
schema2:
{ "type": "Schema",
  "start": "http://schema.example/schema1#S2",
  "shapes": [
  { "id": "http://schema.example/schema1#S2",
    "type": "Shape", "expression": {
      "type": "TripleConstraint", "predicate": "http://schema.example/#p2"
    } } ] }</pre>
              
            </div>
          <p>
            <code>schema1</code> has no <code>start</code> even though it imports a schema with a <code>start</code>.
          </p>
          </div>
        <p>
        It is an error if <code>A</code> and <code>B</code> share any labels for shape expressions or triple expressions or if schema <code>B</code> has a <a class="jobjref internalDFN" href="#dfn-startacts" data-link-type="dfn" id="ref-for-dfn-startacts-3">startActs</a> member.
      </p>
          <div class="example">
            <div class="example-title marker"><span>Import example 4 - Erroneous Import</span></div>
            <div class="repchoice error incomplete" tabindex="0">
              <pre class="json nohighlight repchosen">schema1:
{ "type": "Schema",
  "imports": ["http://schema.example/schema2"],
  "shapes": [
  { "id": "http://schema.example/schema1#S1",
    "type": "Shape", "expression": {
      "type": "TripleConstraint", "predicate": "http://schema.example/#p1",
      "valueExpr": "http://schema.example/schema1#S2"
    } } ] }
schema2:
{ "type": "Schema",
"startActs": [ { "type": "semAct",
                 "name": "http://schema.example/schema1#A1" } ],
  "shapes": [
  { "id": "http://schema.example/schema1#S1",
    "type": "Shape", "expression": {
      "type": "TripleConstraint", "predicate": "http://schema.example/#p1",
      "valueExpr": "http://schema.example/schema1#S2"
    } },
  { "id": "http://schema.example/schema1#S2",
    "type": "Shape", "expression": {
      "type": "TripleConstraint", "predicate": "http://schema.example/#p2",
      "valueExpr": "http://schema.example/schema1#S3"
    } } ] }</pre>
              
            </div>
          <p>
            This import fails because:
          </p>
          <ul>
            <li><code>&lt;http://schema.example/schema1#S1&gt;</code> has conflicting definitions and</li>
            <li>an included schema has a <code>start</code> directive and</li>
            <li>the reference to <code>&lt;http://schema.example/schema1#S3&gt;</code> is not resolvable after imports.</li>
          </ul>
          </div>
    </section>

    <section id="schema-requirements"><div class="header-wrapper"><h3 id="x6-7-schema-requirements">Schema Requirements</h3></div>
      
      <p>
        The semantics defined above assume three structural requirements beyond those imposed by the grammar of the abstract syntax.
        These ensure referential integrity and eliminate logical paradoxes such as those that arrise through the use of negation.
        These are not constraints expressed by the schema but instead those imposed on the schema.
      </p>

      <section id="validation-requirement"><div class="header-wrapper"><h4 id="x6-7-1-schema-validation-requirement">Schema Validation Requirement</h4></div>
        

        <p>A <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">graph</a> <span class="math">G</span> is said to <dfn data-lt="conforms|conformance|conform" id="dfn-conforms" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">conform</dfn> with
          a <a href="#dfn-shapes-schema" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapes-schema-5">schema</a> <span class="math">S</span> with a <a href="#dfn-shapemap" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapemap-3">ShapeMap</a> <span class="math">m</span> when:</p>
        <ol class="algorithm">
          <li>Every, <a href="#dfn-semact" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-semact-8">SemAct</a> in the <a href="#dfn-startacts" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-startacts-4">startActs</a> of <span class="math">S</span>
            has a successful evaluation of <a href="#semActsSatisfied">semActsSatisfied</a>.</li>
          <li>Every <a data-cite="rdf11-concepts#dfn-node" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-node">node</a> <span class="math">n</span> in <span class="math">m</span> <a href="#dfn-conforms" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-conforms-1">conforms</a> to its associated
            <a href="#dfn-shapeexprref" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexprref-7">shapeExprRefs</a> <span class="math">se<sub>n</sub></span> where
            for each <a href="#dfn-shapeexprref" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexprref-8">shapeExprRef</a> <span class="math">se<sub>i</sub></span> in <span class="math">se<sub>n</sub></span>:
            <ol class="algorithm">
              <li><span class="math">se<sub>i</sub></span> references a <a href="#dfn-shapeexpr" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexpr-20">ShapeExpr</a> in <a href="#dfn-shapes" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapes-7">shapes</a>, and</li>
              <li><code class="function"><a href="#dfn-satisfies" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-satisfies-12">satisfies</a>(<span class="math">n</span>, <span class="math">se<sub>i</sub></span>, <span class="math">G</span>, <span class="math">Sch</span>, <span class="math">m</span>)</code>
                for each <a href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-13">shape</a> <span class="math">se<sub>i</sub></span> in <span class="math">se<sub>n</sub></span>.</li>
            </ol>
          </li>
        </ol>
      </section>

      <section id="shapeExprRef-requirement"><div class="header-wrapper"><h4 id="x6-7-2-shape-expression-reference-requirement">Shape Expression Reference Requirement</h4></div>
        
        <p>A <span class="jobjref"><a href="#dfn-shapeexprref" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexprref-9">shapeExprRef</a></span> <em class="rfc2119">MUST<!---0.294583%--></em> appear in the schema's <a class="param internalDFN" href="#dfn-shapes" data-link-type="dfn" id="ref-for-dfn-shapes-8">shapes</a> map (or an <a href="#import">imported schema's</a> map) and the corresponding <a href="#dfn-shape-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-expressions-8">shape expression</a> <em class="rfc2119">MUST<!---0.294583%--></em> be a <span class="jobjref"><a href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-14">Shape</a></span> with a <span class="param">shapeExpr</span>.
          The function <code>shapeExprWithId(<span class="math">shapeExprRef</span>)</code> returns the shape expression with an <span class="param">id</span> of <span class="math">shapeExprRef</span>.
	</p>
	
	<p>
	  Additionally, a <span class="jobjref"><a href="#dfn-shapeexprlabel" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexprlabel-8">shapeExprLabel</a></span> cannot refer to itself through a shape reference either directly or recursively.
	  The <dfn id="dfn-shapeexprref-closure" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">shapeExprRef closure</dfn> of a <a href="#dfn-shape-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-expressions-9">shape expression</a> <span class="math">se</span> is the set of shape expression labels used as references in <span class="math">se</span>.
	  The <a href="#dfn-shapeexprlabel" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexprlabel-9">shapeExprLabel</a> <span class="math">sl</span> belongs to <code class="function">shapeExprRefClosure(<span class="math">se</span>)</code> if and only if:
	</p>
	<ul>
	  <li>
	    <span class="math">sl</span> appears as an atomic <span class="jobjref"><a href="#dfn-shapeexprref" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexprref-10">shapeExprRef</a></span> in <span class="math">se</span>, or
	  </li>
	  <li>

	    <span class="math">sl</span> belongs to <code class="function">shapeExprRefClosure(shapeExprWithId(<span class="math">sl2</span>))</code> for some <a href="#dfn-shapeexprlabel" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexprlabel-10">shapeExprLabel</a> <span class="math">sl2</span> that belongs to <code class="function">shapeExprRefClosure(<span class="math">se</span>)</code>.
	  </li>
	</ul>
	<p>
	  A shapes schema <em class="rfc2119">MUST NOT<!---0.294583%--></em> define a shape label <span class="math">sl</span> that belongs to the shapeExprRef closure of its definition  <code class="function">shapeExprWithId(<span class="math">sl</span>)</code>.
	</p>
	
      <div class="example">
        <p>
          Following are two valid shapeExprRefs:
        </p>
        <div class="repchoice" tabindex="0">
          <pre class="json nohighlight repchosen">{"type" : "Schema",
  "shapes" : [ {
    "id" : "http://schema.example/#PersonShape",
    "type" : "Shape",
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://xmlns.com/foaf/0.1/name"
    }
  }, {
    "id" : "http://schema.example/#EmployeeShape",
    "type" : "ShapeAnd",
    "shapeExprs" : [ "http://schema.example/#PersonShape", {
      "type" : "Shape",
      "expression" : {
        "type" : "TripleConstraint",
        "predicate" : "http://schema.example/#employeeNumber"
      }
    } ]
  } ]
}</pre>
          
        </div>
        <div class="repchoice" tabindex="0">
          <pre class="json nohighlight repchosen">{"type" : "Schema",
  "shapes" : [ {
    "id" : "http://schema.example/#PersonShape",
    "type" : "Shape",
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://xmlns.com/foaf/0.1/name"
    }
  }, {
    "id" : "http://schema.example/#EmployeeShape",
    "type" : "Shape",
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#dependent",
      "valueExpr" : "http://schema.example/#PersonShape",
      "min" : 0,
      "max" : -1
    }
  } ]
}</pre>
          
        </div>
        <p>
          This shapeExprRef is invalid because there is no corresponding <a href="#dfn-shape-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-expressions-10">shape expression</a>:
        </p>
        <div class="repchoice error" tabindex="0">
          <pre class="json nohighlight repchosen">{ "type":"Schema", "shapes": [
    { "id": "http://schema.example/#S1",
      "type":"Shape", "expression":
        "http://schema.example/#MissingShapeExpr"
} ] }</pre>
          
        </div>
        <p>This shapeExprRef is invalid because the referenced object is a <a href="#dfn-triple-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-triple-expressions-5">triple expression</a> instead of a <a href="#dfn-shape-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-expressions-11">shape expression</a>:</p>
        <div class="repchoice error" tabindex="0">
          <pre class="json nohighlight repchosen">{"type" : "Schema",
  "shapes" : [ {
    "id" : "http://schema.example/#CustomerShape",
    "type" : "Shape",
    "expression" : {
      "id" : "http://schema.example/#discountExpr",
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#discount"
    }
  }, {
    "id" : "http://schema.example/#EmployeeShape",
    "type" : "Shape",
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#contactFor",
      "valueExpr" : "http://schema.example/#discountExpr"
    }
  } ]
}</pre>
          
        </div>
	<p>These shapeExprRefs are invalid because they recursively refer to each other.</p>
	<div class="repchoice error" tabindex="0">
          <pre class="json nohighlight repchosen">{"type" : "Schema",
  "shapes" : [ {
    "id" : "http://schema.example/#PersonShape",
    "type" : "ShapeAnd",
    "shapeExprs" : [ "http://schema.example/#EmployeeShape", {
      "type" : "Shape",
      "expression" : {
        "type" : "TripleConstraint",
        "predicate" : "http://xmlns.com/foaf/0.1/name"
      }
    } ]
  }, {
    "id" : "http://schema.example/#EmployeeShape",
    "type" : "ShapeAnd",
    "shapeExprs" : [ "http://schema.example/#PersonShape", {
      "type" : "Shape",
      "expression" : {
        "type" : "TripleConstraint",
        "predicate" : "http://schema.example/#employeeNumber"
      }
    } ]
  } ] }</pre>
          
        </div>
      </div>
      </section>

      <section id="tripleExprRef-requirement"><div class="header-wrapper"><h4 id="x6-7-3-triple-expression-reference-requirement">Triple Expression Reference Requirement</h4></div>
        
        <p>An <span class="jobjref"><a href="#dfn-tripleexprref" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleexprref-6">tripleExprRef</a></span> <em class="rfc2119">MUST<!---0.294583%--></em> identify a <a href="#dfn-triple-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-triple-expressions-6">triple expression</a> in the schema.
          The function <code><dfn id="dfn-tripleexprwithid" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">tripleExprWithId</dfn>(<span class="math">tripleExprRef</span>)</code> returns the <a href="#dfn-triple-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-triple-expressions-7">triple expression</a> with the id <span class="math">tripleExprRef</span>.
	</p>

	<p>
	  Additionally, a <span class="jobjref"><a href="#dfn-tripleexprlabel" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleexprlabel-9">tripleExprLabel</a></span> cannot refer to itself through a triple expression reference either directly or recursively.
	  The <dfn id="dfn-tripleexprref-closure" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">tripleExprRef closure</dfn> of a <a href="#dfn-triple-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-triple-expressions-8">triple expression</a> <span class="math">te</span> is the set of triple expression labels used as references in <span class="math">te</span>.
	  The <a href="#dfn-tripleexprlabel" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleexprlabel-10">tripleExprLabel</a> <span class="math">tl</span> belongs to <code class="function">tripleExprRefClosure(<span class="math">te</span>)</code> if and only if:
	</p>
	<ul>
	  <li>
	    <span class="math">tl</span> appears as an atomic <span class="jobjref"><a href="#dfn-tripleexprref" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleexprref-7">tripleExprRef</a></span> in <span class="math">te</span>, or
	  </li>
	  <li>

	    <span class="math">tl</span> belongs to <code class="function">tripleExprRefClosure(tripleExprWithId(<span class="math">tl2</span>))</code> for some <a href="#dfn-tripleexprlabel" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleexprlabel-11">tripleExprLabel</a> <span class="math">tl2</span> that belongs to <code class="function">tripleExprRefClosure(<span class="math">te</span>)</code>.
	  </li>
	</ul>
	<p>
	  A shapes schema <em class="rfc2119">MUST NOT<!---0.294583%--></em> define a triple expression label <span class="math">tl</span> that belongs to the tripleExprRef closure of its definition <code class="function">tripleExprWithId(<span class="math">tl</span>)</code>.
	</p>
	
      <div class="example">
        <p>
          Following is a valid <a href="#dfn-triple-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-triple-expressions-9">triple expression</a> reference:
        </p>
        <div class="repchoice" tabindex="0">
          <pre class="json nohighlight repchosen">{ "type":"Schema", "shapes": [
    { "id": "http://schema.example/#PersonShape",
      "type":"Shape", "expression": {
        "id": "http://schema.example/#nameExpr",
        "type": "TripleConstraint",
        "predicate": "http://xmlns.com/foaf/0.1/name"
      } },
    { "id": "http://schema.example/#EmployeeShape",
      "type":"Shape", "expression": { "type":"EachOf", "expressions": [
        "http://schema.example/#nameExpr",
        { "type": "TripleConstraint",
          "predicate": "http://schema.example/#employeeNumber" }
] } } ] }</pre>
          
        </div>
        <p>
          This <a href="#dfn-triple-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-triple-expressions-10">triple expression</a> reference is invalid because there is no corresponding triple expression:
        </p>
        <div class="repchoice error" tabindex="0">
          <pre class="json nohighlight repchosen">{ "type":"Schema", "shapes": [
    { "id": "http://schema.example/#S1",
      "type":"Shape", "expression":
        "http://schema.example/#missingTripleExpr"
} ] }</pre>
          
        </div>
        <p>This triple expression reference is invalid because the referenced object is a <a href="#dfn-shape-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-expressions-12">shape expression</a> instead of a triple expression:</p>
        <div class="repchoice error incomplete" tabindex="0">
          <pre class="json nohighlight repchosen">{ "type":"Schema", "shapes": [
    { "id": "http://schema.example/#CustomerShape",
      "type":"ShapeAnd", "shapeExprs": [ … ]
    },
    { "id": "http://schema.example/#PreferredCustomerShape",
      "type":"Shape", "expression": { "type":"EachOf", "expressions": [
        "http://schema.example/#CustomerShape",
        { "type": "TripleConstraint",
          "predicate": "http://schema.example/#discount" }
] } } ] }</pre>
          
        </div>
      </div>
      </section>

      <section id="shapeExprRef-non-abstract-shape-requirement"><div class="header-wrapper"><h4 id="x6-7-4-shapeexprref-non-abstract-shape-requirement">shapeExprRef non-abstract shape requirement</h4></div>
        
        <p>
          Every <a href="#dfn-shapeexprref" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexprref-11">shapeExprRef</a> <var>referer<!---0.294583%--></var> <em class="rfc2119">MUST<!---0.294583%--></em> identify at least one non-abstract shape.
	</p>

      <div class="example">
        <p>
          Following is a valid example with a shape with a <a href="#dfn-shapeexprref" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexprref-12">shapeExprRef</a> that references an abstract shape with two non-abstract descendants:
        </p>
        <div class="repchoice" tabindex="0">
          <pre class="json nohighlight repchosen">{"type" : "Schema",
  "shapes" : [ {
    "id": "http://schema.example/#IssueShape",
    "type": "Shape",
    "expression": {
      "type": "TripleConstraint",
      "predicate": "http://schema.example/#approvedBy",
      "valueExpr": "http://schema.example/#EngineerShape"
    }
  },  {
    "id" : "http://schema.example/#EntityShape",
    "type" : "Shape", "abstract": true,
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#entityId"
    }
  },  {
    "id" : "http://schema.example/#PersonShape",
    "type" : "Shape",
    "extends" : [ "http://schema.example/#EntityShape" ],
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://xmlns.com/foaf/0.1/name"
    }
  }, {
    "id" : "http://schema.example/#EmployeeShape",
    "type" : "Shape",
    "extends" : [ "http://schema.example/#PersonShape" ],
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#employeeNumber"
    }
} ] }</pre>
          
        </div>
        <p>
          This <a href="#dfn-shapeexprref" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexprref-13">shapeExprRef</a> is invalid because it references only abstract descendants:
        </p>
        <div class="repchoice error" tabindex="0">
          <pre class="json nohighlight repchosen">{"type" : "Schema",
  "shapes" : [ {
    "id": "http://schema.example/#IssueShape",
    "type": "Shape",
    "expression": {
      "type": "TripleConstraint",
      "predicate": "http://schema.example/#approvedBy",
      "valueExpr": "http://schema.example/#EngineerShape"
    }
  },  {
    "id" : "http://schema.example/#EntityShape",
    "type" : "Shape", "abstract": true,
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#entityId"
    }
  },  {
    "id" : "http://schema.example/#PersonShape",
    "type" : "Shape", "abstract": true,
    "extends" : [ "http://schema.example/#EntityShape" ],
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://xmlns.com/foaf/0.1/name"
    }
  }, {
    "id" : "http://schema.example/#EmployeeShape",
    "type" : "Shape", "abstract": true,
    "extends" : [ "http://schema.example/#PersonShape" ],
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#employeeNumber"
    }
} ] }</pre>
          
        </div>
      </div>
      </section>

      <section id="negation-requirement"><div class="header-wrapper"><h4 id="x6-7-5-negation-requirement">Negation Requirement</h4></div>
        
        <p>
          A schema <em class="rfc2119">MUST NOT<!---0.294583%--></em> contain any <a href="#dfn-shapeexprlabel" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexprlabel-11">shapeExprLabel</a> that has a <a href="#dfn-negated-reference" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-negated-reference-1">negated reference</a> to itself, either directly or transitively.
	  This is formalized by the requirement that the <a href="#dfn-hierarchy-and-dependency-graph" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hierarchy-and-dependency-graph-2">hierarchy and dependency graph</a> of a schema <em class="rfc2119">MUST NOT<!---0.294583%--></em> have a cycle that traverses some <a href="#dfn-negated-reference" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-negated-reference-2">negated reference</a>.
        </p>

        <p class="leadup">
	  The set of <dfn id="dfn-atomic-shapes" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">atomic shapes</dfn> of a <a href="#dfn-shapeexpr" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexpr-21">shapeExpr</a> <span class="math">se</span> contains a <a href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-15">Shape</a> <span class="math">s</span> if <span class="math">s</span> or its <span class="path">id</span> appears either directly or by <a href="#dfn-shapeexprref" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapeexprref-14">shapeExprRef</a> in <span class="math">se</span>.
	  That is, <span class="math">s</span> belongs to <code class="function">atomicShapes(<span class="math">se</span>)</code> if and only if 
	</p>
        <ul class="followup leadup">
	  <li>
	    <span class="math">s</span> appears as an atomic shape in <span class="math">se</span>, or
	  </li>
	  <li>
	    <span class="math">sid</span> is the <span class="param">id</span> of <span class="math">s</span> and <span class="math">sid</span> appears as an atomic shapeExprRef in <span class="math">se</span>, or
	  </li>
          <li>
	    <span class="math">s</span> belongs to <code>atomicShapes(se2)</code> for some shape expression <span class="math">se2</span> such that the <span class="param">id</span> of <span class="math">se2</span> belongs to the shapeExprRefClosure of <span class="math">se</span>.
	  </li>
<!--
          <li>
	    <span class="math">se</span> is a <a>ShapeOr</a> and <span class="math">te</span> belongs to the tripleExpr closure of some <span class="math">se1</span> in <span class="math">se</span>.<span class="param">shapeExprs</span> or
	  </li>
          <li>
	    <span class="math">se</span> is a <a>ShapeNot</a> and <span class="math">te</span> belongs to the tripleExpr closure of <span class="math">se</span>.<span class="param">shapeExpr</span>
	  </li>
	  <li>
	    <span class="math">se</span> is a <a>shapeExprRef</a> and <span class="math">te</span> belongs to the tripleExpr closure of the shapeExpr <span class="math">se1</span> that has <span class="math">se</span> as <span class="param">id</span> (that is, <span class="math">se1</span>.<span class="param">id</span> = <span class="math">se</span>).
	  </li>
-->
        </ul>
        <!-- p class="followup">
          If <span class="param">SE</span> is a shape <span class="param">S</span>, the shapeExpr closure of <span class="param">SE</span> is <span class="param">S</span>.
          A shapeExpr <span class="param">SE</span> <code>contains</code> shape <span class="param">S</span> if <span class="param">S</span> appears in the shapeExpr closure of <span class="param">SE</span>.
        </p -->

        <p class="leadup">The set of <dfn id="dfn-atomictripleconstraints" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">atomicTripleConstraints</dfn> of a <a href="#dfn-tripleexpr" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleexpr-7">tripleExpr</a> <span class="math">te</span> includes every <a href="#dfn-tripleconstraint" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleconstraint-9">TripleConstraint</a> <span class="math">tc</span> that appears directly or by <a href="#dfn-tripleexprref" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleexprref-8">tripleExprRef</a> in <span class="math">te</span>.
	  That is, <span class="math">tc</span> belongs to <code class="function"><a href="#dfn-atomictripleconstraints" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-atomictripleconstraints-1">atomicTripleConstraints</a>(<span class="math">te</span>)</code> if and only if:
	</p>
        <ul>
          <li>
	    <span class="math">tc</span> is an atomic <a href="#dfn-tripleconstraint" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleconstraint-10">TripleConstraint</a> in <span class="math">te</span>, or
	  </li>
          <li>
	    <span class="math">te</span> is an atomic <a href="#dfn-tripleconstraint" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleconstraint-11">TripleConstraint</a> in <code class="function">tripleExprWithId(<span class="math">tl</span>)</code> for some <a href="#dfn-tripleexprlabel" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleexprlabel-12">tripleExprLabel</a> <span class="math">tl</span> that belongs to <code class="function">tripleExprRefClosure(<span class="math">te</span>)</code>.
	  </li>
<!--
	  <li>
	    <span class="math">te</span> is a <a>EachOf</a> and <span class="math">tc</span> belongs to the tripleConstraint closure of some <span class="math">te1</span> in <span class="math">te</span>.<span class="param">expressions</span> or
	  </li>
	  <li>
	    <span class="math">te</span> is a <a>tripleExprLabel</a> and <span class="math">tc</span> belongs to the tripleConstraint closure of the triple expression <span class="math">te1</span> that has <span class="math">te</span> as id (that is, <span class="math">te1</span>.<span class="param">id</span> = <span class="math">te</span>)
	  </li>
-->
        </ul>
        <!-- p class="followup">
          If <span class="param">TE</span> is a TripleConstraint <span class="param">TC</span>, the closure of <span class="param">TE</span> is <span class="param">TC</span>.
          A tripleExpr <span class="param">TE</span> <code>contains</code> TripleConstraint <span class="param">TC</span> if <span class="param">TC</span> appears in the closure of <span class="param">TE</span>.
        </p -->

        <p>
          The shape expression s1 has a reference to the shape label l2 if 
        </p>
        <ul>
          <li>there is a shape sh in atomicShapes(s1) and</li>
          <li>there is a triple constraint tc in atomicTripleConstraints(sh) and </li>
          <li>tc.valueExpr is present and </li>
          <li>tc.valueExpr contains a shape reference to l2.</li>
        </ul>

        <!--
        <p class="leadup">
	  The <a>Shape</a> <span class="math">s1</span> has a <dfn>reference</dfn> to the <a>Shape</a> <span class="math">s2</span> if
        </p>
        <ul class="followup">
	  <li>
	    <span class="math">s1</span>.<span class="param">expression</span> is present, and
	  </li>
	  <li>
	    there is a triple constraint <span class="math">tc</span> that belongs to <code class="function"><a>atomicTripleConstraints</a>(<span class="math">s1</span>.<span class="param">expression</span>)</code>, and
	  </li>
          <li>
	    <span class="math">tc</span>.<span class="param">valueExpr</span> is present, and
	  </li>
	  <li>
	    <span class="math">s2</span> belongs to <code>atomicShapes(<span class="math">tc</span>.<span class="param">valueExpr</span>)</code>.
	  </li>
	</ul>-->
<!--
	    <span class="param">SE<sub>2</sub></span> appears in the <a>shapeExpr closure</a> of <span class="param">SE<sub>1</sub></span> or</li>
          <li><span class="param">SE<sub>2</sub></span> appears in a <a>TripleConstraint</a><span class="param">.valueExpr</span> of a shape in <span class="param">SE<sub>1</sub></span>, i.e.
        <ul class="followup">
          <li class="followup leadup">some shape <span class="param">S</span> appears in the <a>shapeExpr closure</a> of <span class="param">SE<sub>1</sub></span> and</li>
          <li class="followup leadup">some <a>TripleConstraint</a> <span class="param">TC</span> appears in the <a>tripleExpr closure</a> of <span class="param">S</span>.<span class="param">tripleExprs</span> and</li>
          <li>the tripleExpr <span class="param">SE<sub>2</sub></span> appears in the <a>shapeExpr closure</a> of <span class="param">TC</span>.</li>
        </ul>
-->
        <p class="leadup">
	  The reference from <span class="math">s1</span> to <span class="math">l2</span> is a <dfn id="dfn-negated-reference" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">negated reference</dfn> if the reference to l2 appears under an odd number of ShapeNot in tc.valueExpr.</p>
<!--	<ul>
	  <li>
	    <span class="math">s2</span> appears under an odd number of <a>ShapeNot</a> in the shapeExprRef closure of <span class="math">tc</span>.<span class="param">valueExpr</span>, or
          </li>
	  <li>
	    <span class="math">tc</span> has <span class="param">predicate</span> <span class="math">p</span> and <span class="math">s1</span> has <span class="param">extra</span> <span class="math">p</span>.
	  </li>
	</ul>-->
	    <!-- appears within the <span class="param">valueExpr</span> of a <span class="jobjref"><a>TripleConstraint</a></span> with <a class="param">predicate</a> <span class="math">p</span> inside a <span class="jobjref"><a>Shape</a></span> with <span class="param">extra</span> <span class="math">p</span>, there is an additional reference from <span class="param">SE<sub>1</sub></span> to <span class="param">SE<sub>2</sub></span> with the opposite sense of <span class="param">negated</span>. -->


      <p>
        The <dfn id="dfn-hierarchy-and-dependency-graph" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">hierarchy and dependency graph</dfn> of a schema is the graph whose nodes are the shape labels that appear in the shape declarations of the schema, and that has an edge from l1 to l2 if:
        </p><ul>
          <li>the definition of l1 has a reference to l2, or</li>
          <li>there is an edge from l1 to l2 in the hieararchy graph, or</li>
          <li>there is an edge from l2 to l1 in the hieararchy graph.</li>
        </ul>
        The edge from l1 to l2 is negative if the definition of l1 has a negative reference to l2, otherwise the edge is positive.
      <p></p>

<!--	<p>
	  The <dfn>dependency graph</dfn> of the schema <span class="math">Sch</span> is the graph whose vertices are all the <a>Shape</a>s that appear in some shape expression in the <span class="param">shapes</span> of <span class="math">Sch</span>, and that has two kinds of edges: negative and positive.
	  There is a negative edge from <span class="math">s1</span> to <span class="math">s2</span> if <span class="math">s1</span> has a <a>negated reference</a> to <span class="math">s2</span>.
	  There is a positive edge from <span class="math">s1</span> to <span class="math">s2</span> if <span class="math">s1</span> has a reference but not a negated reference to <span class="math">s2</span>.
	</p>-->
        <div class="example">
            <div class="header-wrapper"><h4 class="followup" id="examples-with-shapenot">Examples with <span class="jobjref"><a href="#dfn-shapenot" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapenot-5">ShapeNot</a></span></h4></div>
            <p>
              This negated self-reference violates the negation requirement.
            </p>
            <div class="repchoice error" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
    { "id": "http://schema.example/#S",
      "type": "Shape",
      "expression": { "type": "TripleConstraint",
        "predicate": "http://schema.example/#p",
        "valueExpr": { "type": "ShapeNot",
          "shapeExpr": "http://schema.example/#S" } } }
  ] }</pre>
              
              </div>
              <p>
                This indirect self-reference does not violate the negation requirement.
              </p>
              <div class="repchoice" tabindex="0">
                <pre class="json nohighlight repchosen">{ "type": "Schema",
  "shapes": [
    { "id": "http://schema.example/#US",
      "type": "Shape",
      "expression": { "type": "TripleConstraint",
        "predicate": "http://schema.example/#Up",
        "valueExpr": { "type": "ShapeNot",
          "shapeExpr": "http://schema.example/#UT" } } },
    { "id": "http://schema.example/#UT",
      "type": "Shape",
      "expression": { "type": "TripleConstraint",
        "predicate": "http://schema.example/#Uq",
        "valueExpr": "http://schema.example/#US" } }
  ] }</pre>
                
              </div>
              <p>
                This negated, indirect self-reference violates the negation requirement.
              </p>
              <div class="repchoice error" tabindex="0">
                <pre class="json nohighlight repchosen">{"type" : "Schema",
  "shapes" : [ {
    "id" : "http://schema.example/#S",
    "type" : "Shape",
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#p",
      "valueExpr" : {
        "type" : "ShapeNot",
        "shapeExpr" : "http://schema.example/#T"
      }
    }
  } , {
    "id" : "http://schema.example/#T",
    "type" : "Shape",
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#q",
      "valueExpr" : "http://schema.example/#S"
    }
  } ] }</pre>
                
              </div>
              <p>
                This is a direct, negated self-reference of the shape with id ex:T and violates the negation requirement.

              </p>
              <div class="repchoice error" tabindex="0">
                <pre class="json nohighlight repchosen">{"type" : "Schema",
  "shapes" : [ {
    "id" : "http://schema.example/#T",
    "type" : "Shape",
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#p",
      "valueExpr" : "http://schema.example/#S"
    }
  } , {
    "id" : "http://schema.example/#S",
    "type" : "ShapeAnd",
    "shapeExprs" : [ {
      "type" : "ShapeNot",
      "shapeExpr" : "http://schema.example/#T"
    }, "http://schema.example/#U" ]
  }, {
    "id" : "http://schema.example/#U",
    "type" : "Shape"
  } ] }</pre>
                
              </div>
              <p>
                This doubly-negated self-reference of ex:T does not violate the negation requirement.
              </p>
              <div class="repchoice" tabindex="0">
                <pre class="json nohighlight repchosen">{"type" : "Schema",
  "shapes" : [{
    "id" : "http://schema.example/#T",
    "type" : "Shape",
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#p",
      "valueExpr" : "http://schema.example/#S"
    }
  } , {
    "id" : "http://schema.example/#S",
    "type" : "ShapeNot",
    "shapeExpr" : {
      "type" : "ShapeAnd",
      "shapeExprs" : [ {
        "type" : "ShapeNot",
        "shapeExpr" : "http://schema.example/#T"
      }, "http://schema.example/#U" ]
    }
  }, {
    "id" : "http://schema.example/#U",
    "type" : "Shape"
  } ] }</pre>
                
              </div>
              <p>
		There is a cycle of negated references between the shape that defines ex:T and the shape that defines ex:U, so the negation requirement is violated.
              </p>
              <div class="repchoice error" tabindex="0">
                <pre class="json nohighlight repchosen">{"type" : "Schema",
  "shapes" : [{
    "id" : "http://schema.example/#T",
    "type" : "Shape",
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#p",
      "valueExpr" : {
        "type" : "ShapeNot",
        "shapeExpr" : "http://schema.example/#S"
      }
    }
  } , {
    "id" : "http://schema.example/#U",
    "type" : "Shape",
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#q",
      "valueExpr" : "http://schema.example/#S"
    }
  }, {
    "id" : "http://schema.example/#S",
    "type" : "ShapeAnd",
    "shapeExprs" : [ {
      "type" : "ShapeNot",
      "shapeExpr" : "http://schema.example/#T"
    }, "http://schema.example/#U" ]
  } ] }</pre>
                

	      </div>
	  <p>
		  This satisfies the negation requirement, as ex:U does not refer to ex:T (compared to the previous example).
          </p>
          <div class="repchoice" tabindex="0">
            <pre class="json nohighlight repchosen">{"type" : "Schema",
  "shapes" : [{
    "id" : "http://schema.example/#T",
    "type" : "Shape",
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#p",
      "valueExpr" : {
        "type" : "ShapeNot",
        "shapeExpr" : "http://schema.example/#S"
      }
    }
  } , {
    "id" : "http://schema.example/#U",
    "type" : "Shape",
    "expression" : {
      "type" : "TripleConstraint",
      "predicate" : "http://schema.example/#q"
    }
  }, {
    "id" : "http://schema.example/#S",
    "type" : "ShapeAnd",
    "shapeExprs" : [ {
      "type" : "ShapeNot",
      "shapeExpr" : "http://schema.example/#T"
    }, "http://schema.example/#U" ]
  } ] }</pre>
            
              </div>
          </div>
          <div class="example">
            <div class="header-wrapper"><h4 class="followup" id="examples-with-shape-extra-predicate">Examples with <span class="jobjref"><a href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-16">Shape</a></span><span class="param">.extra</span> predicate</h4></div>
            <p>
              This self-reference on a <a data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicate</a> designated as <span class="param">extra</span> violates the negation requirement:
            </p>
            <div class="repchoice error" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
    { "id": "http://schema.example/#S",
      "type": "Shape",
      "extra": [ "http://schema.example/#p" ], "expression":
      { "type": "TripleConstraint",
        "predicate": "http://schema.example/#p",
        "valueExpr": "http://schema.example/#S"
} } ] }</pre>
              
            </div>
            <p>
              The same shape with a negated self-reference still violates the negation requirement because the reference occurs with a <span class="jobjref"><a href="#dfn-shapenot" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapenot-6">ShapeNot</a></span>:
            </p>
            <div class="repchoice error" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
    { "id": "http://schema.example/#S",
      "type": "Shape",
      "extra": [ "http://schema.example/#p" ],
      "expression": {
        "type": "TripleConstraint",
        "predicate": "http://schema.example/#p",
        "valueExpr": {
          "type": "ShapeNot", "shapeExpr": "http://schema.example/#S"
} } } ] }</pre>
              
            </div>
          </div>
    </section>

    <section id="acyclic-extension-requirement"><div class="header-wrapper"><h4 id="x6-7-6-acyclic-extension-requirement">Acyclic Extension Requirement</h4></div>
      

      <p>The <a href="#dfn-extension-hierarchy-graph" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-extension-hierarchy-graph-3">extension hierarchy graph</a> must be acyclic.</p>
    </section>

    <section id="extension-coherence-requirement"><div class="header-wrapper"><h4 id="x6-7-7-extension-coherence">Extension Coherence</h4></div>
      

      <p>
        A <a href="#dfn-shapedecl" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapedecl-5">shapeDecl</a> <span class="var">D</span> with label <span class="var">L</span> and <span class="math">D.shapeExpr</span> <span class="var">se</span> is called <dfn id="dfn-extendable" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">extendable</dfn> if it satisfies all of:
      </p>
      <ul>
	<li>it is of the form either <code>s<!---0.294583%--></code> or <span class="math">ShapeAnd(s, se)</span>, where <code>s<!---0.294583%--></code> is a Shape and <span class="math">se</span> is a shapeExpr. In this case we denote <code>s<!---0.294583%--></code> as `<dfn id="dfn-mainshape" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">mainShape</dfn>(L)` and <span class="math">se</span> as <code>constraint(L)<!---0.294583%--></code>:</li>
	<li><code>def(L')<!---0.294583%--></code> is an extendable shape expression for every <code>L'<!---0.294583%--></code> in <code>s.extends<!---0.294583%--></code> (note that this condition is trivially met when <code>s.extends<!---0.294583%--></code> is empty),</li>
	<li>the set `predicates(<span class="var">se</span>)<code> is included the union of the sets <!---0.294583%--></code>predicates(<a href="#dfn-mainshape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-mainshape-1">mainShape</a>(L'))<code> for all shape expression names <!---0.294583%--></code>L'<code> that belong to <!---0.294583%--></code><a href="#dfn-parentshapelabels" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-parentshapelabels-1">parentShapeLabels</a>(L)`. </li>
      </ul>
	<p>
	  <b>Schema requirement</b> EXTENDS appears only in extendable shape expressions. That is, for every Shape <code>s<!---0.294583%--></code> that appears in the schema, if <code>s.extends<!---0.294583%--></code> is non empty and for every shapeExpr <span class="math">se</span> in the schema, if <span class="var">s</span> belongs to <span class="math"><a href="#dfn-nestedshapes" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-nestedshapes-10">nestedShapes</a>(<span class="var">se</span>)</span>, then <span class="math">se</span> is an extendable shape expression.
	</p>
    </section>

    </section>

      <section id="semantic-actions"><div class="header-wrapper"><h3 id="x6-8-semantic-actions">Semantic Actions</h3></div>
        
        <p>
          Semantic actions serve as an extension point for Shape Expressions.
          They appear in lists in <span class="jobjref"><a href="#dfn-shapes-schema" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapes-schema-6">Schema</a></span>'s <span class="param">startActs</span> and <span class="jobjref"><a href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-17">Shape</a></span>, <span class="jobjref"><a href="#dfn-oneof" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-oneof-3">OneOf</a></span>, <span class="jobjref"><a href="#dfn-eachof" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-eachof-5">EachOf</a></span> and <span class="jobjref"><a href="#dfn-tripleconstraint" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleconstraint-12">TripleConstraint</a></span>'s <span class="param">semActs</span>.
        </p>
        <p>
          A semantic action is a tuple of an identifier and some optional code:
        </p>
        <div class="shexjTable">
          <pre><b>SemAct</b> { name:IRIREF code:STRING? }</pre>
        </div>
        <section id="semantic-actions-semantics"><div class="header-wrapper"><h4 id="x6-8-1-semantics">Semantics</h4></div>
          
          <p>
            The evaluation <span id="semActsSatisfied" class="label">semActsSatisfied</span> on a list of <span class="jobjref"><a href="#dfn-semact" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-semact-9">SemAct</a></span>s returns success or failure.
            The evaluation of an individual <span class="jobjref"><a href="#dfn-semact" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-semact-10">SemAct</a></span> is implementation-dependent.
          </p>
        </section>
        <section id="semantic-actions-uses"><div class="header-wrapper"><h4 id="x6-8-2-use-informative">Use - informative</h4></div>
          
          <p>
            A practical evaluation of a <span class="jobjref"><a href="#dfn-semact" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-semact-11">SemAct</a></span> will provide access to some context.
            For instance, the <a href="http://shex.io/extensions/Test/#def">http://shex.io/extensions/Test/</a> extension requires access to the subject, <a data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicate</a> and object of a triple matching a <span class="jobjref"><a href="#dfn-tripleconstraint" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleconstraint-13">TripleConstraint</a></span>.
            These are used in a <code>print</code> function.
          </p>
          <div class="example">
            <div class="example-title marker"><span>Semantic Actions example 1</span></div>
            <div class="repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
    { "id": "http://schema.example/#S1",
      "type": "Shape", "expression": {
        "type": "TripleConstraint", "predicate": "http://schema.example/#p1",
        "min": 1, "max": -1,
        "semActs": [
          { "type": "SemAct", "code": " print(s) ",
            "name": "http://shex.io/extensions/Test/" },
          { "type": "SemAct", "code": " print(o) ",
            "name": "http://shex.io/extensions/Test/" } ] } } ] }</pre>
              
            </div>
            <pre class="data" aria-busy="false"><code class="hljs">&lt;http://a.example/n1&gt; &lt;http://a.example/p1&gt; &lt;http://a.example/o1&gt; .
&lt;http://a.example/n2&gt; &lt;http://a.example/p1&gt; "a", "b" .
&lt;http://a.example/n3&gt; &lt;http://a.example/p2&gt; &lt;http://a.example/o2&gt; .</code></pre>
            <pre>node | shape | result | print arguments                             
&lt;n1&gt; | &lt;S1&gt;  | pass   | http://a.example/s1http://a.example/o1      
&lt;n2&gt; | &lt;S1&gt;  | pass   | http://a.example/s1"a"http://a.example/s1"b"
&lt;n3&gt; | &lt;S1&gt;  | fail   |                                             </pre>
          </div>
        </section>
      </section>

      <section id="annotations"><div class="header-wrapper"><h3 id="x6-9-annotations">Annotations</h3></div>
        
        <p>
          Annotations provide a format-independent way to provide additional information about elements in a schema.
          They appear in lists in <span class="jobjref"><a href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-18">Shape</a></span>, <span class="jobjref"><a href="#dfn-oneof" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-oneof-4">OneOf</a></span>, <span class="jobjref"><a href="#dfn-eachof" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-eachof-6">EachOf</a></span> and <span class="jobjref"><a href="#dfn-tripleconstraint" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-tripleconstraint-14">TripleConstraint</a></span>'s <span class="param">annotations</span>.
        </p>
        <div class="shexjTable">
          <pre><b>Annotation</b> { predicate:IRIREF object:objectValue }</pre>
        </div>
        <section id="annotations-semantics"><div class="header-wrapper"><h4 id="x6-9-1-semantics-informative">Semantics - informative</h4></div>
          
          <p>
            Annotations do not affect whether a node conforms to some shape.
            Because they are part of the structure of the schema, they can be parsed in one ShEx format and emitted in that format or another.
          </p>
          <div class="example">
            <div class="example-title marker"><span>Annotations example 1</span></div>
            <div class="repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">{ "type": "Schema", "shapes": [
    { "id": "http://schema.example/#IssueShape",
      "type": "Shape", "expression": {
        "type": "TripleConstraint",
        "predicate": "http://schema.example/#status",
        "annotations": [
           { "type": "Annotation",
             "predicate": "http://www.w3.org/2000/01/rdf-schema#comment",
             "object": {"value": "Represents reported software issues."} },
           { "type": "Annotation",
             "predicate": "http://www.w3.org/2000/01/rdf-schema#label",
             "object": {"value": "software issue"} } ] } } ] }</pre>
              
            </div>
          </div>
        </section>
    </section>

      <section id="validation-examples"><div class="header-wrapper"><h3 id="x6-10-validation-examples">Validation Examples</h3></div>
        
        <p>
          The following examples demonstrate proofs for validations in the form of a nested list of invocations of the evaluation functions defined above.
        </p>
        <section id="example-simple"><div class="header-wrapper"><h4 id="x6-10-1-simple-examples">Simple Examples</h4></div>
          
          <!--
              BASE <http://schema.example/#>
              PREFIX ex: <http://schema.example/#>
              PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
              PREFIX foaf: <http://xmlns.com/foaf/0.1/>
              PREFIX dc: <http://purl.org/dc/elements/1.1/>
              <IntConstraint> xsd:integer
          -->
          <div class="example">
              <span class="exsec">Schema:</span><br>
              
            <div class="inline repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">&nbsp;   | { "type": "Schema", "shapes": [
S1  |     { "id": "http://schema.example/#IntConstraint",
    |       "type": "NodeConstraint",
nc1 |       "datatype": "http://www.w3.org/2001/XMLSchema#integer"
    |     } ] }</pre>
              
            </div>
            <div style="clear:both;"></div>
<!--             Data:<br/>
            <pre class="line-labels">


<span class="lineno data">t1</span></pre>
            <div class="inline json">
              <pre>PREFIX ex: &lt;http://schema.example/#&gt;
PREFIX xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt;
ex:someNode ex:somePredicate "30"^^xsd:integer .
</pre>
            </div>
            <div style="clear:both;"></div> -->
            <p>
              Here the shape identified by <code>http://schema.example/#IntConstraint</code> is a <a href="#dfn-shape-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-expressions-13">shape expression</a> consisting of a single <span class="jobjref"><a class="obj internalDFN" href="#dfn-nodeconstraint" data-link-type="dfn" id="ref-for-dfn-nodeconstraint-8">NodeConstraint</a></span>.
              Per <a href="#shape-expression-semantics">Shape Expression Semantics</a>, "30"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; satisfies <span class="lineno schema">IntConstraint</span>.
            </p>
            <p>
              This document uses this nested tree convention to indicate that the dependency of an evaluation on those nested inside it.
              Nesting is expressed as indentation.
              Here, the evaluation of <span class="math function">satisfies NodeConstraint ("30"^^xsd:integer, S1, G, m)</span> depends on <span class="math function">satisfies2 NodeConstraint ("30"^^xsd:integer, S1)</span>.
            </p>
            <div class="validation"><span>Validate</span> <span>"30"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt;</span> as <span class="hljs-string">IntConstraint</span>:</div>
            <ul class="trace followup">
              <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("30"^^xsd:integer, <span class="lineno schema">S1</span>, G, m)
              <ul>
                <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("30"^^xsd:integer, <span class="lineno schema">S1</span>)</li>
              </ul></li>
            </ul>
          </div>

          <p class="leadup">
            Validating a shape requires evaluating it's <a href="#dfn-triple-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-triple-expressions-11">triple expression</a> as well as the variables and functions <span class="math"><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-5">neigh</a>(G, n)</span>, <span class="math">matched</span>, <span class="math">remainder</span>, <span class="math">outs</span>, <span class="math">matchables</span> and <span class="math">unmatchables</span>:<br>
          </p>
          <div class="example">
            <!--
                BASE &lt;http://schema.example/#&gt;
                PREFIX ex: &lt;http://schema.example/#&gt;
                PREFIX xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt;
                PREFIX foaf: &lt;http://xmlns.com/foaf/0.1/&gt;
                PREFIX dc: &lt;http://purl.org/dc/elements/1.1/&gt;
                &lt;UserShape&gt; { ex:shoeSize . }
            -->
            <span class="exsec">Schema:</span><br>
            
            <div class="inline repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">&nbsp;   | { "type": "Schema", "shapes": [
S1  |   { "id": "http://schema.example/#UserShape",
    |     "type": "Shape", "expression":
tc1 |     { "type": "TripleConstraint",
    |       "predicate": "http://schema.example/#shoeSize"
    |       } } ] }</pre>
              
            </div>
            <div style="clear:both;" class="exsec">Data:</div>
            
            <div class="inline json">
              <pre aria-busy="false">&nbsp;  | BASE &lt;http://a.example/&gt;
   | PREFIX xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt;
t1 | &lt;Alice&gt; ex:shoeSize "30"^^xsd:integer .</pre>
            </div>
            <div style="clear:both;" class="validation"><span>Validate</span> <span class="hljs-name">&lt;Alice&gt;</span> as <span class="hljs-string">http://schema.example/#UserShape</span>:</div>
            <ul class="trace followup">
              <li>G = [<span class="lineno data">t1</span>] <span class="comment">The <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">graph</a> G consists of one <a data-cite="rdf11-concepts#dfn-rdf-triple" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-triple">triple</a>.</span></li>
              <li><a href="#satisfies-Shape">satisfies Shape</a> (&lt;Alice&gt;, <span class="lineno schema">S1</span>, G, m)
              <ul>
                <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-6">neigh</a>(G, &lt;Alice&gt;) = [<span class="lineno data">t1</span>] <span class="comment">/* The neighborhood around &lt;Alice&gt; consists of one triple. */</span></li>
                <li>matched = [<span class="lineno data">t1</span>] <span class="comment">/* That triple is matched in the nested evaluation. */</span></li>
                <li>remainder = Ø <span class="comment">/* The remainder is the empty set. */</span></li>
                <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t1</span>], <span class="lineno schema">tc1</span>, m)</li>
                <li>outs = [<span class="lineno data">t1</span>] <span class="comment">/* There is one arc out. */</span></li>
                <li>matchables = Ø <span class="comment">/* There are no remaining arcs out of &lt;Alice&gt; with <a data-lt="predicate" data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicates</a> appearing in tc1. */</span></li>
                <li>unmatchables = Ø <span class="comment">/* There are no other arcs out of &lt;Alice&gt;. */</span></li>
                <li><span class="parameter">closed</span> is false <span class="comment">/* The <span class="jobjref"><a href="#dfn-shape" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-19">Shape</a></span>'s closed paramater has a value of false. */</span></li>
              </ul>
              </li>
            </ul>
          </div>
            <p class="leadup">
              It is quite common that Shapes will constrain their nested TripleConstraints with NodeConstraints.
              Here is an example including that, extra triples and a closed shape:
            </p>
          <div class="example">
            <!--
                BASE <http://schema.example/#>
                PREFIX ex: <http://schema.example/#>
                PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
                PREFIX foaf: <http://xmlns.com/foaf/0.1/>
                PREFIX dc: <http://purl.org/dc/elements/1.1/>
                <UserShape> CLOSED EXTRA a {
                  a [ex:Teacher]
                }
            -->
            <span class="exsec">Schema:</span><br>
            
            <div class="inline repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">&nbsp;   | { "type": "Schema", "shapes": [
S1  |   { "id": "http://schema.example/#UserShape",
    |     "type": "Shape",
    |     "extra": ["http://www.w3.org/1999/02/22-rdf-syntax-ns#type"],
tc1 |     "expression": {
    |       "type": "TripleConstraint",
    |       "predicate": "http://www.w3.org/1999/02/22-rdf-syntax-ns#type",
nc1 |       "valueExpr": {
    |         "type": "NodeConstraint",
    |         "values": ["http://schema.example/#Teacher"]
    |       } } } ] }</pre>
              
            </div>
            <div style="clear:both;" class="exsec">Data:</div>
            
            <div class="inline json">
              <pre aria-busy="false">&nbsp;  | BASE &lt;http://a.example/&gt;
   | PREFIX xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt;
t1 | &lt;Alice&gt; ex:shoeSize "30"^^xsd:integer .
t2 | &lt;Alice&gt; a ex:Teacher .
t3 | &lt;Alice&gt; a ex:Person .
t4 | &lt;SomeHat&gt; ex:owner &lt;Alice&gt; .
t5 | &lt;TheMoon&gt; ex:madeOf &lt;GreenCheese&gt; .</pre>
            </div>
            <div style="clear:both;" class="validation"><span>Validate</span> <span class="hljs-name">&lt;Alice&gt;</span> as <span class="hljs-string">http://schema.example/#UserShape</span>:</div>
            <ul class="trace followup">
              <li>G = [<span class="lineno data">t1,t2,t3,t4,t5</span>]</li>
              <li><a href="#satisfies-Shape">satisfies Shape</a> (&lt;Alice&gt;, <span class="lineno schema">S1</span>, G, m)
              <ul>
                <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-7">neigh</a>(G, &lt;Alice&gt;) = [<span class="lineno data">t1,t2,t3,t4</span>], matched = [<span class="lineno data">t2</span>], remainder = [<span class="lineno data">t1,t3</span>]</li>
                <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t2</span>], <span class="lineno schema">tc1</span>, m)
                <ul style="border-left:solid thin brown">
                  <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> (ex:Teacher, <span class="lineno schema">nc1</span>, G, m)
                  <ul>
                    <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> (ex:Teacher, <span class="lineno schema">nc1</span>)</li>
                </ul></li></ul></li>
                <li>outs = [<span class="lineno data">t1,t2,t3</span>]</li>
                <li>matchables = [<span class="lineno data">t3</span>], unmatchables = [<span class="lineno data">t1</span>], <span class="parameter">closed</span> is false</li>
              </ul>
              </li>
            </ul>
            <p>
              The non-empty matchables is permitted because the triple <code>t3</code> has a <a data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicate</a> which appears in the "extra" list: <span class="json">["http://schema.example/#Teacher"]</span>.
            </p>
          </div>
        </section>

        <section id="example-disjunction"><div class="header-wrapper"><h4 id="x6-10-2-disjunction-example">Disjunction Example</h4></div>
          
          <!--
              BASE <http://schema.example/#>
              PREFIX ex: <http://schema.example/#>
              PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
              PREFIX foaf: <http://xmlns.com/foaf/0.1/>
              PREFIX dc: <http://purl.org/dc/elements/1.1/>
              <UserShape> {
                foaf:name LITERAL | foaf:givenName LITERAL +; foaf:familyName LITERAL
              }
          -->
          <div class="example">
              <div class="exsec">Schema:</div><br>
              
            <div class="inline repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">&nbsp;   | { "type": "Schema", "shapes": [
S1  |   { "id": "http://schema.example/#UserShape",
    |     "type": "Shape", "expression":
te1 |      {"type": "OneOf", "expressions": [
tc1 |         { "type": "TripleConstraint",
    |           "predicate": "http://xmlns.com/foaf/0.1/name",
    |           "valueExpr":
nc1 |             { "type": "NodeConstraint", "nodeKind": "literal" } },
te2 |         { "type": "EachOf", "expressions": [
tc2 |             { "type": "TripleConstraint", "min": 1, "max": -1 ,
    |               "predicate": "http://xmlns.com/foaf/0.1/givenName",
    |               "valueExpr":
nc2 |                 { "type": "NodeConstraint", "nodeKind": "literal" } },
tc3 |             { "type": "TripleConstraint",
    |               "predicate": "http://xmlns.com/foaf/0.1/familyName",
    |               "valueExpr":
nc3 |                 { "type": "NodeConstraint", "nodeKind": "literal" } }
    |         ] }
    |      ] }
    |  } ] }</pre>
              
            </div>
            <div style="clear:both;" class="exsec">Data:</div>
            
            <div class="inline json">
              <pre aria-busy="false">&nbsp;  | BASE &lt;http://a.example/&gt;
   | PREFIX foaf: &lt;http://xmlns.com/foaf/0.1/&gt;
t1 | &lt;Alice&gt; foaf:givenName "Alice" .
t2 | &lt;Alice&gt; foaf:givenName "Malsenior" .
t3 | &lt;Alice&gt; foaf:familyName "Walker" .
t4 | &lt;Alice&gt; foaf:mbox &lt;mailto:alice@example.com&gt; .
t5 | &lt;Bob&gt; foaf:knows &lt;Alice&gt; .
t6 | &lt;Bob&gt; foaf:mbox &lt;mailto:bob@example.com&gt; .</pre>
            </div>
            <div style="clear:both;"></div>
            <p class="leadup">Per <a href="#shape-expression-semantics">Shape Expression Semantics</a>, &lt;Alice&gt; satisfies <span class="lineno">S1</span> with the simple <a href="#dfn-shapemap" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapemap-4">ShapeMap</a></p>
            
            <div class="inline json">
              <pre aria-busy="false">m: | { "http://a.example/Alice": "http://a.example/UserShape }</pre>
            </div>
            <div style="clear:both;"></div>
            <p class="leadup followup">as seen in this validation.</p>
            <div class="validation"><span>Validate</span> <span class="hljs-name">&lt;Alice&gt;</span> as <span class="hljs-string">http://schema.example/#UserShape</span>:</div>
            <ul class="trace followup">
              <li>G = [<span class="lineno data">t1,t2,t3,t4,t5,t6</span>]</li>
              <li><a href="#satisfies-Shape">satisfies Shape</a> (&lt;Alice&gt;, <span class="lineno">S1</span>, G, m)
              <ul>
                <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-8">neigh</a>(G, &lt;Alice&gt;) = [<span class="lineno data">t1,t2,t3,t4,t5</span>], matched = [<span class="lineno data">t1,t2,t3</span>], remainder = [<span class="lineno data">t4,t5</span>]</li>
                <li><a href="#matches-OneOf">matches OneOf</a> ([<span class="lineno data">t1,t2,t3</span>], <span class="lineno schema">te1</span>, m)
                <ul style="border-left:solid thin brown">
                  <li><a href="#matches-EachOf">matches EachOf</a> ([<span class="lineno data">t1,t2,t3</span>], <span class="lineno schema">te2</span>, m)
                  <ul style="border-left:solid thin brown">
                    <li><a href="#matches-cardinality">matches cardinality</a> ([<span class="lineno data">t1,t2</span>], <span class="lineno schema">tc2</span>, m)
                    <ul style="border-left:solid thin brown">
                      <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t1</span>], <span class="lineno schema">tc2</span>, m)
                      <ul>
                        <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("Alice", <span class="lineno schema">nc2</span>, G, m)
                        <ul>
                          <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("Alice", <span class="lineno schema">nc2</span>)</li>
                      </ul></li></ul></li>
                      <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t2</span>], <span class="lineno schema">tc2</span>, m)
                      <ul>
                        <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("Malsenior", <span class="lineno schema">nc2</span>, G, m)
                        <ul>
                          <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("Malsenior", <span class="lineno schema">nc2</span>)</li>
                      </ul></li></ul></li>
                    </ul></li>
                    <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t3</span>], <span class="lineno schema">tc3</span>, m)
                    <ul>
                      <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("Walker", <span class="lineno schema">nc3</span>, G, m)
                      <ul>
                        <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("Walker", <span class="lineno schema">nc3</span>)</li>
                </ul></li></ul></li></ul></li></ul></li>
                <li>outs = [<span class="lineno data">t4</span>] <span class="comment">/* <span class="lineno data">t5</span> is in <span class="math"><a href="#dfn-arcsin" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-arcsin-6">ArcsIn</a>(G, &lt;Alice&gt;)&gt;</span>, <span class="lineno data">t6</span> is not in <span class="math"><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-9">neigh</a>(G, &lt;Alice&gt;)&gt;</span>. */</span></li>
                <li>matchables = Ø, unmatchables = [<span class="lineno data">t5</span>], <span class="parameter">closed</span> is false</li>
              </ul>
              </li>
            </ul>

            <p class="leadup">
              Replacing triples 1-3 with a single foaf:name property will also satisfy the schema.
            </p>
            <div class="exsec">Data:</div>
            
            <div class="inline json">
              <pre aria-busy="false">&nbsp;  | BASE &lt;http://a.example/&gt;
   | PREFIX foaf: &lt;http://xmlns.com/foaf/0.1/&gt;
t4 | &lt;Alice&gt; foaf:mbox &lt;mailto:alice@example.com&gt; .
t5 | &lt;Bob&gt; foaf:knows &lt;Alice&gt; .
t6 | &lt;Bob&gt; foaf:mbox &lt;mailto:bob@example.com&gt; .
t7 | &lt;Alice&gt; foaf:name "Alice Malsenior Walker" .</pre>
            </div>
            <div style="clear:both;" class="validation"><span>Validate</span> <span class="hljs-name">&lt;Alice&gt;</span> as <span class="hljs-string">http://schema.example/#UserShape</span>:</div>
            <ul class="trace followup">
              <li>G = [<span class="lineno data">t4,t5,t6,t7</span>]</li>
              <li><a href="#satisfies-Shape">satisfies Shape</a> (&lt;Alice&gt;, <span class="lineno schema">S1</span>, G, m)
              <ul>
                <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-10">neigh</a>(G, &lt;Alice&gt;) = [<span class="lineno data">t4,t5,t7</span>], matched = [<span class="lineno data">t7</span>], remainder = [<span class="lineno data">t4,t5</span>]</li>
                <li><a href="#matches-OneOf">matches OneOf</a> ([<span class="lineno data">t7</span>], <span class="lineno schema">te1</span>, m)
                <ul style="border-left:solid thin brown">
                  <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t7</span>], <span class="lineno schema">tc1</span>, m)
                  <ul>
                    <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("Walker", <span class="lineno schema">nc3</span>, G, m)
                    <ul>
                      <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("Walker", <span class="lineno schema">nc3</span>)</li>
                </ul></li></ul></li></ul></li>
                <li>outs = [<span class="lineno data">t4</span>]</li>
                <li>matchables = Ø, unmatchables = [<span class="lineno data">t5</span>], <span class="parameter">closed</span> is false</li>
              </ul>
              </li>
            </ul>

            <p class="leadup">
              Any mixure of <code>foaf:name</code> with <code>foaf:givenName</code> or <code>foaf:familyName</code> will fail to satisfy the schema as there will be a matchable triple <span class="lineno data">t3</span> that is not used in the <a href="#dfn-triple-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-triple-expressions-12">triple expression</a> <span class="lineno schema">te1</span>.
            </p>
            <div class="exsec">Data:</div>
            
            <div class="inline json">
              <pre aria-busy="false">&nbsp;  | BASE &lt;http://a.example/&gt;
   | PREFIX foaf: &lt;http://xmlns.com/foaf/0.1/&gt;
t3 | &lt;Alice&gt; foaf:familyName "Walker" .
t4 | &lt;Alice&gt; foaf:mbox &lt;mailto:alice@example.com&gt; .
t5 | &lt;Bob&gt; foaf:knows &lt;Alice&gt; .
t6 | &lt;Bob&gt; foaf:mbox &lt;mailto:bob@example.com&gt; .
t7 | &lt;Alice&gt; foaf:name "Alice Malsenior Walker" .</pre>
            </div>
            <div style="clear:both;" class="validation"><span>Validate</span> <span class="hljs-name">&lt;Alice&gt;</span> as <span class="hljs-string">http://schema.example/#UserShape</span>:</div>
            <ul class="trace followup">
              <li>G = [<span class="lineno data">t4,t5,t6,t7</span>]</li>
              <li><span class="fail"><a href="#satisfies-Shape">satisfies Shape</a> (&lt;Alice&gt;, <span class="lineno schema">S1</span>, G, m)</span>
              <ul>
                <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-11">neigh</a>(G, &lt;Alice&gt;) = [<span class="lineno data">t4,t5,t7</span>], matched = [<span class="lineno data">t7</span>], remainder = [<span class="lineno data">t4,t5</span>]</li>
                <li><a href="#matches-OneOf">matches OneOf</a> ([<span class="lineno data">t7</span>], <span class="lineno schema">te1</span>, m)
                <ul style="border-left:solid thin brown">
                  <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t7</span>], <span class="lineno schema">tc1</span>, m)
                  <ul>
                    <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("Walker", <span class="lineno schema">nc3</span>, G, m)
                    <ul>
                      <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("Walker", <span class="lineno schema">nc3</span>)</li>
                </ul></li></ul></li></ul></li>
                <li>outs = [<span class="lineno data">t4</span>]</li>
                <li><span class="fail">matchables = [<span class="lineno data">t3</span>]</span>, unmatchables = [<span class="lineno data">t5</span>], <span class="parameter">closed</span> is false</li>
              </ul>
              </li>
            </ul>

            <p class="leadup">
              Adding a <code>foaf:familyName</code> to <span class="math"><span class="lineno schema">S1</span></span>'s <span class="param">extra</span> would allow this <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">graph</a> to satisfy the schema.
            </p>
              
            <div class="inline json">
              <pre aria-busy="false">&nbsp;  | { "type": "Schema", "shapes": [
S1 |   { "id": "http://schema.example/#UserShape",
   |     "type": "Shape", "extra": ["http://xmlns.com/foaf/0.1/familyName"] …
   |    } ] }</pre>
            </div>
            <div style="clear:both;"></div>

            <p class="leadup">
              Closing <span class="math"><span class="lineno schema">S1</span></span> would also cause a validation failure if <span class="math">unmatchables</span> were not empty:
            </p>
              
            <div class="inline json">
              <pre aria-busy="false">&nbsp;  | { "type": "Schema", "shapes": [
S1 |   { "id": "http://schema.example/#UserShape",
   |     "type": "Shape", "closed": true …
   |    } ] }</pre>
            </div>
            <div style="clear:both;"></div>
            <ul class="trace followup">
              <li>G = [<span class="lineno data">t4,t5,t6,t7</span>]</li>
              <li><span class="fail"><a href="#satisfies-Shape">satisfies Shape</a> (&lt;Alice&gt;, <span class="lineno schema">S1</span>, G, m)</span>
              <ul>
                <li>…</li>
                <li><span class="fail">unmatchables = [<span class="lineno data">t5</span>], <span class="parameter">closed</span> is true</span></li>
              </ul>
              </li>
            </ul>

          </div>
        </section>

        <section id="example-dependent-shape"><div class="header-wrapper"><h4 id="x6-10-3-dependent-shape-example">Dependent Shape Example</h4></div>
          
          <!--
BASE <http://schema.example/#>
PREFIX ex: <http://schema.example/#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
<IssueShape> {
  ex:reproducedBy @<TesterShape>;
}
<TesterShape> {
  ex:role [ex:testingRole]
}
          -->
          <div class="example">
              <div class="exsec">Schema:</div>
              
            <div class="inline repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">&nbsp;   | { "type": "Schema", "shapes": [
S1  |   { "id": "http://schema.example/#IssueShape",
    |     "type": "Shape", "expression":
tc1 |     { "type": "TripleConstraint",
    |       "predicate": "http://schema.example/#reproducedBy",
    |       "valueExpr":
nc1 |       "http://schema.example/#TesterShape" } },
S2  |   { "id": "http://schema.example/#TesterShape",
    |     "type": "Shape", "expression":
tc2 |     { "type": "TripleConstraint",
    |       "predicate": "http://schema.example/#role",
    |       "valueExpr":
    |       { "type": "NodeConstraint",
nc2 |         "values": [ "http://schema.example/#testingRole" ] } } }
    |   ] }</pre>
              
            </div>
            <div style="clear:both;" class="exsec">Data:</div>
            
            <div class="inline json">
              <pre aria-busy="false">&nbsp;  | PREFIX ex: &lt;http://schema.example/#&gt;
   | PREFIX inst: &lt;http://inst.example/&gt;
t1 | inst:Issue1 ex:reproducedBy inst:Tester2 .
t2 | inst:Tester2 ex:role ex:testingRole .</pre>
            </div>
            <div style="clear:both;"></div>
            <p class="leadup">inst:Issue1 satisfies <span class="lineno schema">S1</span> with the <a href="#dfn-shapemap" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapemap-5">ShapeMap</a></p>
            
            <div class="inline json">
              <pre aria-busy="false">m: | { "http://inst.example/Issue1": "http://schema.example/#IssueShape",
   |   "http://inst.example/Tester2": "http://schema.example/#TesterShape",
   |   "http://inst.example/Testgrammer23": "http://schema.example/#ProgrammerShape" }</pre>
            </div>
            <div style="clear:both;" class="validation"><span>Validate</span> <span>inst:Issue1</span> as <span class="hljs-string">http://schema.example/#IssueShape</span>:</div>
            <p class="leadup followup">as seen in this evaluation:</p>
            <ul class="trace followup">
              <li>G = [<span class="lineno data">t1</span>]</li>
              <li><a href="#satisfies-Shape">satisfies Shape</a> (inst:Issue1, <span class="lineno schema">S1</span>, G, m)
              <ul>
                <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-12">neigh</a>(G, inst:Issue1) = [<span class="lineno data">t1,t2</span>], matched = [<span class="lineno data">t1,t2</span>], remainder = Ø</li>
                  <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t1</span>], <span class="lineno schema">tc1</span>, m)
                  <ul style="border-left:solid thin brown">
                    <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> (inst:Tester2, <span class="lineno schema">nc1</span>, G, m)
                    <ul>
                      <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> (inst:Tester2, <span class="lineno schema">nc1</span>)
                      <ul>
                        <li><a href="#satisfies-Shape">satisfies Shape</a> (inst:Tester2. <span class="lineno schema">S2</span>, G, m)
                        <ul>
                          <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-13">neigh</a>(G, inst:Tester2) = [<span class="lineno data">t2</span>], matched = [<span class="lineno data">t2</span>], remainder = Ø</li>
                          <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t2</span>], <span class="lineno schema">tc2</span>, m)
                          <ul style="border-left:solid thin brown">
                            <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> (ex:testingRole, <span class="lineno schema">nc2</span>, G, m)
                            <ul>
                              <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> (ex:testingRole, <span class="lineno schema">nc2</span>)</li>
                        </ul></li></ul></li>
                          <li>outs = Ø</li>
                          <li>matchables = Ø, unmatchables = Ø, closed is false</li>
                  </ul></li></ul></li></ul></li></ul></li>
                <li>outs = Ø</li>
                <li>matchables = Ø, unmatchables = Ø, closed is false</li>
              </ul>
              </li>
            </ul>
            <div style="clear:both;"></div>
          </div>
        </section>

        <section id="example-recursion"><div class="header-wrapper"><h4 id="x6-10-4-recursion-example">Recursion Example</h4></div>
          
          <!--
BASE <http://schema.example/#>
PREFIX ex: <http://schema.example/#>
<IssueShape> {
  ex:related @<IssueShape>*
}
          -->
          <div class="example">
              <div class="exsec">Schema:</div>
              
            <div class="inline repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">&nbsp;   | { "type": "Schema", "shapes": [
S1  |   { "id": "http://schema.example/#IssueShape",
    |     "type": "Shape", "expression":
tc1 |     { "type": "TripleConstraint", "min": 0, "max": -1,
    |       "predicate": "http://schema.example/#related",
nc1 |       "valueExpr": "http://schema.example/#IssueShape"
    |     } } ] }</pre>
              
            </div>
            <div style="clear:both;" class="exsec">Data:</div>
            
            <div class="inline json">
              <pre aria-busy="false">&nbsp;  | PREFIX ex: &lt;http://schema.example/#&gt;
   | PREFIX inst: &lt;http://inst.example/&gt;
t1 | inst:Issue1 ex:related inst:Issue2 .
t2 | inst:Issue2 ex:related inst:Issue3 .
t3 | inst:Issue3 ex:related inst:Issue1 .</pre>
            </div>
            <div style="clear:both;"></div>
            <p class="leadup">inst:Issue1 satisfies <span class="lineno schema">S1</span> with the <a href="#dfn-shapemap" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapemap-6">ShapeMap</a></p>
            
            <div class="inline json">
              <pre aria-busy="false">m: | { "http://inst.example/Issue1": "http://schema.example/#IssueShape",
   |   "http://inst.example/Issue2": "http://schema.example/#IssueShape",
   |   "http://inst.example/Issue3": "http://schema.example/#IssueShape" }</pre>
            </div>
            <div style="clear:both;" class="validation"><span>Validate</span> <span>inst:Issue1</span> as <span class="hljs-string">http://schema.example/#IssueShape</span>:</div>
            <p class="leadup followup">as seen in this evaluation:</p>
            <ul class="trace followup">
              <li>G = [<span class="lineno data">t1,t2,t3</span>]</li>
              <li><a href="#satisfies-Shape">satisfies Shape</a> (inst:Issue1, <span class="lineno schema">S1</span>, G, m)
              <ul>
                <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-14">neigh</a>(G, inst:Issue1) = [<span class="lineno data">t1</span>], matched = [<span class="lineno data">t1</span>], remainder = Ø</li>
                <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t1</span>], <span class="lineno schema">tc1</span>, m)
                <ul style="border-left:solid thin brown">
                  <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> (inst:Issue2, <span class="lineno schema">nc1</span>, G, m)
                  <ul>
                    <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> (inst:Issue2, <span class="lineno schema">nc1</span>)
                    <ul>
                      <li><a href="#satisfies-Shape">satisfies Shape</a> (inst:Issue2. <span class="lineno schema">S2</span>, G, m)
                      <ul>
                        <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-15">neigh</a>(G, inst:Issue2) = [<span class="lineno data">t3</span>], matched = [<span class="lineno data">t3</span>], remainder = Ø</li>
                        <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t3</span>], <span class="lineno schema">tc3</span>, m)
                        <ul style="border-left:solid thin brown">
                          <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> (inst:Issue3, <span class="lineno schema">nc3</span>, G, m)
                          <ul>
                            <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> (inst:Issue3, <span class="lineno schema">nc3</span>)
                            <ul>
                              <li><a href="#satisfies-Shape">satisfies Shape</a> (inst:Issue3. <span class="lineno schema">S2</span>, G, m)
                              <ul>
                                <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-16">neigh</a>(G, inst:Issue3) = [<span class="lineno data">t3</span>], matched = [<span class="lineno data">t3</span>], remainder = Ø</li>
                                <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t3</span>], <span class="lineno schema">tc3</span>, m)
                                <ul style="border-left:solid thin brown">
                                  <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> (inst:Issue1, <span class="lineno schema">nc3</span>, G, m)
                                  <ul>
                                    <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> (inst:Issue1, <span class="lineno schema">nc3</span>)<br>
                                    This is known to be true or the initial typing would not be satisfied.</li>
                                </ul></li></ul></li>
                                <li>outs = Ø</li>
                                <li>matchables = Ø, unmatchables = Ø, closed is false</li>
                            </ul></li></ul></li>
                        </ul></li></ul></li>
                        <li>outs = Ø</li>
                        <li>matchables = Ø, unmatchables = Ø, closed is false</li>
                </ul></li></ul></li></ul></li></ul></li>
                <li>outs = Ø</li>
                <li>matchables = Ø, unmatchables = Ø, closed is false</li>
              </ul>
              </li>
            </ul>
            <div style="clear:both;"></div>
          </div>
        </section>

        <section id="example-simple-repeated-property"><div class="header-wrapper"><h4 id="x6-10-5-simple-repeated-property-examples">Simple Repeated Property Examples</h4></div>
          
          <!--
              BASE <http://schema.example/#>
              PREFIX ex: <http://schema.example/#>
              PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
              PREFIX foaf: <http://xmlns.com/foaf/0.1/>
              PREFIX dc: <http://purl.org/dc/elements/1.1/>
              <S1> {
                ex:val ["a" "b" "c"]+;
                ex:val ["b" "c" "d"]+
              }
          -->
          <div class="example">
              <div class="exsec">Schema:</div>
              
            <div class="inline repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">&nbsp;   | { "type": "Schema", "shapes": [
S1  |     { "id": "http://schema.example/#TestResultsShape",
    |       "type": "Shape", "expression": {
te1 |         "type": "EachOf", "expressions": [
tc1 |           { "type": "TripleConstraint", "min": 1, "max": -1,
    |             "predicate": "http://schema.example/#val",
    |             "valueExpr":
nc1 |             { "type": "NodeConstraint",
    |               "values": [ {"value": "a"}, {"value": "b"}, {"value": "c"} ] } },
tc2 |           { "type": "TripleConstraint", "min": 1, "max": -1,
    |             "predicate": "http://schema.example/#val",
    |             "valueExpr":
nc2 |             { "type": "NodeConstraint",
    |               "values": [ {"value": "b"}, {"value": "c"}, {"value": "d"} ] } }
    |         ] } } ] }</pre>
              
            </div>
            <div style="clear:both;" class="exsec">Data:</div>
            
            <div class="inline json">
              <pre aria-busy="false">&nbsp;  | BASE &lt;http://a.example/&gt;
   | PREFIX ex: &lt;http://schema.example/#&gt;
t1 | &lt;s&gt; ex:val "a" .
t2 | &lt;s&gt; ex:val "b" .
t3 | &lt;s&gt; ex:val "c" .
t4 | &lt;s&gt; ex:val "d" .</pre>
            </div>
            <div style="clear:both;"></div>
            <p class="leadup">&lt;s&gt; satisfies <span class="lineno schema">S1</span> with:</p>
            
            <div class="inline json">
              <pre aria-busy="false">m: | { "http://a.example/s": "http://a.example/S1" }</pre>
            </div>
            <div style="clear:both;" class="validation"><span>Validate</span> <span class="hljs-name">&lt;s&gt;</span> as <span class="hljs-string">http://schema.example/#TestResultShape</span>:</div>
            <p class="leadup followup">If <span class="math"><span class="lineno schema">tc1</span></span> consumes as many triples as it can, it consumes three and <span class="math"><span class="lineno schema">tc2</span></span> consumes one:</p>
            <ul class="trace followup">
              <li>G = [<span class="lineno data">t1,t2,t3,t4</span>]</li>
              <li><a href="#satisfies-Shape">satisfies Shape</a> (&lt;s&gt;, <span class="lineno schema">S1</span>, G, m)
              <ul>
                <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-17">neigh</a>(G, &lt;s&gt;) = [<span class="lineno data">t1,t2,t3,t4</span>], matched = [<span class="lineno data">t1,t2,t3,t4</span>], remainder = Ø</li>
                <li><a href="#matches-EachOf">matches EachOf</a> ([<span class="lineno data">t1,t2,t3,t4</span>], <span class="lineno schema">te1</span>, m)
                <ul style="border-left:solid thin brown">
                  <li><a href="#matches-cardinality">matches cardinality</a> ([<span class="lineno data">t1,t2,t3</span>], <span class="lineno schema">tc1</span>, m)
                  <ul style="border-left:solid thin brown">
                    <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t1</span>], <span class="lineno schema">tc1</span>, m)
                    <ul>
                      <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("a", <span class="lineno schema">nc1</span>, G, m)
                      <ul>
                        <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("a", <span class="lineno schema">nc1</span>)</li>
                    </ul></li></ul></li>
                    <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t2</span>], <span class="lineno schema">tc1</span>, m)
                    <ul>
                      <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("b", <span class="lineno schema">nc1</span>, G, m)
                      <ul>
                        <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("b", <span class="lineno schema">nc1</span>)</li>
                    </ul></li></ul></li>
                    <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t3</span>], <span class="lineno schema">tc1</span>, m)
                    <ul>
                      <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("c", <span class="lineno schema">nc1</span>, G, m)
                      <ul>
                        <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("c", <span class="lineno schema">nc1</span>)</li>
                    </ul></li></ul></li>
                  </ul></li>
                  <li><a href="#matches-cardinality">matches cardinality</a> ([<span class="lineno data">t4</span>], <span class="lineno schema">tc2</span>, m)
                  <ul style="border-left:solid thin brown">
                    <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t4</span>], <span class="lineno schema">tc2</span>, m)
                    <ul>
                      <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("d", <span class="lineno schema">nc2</span>, G, m)
                      <ul>
                        <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("d", <span class="lineno schema">nc2</span>)</li>
                    </ul></li></ul></li>
                  </ul></li>
                </ul></li>
                <li>outs = Ø</li>
                <li>matchables = Ø, unmatchables = Ø, <span class="parameter">closed</span> is false</li>
              </ul>
              </li>
            </ul>
            <div style="clear:both;"></div>

            <p class="leadup">If we eliminate <span class="math"><span class="lineno data">t4</span></span>, either <span class="math"><span class="lineno data">t2</span></span> or <span class="math"><span class="lineno data">t3</span></span> must be allocated to <span class="math"><span class="lineno schema">tc2</span></span>:</p>
            <ul class="trace followup">
              <li>G = [<span class="lineno data">t1,t2,t3</span>]</li>
              <li><a href="#satisfies-Shape">satisfies Shape</a> (&lt;Alice&gt;, <span class="lineno schema">S1</span>, G, m)
              <ul>
                <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-18">neigh</a>(G, &lt;Alice&gt;) = [<span class="lineno data">t1,t2,t3</span>], matched = [<span class="lineno data">t1,t2,t3</span>], remainder = Ø</li>
                <li><a href="#matches-EachOf">matches EachOf</a> ([<span class="lineno data">t1,t2,t3</span>], <span class="lineno schema">te1</span>, m)
                <ul style="border-left:solid thin brown">
                  <li><a href="#matches-cardinality">matches cardinality</a> ([<span class="lineno data">t1,t2</span>], <span class="lineno schema">tc1</span>, m)
                  <ul style="border-left:solid thin brown">
                    <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t1</span>], <span class="lineno schema">tc1</span>, m)
                    <ul>
                      <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("a", <span class="lineno schema">nc1</span>, G, m)
                      <ul>
                        <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("a", <span class="lineno schema">nc1</span>)</li>
                    </ul></li></ul></li>
                    <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t2</span>], <span class="lineno schema">tc1</span>, m)
                    <ul>
                      <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("b", <span class="lineno schema">nc1</span>, G, m)
                      <ul>
                        <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("b", <span class="lineno schema">nc1</span>)</li>
                    </ul></li></ul></li>
                  </ul></li>
                  <li><a href="#matches-cardinality">matches cardinality</a> ([<span class="lineno data">t3</span>], <span class="lineno schema">tc2</span>, m)
                  <ul style="border-left:solid thin brown">
                    <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t3</span>], <span class="lineno schema">tc2</span>, m)
                    <ul>
                      <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("d", <span class="lineno schema">nc2</span>, G, m)
                      <ul>
                        <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("d", <span class="lineno schema">nc2</span>)</li>
                    </ul></li></ul></li>
                  </ul></li>
                </ul></li>
                <li>outs = Ø</li>
                <li>matchables = Ø, unmatchables = Ø, <span class="parameter">closed</span> is false</li>
              </ul>
              </li>
            </ul>
            <div style="clear:both;"></div>
          </div>
        </section>

        <section id="example-repeated-property-with-dependent-shapes"><div class="header-wrapper"><h4 id="x6-10-6-repeated-property-with-dependent-shapes-example">Repeated Property With Dependent Shapes Example</h4></div>
          
          <!--
BASE <http://schema.example/#>
PREFIX ex: <http://schema.example/#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
<IssueShape> {
  ex:reproducedBy @<TesterShape>;
  ex:reproducedBy @<ProgrammerShape>
}
<TesterShape> {          
  ex:role [ex:testingRole]
}                         

<ProgrammerShape> {                      
  ex:department [ex:ProgrammingDepartment]
}
          -->
          <div class="example">
              <div class="exsec">Schema:</div>
              
            <div class="inline repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">&nbsp;   | { "type": "Schema", "shapes": [
S1  |   { "id": "http://schema.example/#IssueShape",
    |     "type": "Shape", "expression":
te1 |     { "type": "EachOf", "expressions": [
tc1 |         { "type": "TripleConstraint",
    |           "predicate": "http://schema.example/#reproducedBy",
nc1 |           "valueExpr": "http://schema.example/#TesterShape" },
tc2 |         { "type": "TripleConstraint",
    |           "predicate": "http://schema.example/#reproducedBy",
nc2 |           "valueExpr": "http://schema.example/#ProgrammerShape" }
    |       ] } },
S2  |   { "id": "http://schema.example/#TesterShape",
    |     "type": "Shape", "expression":
tc3 |     { "type": "TripleConstraint",
    |       "predicate": "http://schema.example/#role",
    |       "valueExpr":
nc3 |       { "type": "NodeConstraint",
    |         "values": [ "http://schema.example/#testingRole" ] } } },
S3  |   { "id": "http://schema.example/#ProgrammerShape",
    |     "type": "Shape", "expression":
tc4 |     { "type": "TripleConstraint",
    |       "predicate": "http://schema.example/#department",
nc4 |       "valueExpr": {
    |         "type": "NodeConstraint",
    |         "values": [ "http://schema.example/#ProgrammingDepartment" ] } } }
    |   ] }</pre>
              
            </div>
            <div style="clear:both;" class="exsec">Data:</div>
            
            <div class="inline json">
              <pre aria-busy="false">&nbsp;  | PREFIX ex: &lt;http://schema.example/#&gt;
   | PREFIX inst: &lt;http://inst.example/&gt;
t1 | inst:Issue1
t2 |   ex:reproducedBy inst:Tester2 ;
   |   ex:reproducedBy inst:Testgrammer23 .
   | 
t3 | inst:Tester2              
   |   ex:role ex:testingRole .
   | 
t4 | inst:Testgrammer23                        
t5 |   ex:role ex:testingRole ;                
   |   ex:department ex:ProgrammingDepartment .</pre>
            </div>
            <div style="clear:both;"></div>
            <p class="leadup">inst:Issue1 satisfies <span class="lineno schema">S1</span> with the <a href="#dfn-shapemap" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapemap-7">ShapeMap</a></p>
            
            <div class="inline json">
              <pre aria-busy="false">m: | { "http://inst.example/Issue1": "http://schema.example/#IssueShape",
   |   "http://inst.example/Tester2": "http://schema.example/#TesterShape",
   |   "http://inst.example/Testgrammer23": "http://schema.example/#ProgrammerShape" }</pre>
            </div>
            <div style="clear:both;" class="validation"><span>Validate</span> <span>inst:Issue1</span> as <span class="hljs-string">http://schema.example/#IssueShape</span>:</div>
            <p class="leadup followup">as seen in this evaluation:</p>
            <ul class="trace followup">
              <li>G = [<span class="lineno data">t1,t2,t3,t4,t5</span>]</li>
              <li><a href="#satisfies-Shape">satisfies Shape</a> (inst:Issue1, <span class="lineno schema">S1</span>, G, m)
              <ul>
                <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-19">neigh</a>(G, inst:Issue1) = [<span class="lineno data">t1,t2</span>], matched = [<span class="lineno data">t1,t2</span>], remainder = Ø</li>
                <li><a href="#matches-EachOf">matches EachOf</a> ([<span class="lineno data">t1,t2</span>], <span class="lineno schema">te1</span>, m)
                <ul style="border-left:solid thin brown">
                  <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t1</span>], <span class="lineno schema">tc1</span>, m)
                  <ul>
                    <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> (inst:Tester2, <span class="lineno schema">nc1</span>, G, m)
                    <ul>
                      <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> (inst:Tester2, <span class="lineno schema">nc1</span>)
                      <ul>
                        <li><a href="#satisfies-Shape">satisfies Shape</a> (inst:Tester2. <span class="lineno schema">S2</span>, G, m)
                        <ul>
                          <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-20">neigh</a>(G, inst:Tester2) = [<span class="lineno data">t3</span>], matched = [<span class="lineno data">t3</span>], remainder = Ø</li>
                          <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t3</span>], <span class="lineno schema">tc3</span>, m)
                          <ul style="border-left:solid thin brown">
                            <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> (ex:testingRole, <span class="lineno schema">nc3</span>, G, m)
                            <ul>
                              <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> (ex:testingRole, <span class="lineno schema">nc3</span>)</li>
                        </ul></li></ul></li>
                          <li>outs = Ø</li>
                          <li>matchables = Ø, unmatchables = Ø, closed is false</li>
                  </ul></li></ul></li></ul></li></ul></li>
                  <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t2</span>], <span class="lineno schema">tc1</span>, m)
                  <ul>
                    <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> (inst:Testgrammer23, <span class="lineno schema">nc2</span>, G, m)
                    <ul>
                      <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> (inst:Testgrammer23, <span class="lineno schema">nc2</span>)
                      <ul>
                        <li><a href="#satisfies-Shape">satisfies Shape</a> (inst:Testgrammer23. <span class="lineno schema">S3</span>, G, m)
                        <ul>
                          <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-21">neigh</a>(G, inst:Testgrammer23) = [<span class="lineno data">t5</span>], matched = [<span class="lineno data">t5</span>], remainder = Ø</li>
                          <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t5</span>], <span class="lineno schema">tc3</span>, m)
                          <ul style="border-left:solid thin brown">
                            <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> (ex:testingRole, <span class="lineno schema">nc4</span>, G, m)
                            <ul>
                              <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> (ex:testingRole, <span class="lineno schema">nc4</span>)</li>
                          </ul></li></ul></li>
                          <li>outs = Ø</li>
                          <li>matchables = Ø, unmatchables = Ø, closed is false</li>
                  </ul></li></ul></li></ul></li></ul></li>
                </ul></li>
                <li>outs = Ø</li>
                <li>matchables = Ø, unmatchables = Ø, closed is false</li>
              </ul>
              </li>
            </ul>
            <div style="clear:both;"></div>
          </div>
        </section>

        <section id="example-negation"><div class="header-wrapper"><h4 id="x6-10-7-negation-example">Negation Example</h4></div>
          
          <p>
            Setting the maximum <a href="#dfn-cardinality" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-cardinality-1">cardinality</a> of a TripleConstraint with <a data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicate</a> <span class="math">p</span> to zero (i.e. <span>"max": 0</span> in <a href="#dfn-shexj" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexj-8">ShExJ</a> or <code>{0}</code> or <code>{0, 0}</code> in <a href="#dfn-shexc" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexc-2">ShExC</a>) asserts that matching nodes must have no triples with <a data-cite="rdf11-concepts#dfn-predicate" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicate</a> <span class="math">p</span>.
          </p>
          <!--
              BASE <http://schema.example/#>
              PREFIX ex: <http://schema.example/#>
              PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
              PREFIX foaf: <http://xmlns.com/foaf/0.1/>
              PREFIX dc: <http://purl.org/dc/elements/1.1/>
              <S1> {
                ex:p1 ["a" "b"];
                ex:p2 . {0}
              }
          -->
          <div class="example">
              <div class="exsec">Schema:</div>
              
            <div class="inline repchoice" tabindex="0">
              <pre class="json nohighlight repchosen">&nbsp;   | { "type": "Schema", "shapes": [
S1  |     { "id": "http://schema.example/#TestResultsShape",
    |       "type": "Shape", "expression": {
te1 |         "type": "EachOf", "expressions": [
tc1 |           { "type": "TripleConstraint", "min": 1, "max": -1,
    |             "predicate": "http://schema.example/#p1",
    |             "valueExpr":
nc1 |             { "type": "NodeConstraint",
    |               "values": [ {"value": "a"}, {"value": "b"} ] } },
tc2 |           { "type": "TripleConstraint", "min": 1, "max": -1,
    |             "predicate": "http://schema.example/#p2", "min": 0, "max": 0 }
    |         ] } } ] }</pre>
              
            </div>
            <div style="clear:both;" class="exsec">Data:</div>
            
            <div class="inline json">
              <pre aria-busy="false">&nbsp;  | BASE &lt;http://a.example/&gt;
   | PREFIX ex: &lt;http://schema.example/#&gt;
t1 | &lt;s&gt; ex:p1 "a" .</pre>
            </div>
            <div style="clear:both;"></div>
            <p class="leadup">&lt;s&gt; satisfies <span class="lineno schema">S1</span> with:</p>
            
            <div class="inline json">
              <pre aria-busy="false">m: | { "http://a.example/s": "http://a.example/S1" }</pre>
            </div>
            <div style="clear:both;" class="validation"><span>Validate</span> <span class="hljs-name">&lt;s&gt;</span> as <span class="hljs-string">http://schema.example/#TestResultShape</span>:</div>
            <p class="leadup followup">This is trivially satisfied by <span class="math"><span class="lineno schema">tc1</span></span> consuming one triple and <span class="math"><span class="lineno schema">tc2</span></span> consuming none:</p>
            <ul class="trace followup">
              <li>G = [<span class="lineno data">t1</span>]</li>
              <li><a href="#satisfies-Shape">satisfies Shape</a> (&lt;s&gt;, <span class="lineno schema">S1</span>, G, m)
              <ul>
                <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-22">neigh</a>(G, &lt;s&gt;) = [<span class="lineno data">t1</span>], matched = [<span class="lineno data">t1</span>], remainder = Ø</li>
                <li><a href="#matches-EachOf">matches EachOf</a> ([<span class="lineno data">t1</span>], <span class="lineno schema">te1</span>, m)
                <ul style="border-left:solid thin brown">
                  <li><a href="#matches-cardinality">matches cardinality</a> ([<span class="lineno data">t1</span>], <span class="lineno schema">tc1</span>, m)
                  <ul style="border-left:solid thin brown">
                    <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t1</span>], <span class="lineno schema">tc1</span>, m)
                    <ul>
                      <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("a", <span class="lineno schema">nc1</span>, G, m)
                      <ul>
                        <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("a", <span class="lineno schema">nc1</span>)</li>
                    </ul></li></ul></li>
                  </ul></li>
                  <li><a href="#matches-cardinality">matches cardinality</a> ([<span class="lineno data"></span>], <span class="lineno schema">tc2</span>, m)
                  <ul style="border-left:solid thin brown">
                    <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data"></span>], <span class="lineno schema">tc2</span>, m)</li>
                  </ul></li>
                </ul></li>
                <li>outs = Ø</li>
                <li>matchables = Ø, unmatchables = Ø, <span class="parameter">closed</span> is false</li>
              </ul>
              </li>
            </ul>
            <div style="clear:both;"></div>

            <p class="leadup">If we add a <span class="math"><span class="lineno data">t2</span></span> which matches <span class="math"><span class="lineno schema">tc2</span></span>:</p>
            <div style="clear:both;" class="exsec">Data:</div>
            
            <div class="inline json error">
              <pre aria-busy="false">&nbsp;  | BASE &lt;http://a.example/&gt;
   | PREFIX ex: &lt;http://schema.example/#&gt;
t1 | &lt;s&gt; ex:p1 "a" .
t2 | &lt;s&gt; ex:p2 5 .</pre>
            </div>
            <div style="clear:both;"></div>
            <p>
              every partition fails, either because matchables is non-empty or because the maximum cardinality on <span class="lineno schema">tc2</span> is exceeded:
            </p>
            <ul class="trace followup">
              <li>G = [<span class="lineno data">t1</span>]</li>
              <li><a href="#satisfies-Shape">satisfies Shape</a> (&lt;s&gt;, <span class="lineno schema">S1</span>, G, m)
              <ul>
                <li><a href="#dfn-neigh" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-neigh-23">neigh</a>(G, &lt;s&gt;) = [<span class="lineno data">t1</span>], matched = [<span class="lineno data">t1</span>], remainder = Ø</li>
                <li><a href="#matches-EachOf">matches EachOf</a> ([<span class="lineno data">t1</span>], <span class="lineno schema">te1</span>, m)
                <ul style="border-left:solid thin brown">
                  <li><a href="#matches-cardinality">matches cardinality</a> ([<span class="lineno data">t1</span>], <span class="lineno schema">tc1</span>, m)
                  <ul style="border-left:solid thin brown">
                    <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t1</span>], <span class="lineno schema">tc1</span>, m)
                    <ul>
                      <li><a href="#satisfies-NodeConstraint">satisfies NodeConstraint</a> ("a", <span class="lineno schema">nc1</span>, G, m)
                      <ul>
                        <li><a href="#satisfies2-NodeConstraint">satisfies2 NodeConstraint</a> ("a", <span class="lineno schema">nc1</span>)</li>
                    </ul></li></ul></li>
                  </ul></li>
                  <li><span class="fail"><a href="#matches-cardinality">matches cardinality</a> ([<span class="lineno data">t2</span>], <span class="lineno schema">tc2</span>, m)</span>
                  <ul style="border-left:solid thin brown">
                    <li><a href="#matches-TripleConstraint">matches TripleConstraint</a> ([<span class="lineno data">t2</span>], <span class="lineno schema">tc2</span>, m)</li>
                  </ul></li>
                </ul></li>
                <li>outs = Ø</li>
                <li>matchables = Ø, unmatchables = Ø, <span class="parameter">closed</span> is false</li>
              </ul>
              </li>
            </ul>
            <div style="clear:both;"></div>
          </div>
        </section>

      </section>
    </section>
      
    <section id="shexc"><!--OddPage--><div class="header-wrapper"><h2 id="x7-shex-compact-syntax-shexc">ShEx Compact syntax (ShExC)</h2></div>
      
      <div>
    <p>
      The ShEx Compact Syntax expresses ShEx schemas in a compact, human-friendly form.
      Parsing <dfn id="dfn-shexc" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">ShExC</dfn> transforms a <a href="#dfn-shexc" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexc-3">ShExC</a> document into an equivalent <a href="#dfn-shexj" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexj-9">ShExJ</a> structure.
      This is defined as a BNF which accepts <a href="#dfn-shexc" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexc-4">ShExC</a> followed by instructions for tranlating the rules in the BNF production into their corresponding <a href="#dfn-shexj" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexj-10">ShExJ</a> objects.
      For example, "<span style="font-family: monospace; ">shapeExprDecl returns <span class="prod"><a class="grammarRef" href="#prod-shapeExpression">shapeExpression</a></span></span>" indicates that the result of matching the <code>shapeExprDecl</code> production is the object produced by parsing the <code>shapeExpression</code> production.
    </p>
    <p>
      Semantic actions before the first <span class="prod"><a class="grammarRef" href="#prod-shapeExprDecl">shape expression declaration</a></span> are <span class="param"><a href="#dfn-startacts" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-startacts-5">startActs</a></span>.
      After the first <span class="prod"><a class="grammarRef" href="#prod-shapeExprDecl">shape expression declaration</a></span>, semantic actions are associated with the previous declaration.
    </p>
    <p>
      As with Turtle and SPARQL, ShExC offers URL resolution relative to a <dfn data-lt="prefix|base" id="dfn-prefix" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">base</dfn> per [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986<!---0.294583%--></a></cite><!---0.294583%-->] and <dfn id="dfn-prefixes-map" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">prefixes map</dfn> to provide shorthand ways to write IRI identifiers.
    </p>
    
      <div class="grammarTable">
<pre>[1]&nbsp;&nbsp;&nbsp;   <b>shexDoc</b>                    : directive*                                         
         <b></b>                             ((notStartAction | startActions) statement*)?      
[2]&nbsp;&nbsp;&nbsp;   <b>directive</b>                  : baseDecl | prefixDecl | importDecl                 
[3]&nbsp;&nbsp;&nbsp;   <b>baseDecl</b>                   : "BASE" IRIREF                                      
[4]&nbsp;&nbsp;&nbsp;   <b>prefixDecl</b>                 : "PREFIX" PNAME_NS IRIREF                           
[5]&nbsp;&nbsp;&nbsp;   <b>importDecl</b>                 : "IMPORT" IRIREF                                    
[6]&nbsp;&nbsp;&nbsp;   <b>notStartAction</b>             : start | shapeExprDecl                              
[7]&nbsp;&nbsp;&nbsp;   <b>start</b>                      : "start" '=' inlineShapeExpression                  
[8]&nbsp;&nbsp;&nbsp;   <b>startActions</b>               : annotation* codeDecl+                              
[9]&nbsp;&nbsp;&nbsp;   <b>statement</b>                  : directive | notStartAction                         
[10]&nbsp;&nbsp;&nbsp;  <b>shapeExprDecl</b>              : shapeExprLabel (shapeExpression | "EXTERNAL")      
[11]&nbsp;&nbsp;&nbsp;  <b>shapeExpression</b>            : shapeOr                                            
[12]&nbsp;&nbsp;&nbsp;  <b>inlineShapeExpression</b>      : inlineShapeOr                                      
[13]&nbsp;&nbsp;&nbsp;  <b>shapeOr</b>                    : shapeAnd ("OR" shapeAnd)*                          
[14]&nbsp;&nbsp;&nbsp;  <b>inlineShapeOr</b>              : inlineShapeAnd ("OR" inlineShapeAnd)*              
[15]&nbsp;&nbsp;&nbsp;  <b>shapeAnd</b>                   : shapeNot ("AND" shapeNot)*                         
[16]&nbsp;&nbsp;&nbsp;  <b>inlineShapeAnd</b>             : inlineShapeNot ("AND" inlineShapeNot)*             
[17]&nbsp;&nbsp;&nbsp;  <b>shapeNot</b>                   : "NOT"? shapeAtom                                   
[18]&nbsp;&nbsp;&nbsp;  <b>inlineShapeNot</b>             : "NOT"? inlineShapeAtom                             
[19]&nbsp;&nbsp;&nbsp;  <b>shapeAtom</b>                  : &nbsp;&nbsp;&nbsp;nonLitNodeConstraint shapeOrRef?                
         <b></b>                             | litNodeConstraint                                
         <b></b>                             | shapeOrRef nonLitNodeConstraint?                 
         <b></b>                             | '(' shapeExpression ')'                          
         <b></b>                             | '.'                                              
[20]&nbsp;&nbsp;&nbsp;  <b>shapeAtomNoRef</b>             : &nbsp;&nbsp;&nbsp;nonLitNodeConstraint shapeOrRef?                
         <b></b>                             | litNodeConstraint                                
         <b></b>                             | shapeDefinition nonLitNodeConstraint?            
         <b></b>                             | '(' shapeExpression ')'                          
         <b></b>                             | '.'                                              
[21]&nbsp;&nbsp;&nbsp;  <b>inlineShapeAtom</b>            : &nbsp;&nbsp;&nbsp;nonLitNodeConstraint inlineShapeOrRef?          
         <b></b>                             | litNodeConstraint                                
         <b></b>                             | inlineShapeOrRef nonLitNodeConstraint?           
         <b></b>                             | '(' shapeExpression ')'                          
         <b></b>                             | '.'                                              
[22]&nbsp;&nbsp;&nbsp;  <b>shapeOrRef</b>                 : shapeDefinition | shapeRef                         
         <b></b>                                                                                
[23]&nbsp;&nbsp;&nbsp;  <b>inlineShapeOrRef</b>           : inlineShapeDefinition | shapeRef                   
[24]&nbsp;&nbsp;&nbsp;  <b>shapeRef</b>                   : ATPNAME_LN | ATPNAME_NS | '@' shapeExprLabel       
[25]&nbsp;&nbsp;&nbsp;  <b>litNodeConstraint</b>          : &nbsp;&nbsp;&nbsp;"LITERAL" xsFacet*                              
         <b></b>                             | datatype xsFacet*                                
         <b></b>                             | valueSet xsFacet*                                
         <b></b>                             | numericFacet+                                    
[26]&nbsp;&nbsp;&nbsp;  <b>nonLitNodeConstraint</b>       : &nbsp;&nbsp;&nbsp;nonLiteralKind stringFacet*                     
         <b></b>                             | stringFacet+                                     
[27]&nbsp;&nbsp;&nbsp;  <b>nonLiteralKind</b>             : "IRI" | "BNODE" | "NONLITERAL"                     
[28]&nbsp;&nbsp;&nbsp;  <b>xsFacet</b>                    : stringFacet | numericFacet                         
[29]&nbsp;&nbsp;&nbsp;  <b>stringFacet</b>                : &nbsp;&nbsp;&nbsp;stringLength INTEGER                            
         <b></b>                             | REGEXP                                           
[30]&nbsp;&nbsp;&nbsp;  <b>stringLength</b>               : "LENGTH" | "MINLENGTH" | "MAXLENGTH"               
[31]&nbsp;&nbsp;&nbsp;  <b>numericFacet</b>               : &nbsp;&nbsp;&nbsp;numericRange numericLiteral                     
         <b></b>                             | numericLength INTEGER                            
[32]&nbsp;&nbsp;&nbsp;  <b>numericRange</b>               : &nbsp;&nbsp;"MININCLUSIVE" | "MINEXCLUSIVE"                  
         <b></b>                             | "MAXINCLUSIVE" | "MAXEXCLUSIVE"                  
[33]&nbsp;&nbsp;&nbsp;  <b>numericLength</b>              : "TOTALDIGITS" | "FRACTIONDIGITS"                   
[34]&nbsp;&nbsp;&nbsp;  <b>shapeDefinition</b>            : (extraPropertySet | "CLOSED")*                     
         <b></b>                             '{' tripleExpression? '}'                          
         <b></b>                             annotation* semanticActions                        
[35]&nbsp;&nbsp;&nbsp;  <b>inlineShapeDefinition</b>      : (extraPropertySet | "CLOSED")*                     
         <b></b>                             '{' tripleExpression? '}'                          
[36]&nbsp;&nbsp;&nbsp;  <b>extraPropertySet</b>           : "EXTRA" predicate+                                 
[37]&nbsp;&nbsp;&nbsp;  <b>tripleExpression</b>           : oneOfTripleExpr                                    
[38]&nbsp;&nbsp;&nbsp;  <b>oneOfTripleExpr</b>            : groupTripleExpr | multiElementOneOf                
[39]&nbsp;&nbsp;&nbsp;  <b>multiElementOneOf</b>          : groupTripleExpr ('|' groupTripleExpr)+             
[40]&nbsp;&nbsp;&nbsp;  <b>groupTripleExpr</b>            : singleElementGroup | multiElementGroup             
[41]&nbsp;&nbsp;&nbsp;  <b>singleElementGroup</b>         : unaryTripleExpr ';'?                               
[42]&nbsp;&nbsp;&nbsp;  <b>multiElementGroup</b>          : unaryTripleExpr (';' unaryTripleExpr)+ ';'?        
[43]&nbsp;&nbsp;&nbsp;  <b>unaryTripleExpr</b>            : &nbsp;&nbsp;&nbsp;('$' tripleExprLabel)?                          
         <b></b>                             &nbsp;&nbsp;(tripleConstraint | bracketedTripleExpr)         
         <b></b>                             | include                                          
[44]&nbsp;&nbsp;&nbsp;  <b>bracketedTripleExpr</b>        : '(' tripleExpression ')' cardinality?              
         <b></b>                             annotation* semanticActions                        
[45]&nbsp;&nbsp;&nbsp;  <b>tripleConstraint</b>           : senseFlags? predicate inlineShapeExpression        
         <b></b>                             cardinality? annotation* semanticActions           
[46]&nbsp;&nbsp;&nbsp;  <b>cardinality</b>                : '*' | '+' | '?' | REPEAT_RANGE                     
[47]&nbsp;&nbsp;&nbsp;  <b>senseFlags</b>                 : '^'                                                
[48]&nbsp;&nbsp;&nbsp;  <b>valueSet</b>                   : '[' valueSetValue* ']'                             
[49]&nbsp;&nbsp;&nbsp;  <b>valueSetValue</b>              : &nbsp;&nbsp;iriRange | literalRange                          
         <b></b>                             | languageRange | exclusion+                       
[50]&nbsp;&nbsp;&nbsp;  <b>exclusion</b>                  : '.'                                                
         <b></b>                             (iriExclusion | literalExclusion                   
         <b></b>                             &nbsp;| languageExclusion)+                             
[51]&nbsp;&nbsp;&nbsp;  <b>iriExclusion</b>               : '-' iri '~'?                                       
[52]&nbsp;&nbsp;&nbsp;  <b>literalExclusion</b>           : '-' literal '~'?                                   
[53]&nbsp;&nbsp;&nbsp;  <b>languageExclusion</b>          : '-' LANGTAG '~'?                                   
[54]&nbsp;&nbsp;&nbsp;  <b>iriRange</b>                   : &nbsp;&nbsp;&nbsp;iri ('~' iriExclusion*)?                        
[55]&nbsp;&nbsp;&nbsp;  <b>iriExclusion</b>               : '-' iri '~'?                                       
[56]&nbsp;&nbsp;&nbsp;  <b>literalRange</b>               : &nbsp;&nbsp;&nbsp;literal ('~' literalExclusion*)?                
[57]&nbsp;&nbsp;&nbsp;  <b>literalExclusion</b>           : '-' literal '~'?                                   
[58]&nbsp;&nbsp;&nbsp;  <b>languageRange</b>              : &nbsp;&nbsp;&nbsp;LANGTAG ('~' languageExclusion*)?               
         <b></b>                             | '@' '~' languageExclusion*                       
[59]&nbsp;&nbsp;&nbsp;  <b>languageExclusion</b>          : '-' LANGTAG '~'?                                   
[60]&nbsp;&nbsp;&nbsp;  <b>include</b>                    : '&amp;' tripleExprLabel                                
[61]&nbsp;&nbsp;&nbsp;  <b>annotation</b>                 : "//" predicate (iri | literal)                     
[62]&nbsp;&nbsp;&nbsp;  <b>semanticActions</b>            : codeDecl*                                          
[63]&nbsp;&nbsp;&nbsp;  <b>codeDecl</b>                   : '%' iri (CODE | '%')                               
[13t]&nbsp;&nbsp;&nbsp; <b>literal</b>                    : rdfLiteral | numericLiteral | booleanLiteral       
[65]&nbsp;&nbsp;&nbsp;  <b>predicate</b>                  : iri | RDF_TYPE                                     
[66]&nbsp;&nbsp;&nbsp;  <b>datatype</b>                   : iri                                                
[67]&nbsp;&nbsp;&nbsp;  <b>shapeExprLabel</b>             : iri | blankNode                                    
[68]&nbsp;&nbsp;&nbsp;  <b>tripleExprLabel</b>            : iri | blankNode                                    
[16t]&nbsp;&nbsp;&nbsp; <b>numericLiteral</b>             : INTEGER | DECIMAL | DOUBLE                         
[69]&nbsp;&nbsp;&nbsp;  <b>rdfLiteral</b>                 : langString | string ("^^" datatype)?               
[134s]&nbsp;&nbsp;&nbsp;<b>booleanLiteral</b>             : "true" | "false"                                   
[135s]&nbsp;&nbsp;&nbsp;<b>string</b>                     : &nbsp;&nbsp;&nbsp;STRING_LITERAL1 | STRING_LITERAL_LONG1          
         <b></b>                             | STRING_LITERAL2 | STRING_LITERAL_LONG2           
[70]&nbsp;&nbsp;&nbsp;  <b>langString</b>                 : &nbsp;&nbsp;&nbsp;LANG_STRING_LITERAL1 | LANG_STRING_LITERAL_LONG1
         <b></b>                             | LANG_STRING_LITERAL2 | LANG_STRING_LITERAL_LONG2 
[136s]&nbsp;&nbsp;&nbsp;<b>iri</b>                        : IRIREF | prefixedName                              
[137s]&nbsp;&nbsp;&nbsp;<b>prefixedName</b>               : PNAME_LN | PNAME_NS                                
[138s]&nbsp;&nbsp;&nbsp;<b>blankNode</b>                  : BLANK_NODE_LABEL                                   
[71]&nbsp;&nbsp;&nbsp;  <b>&lt;CODE&gt;</b>                     : "{" ([^%\\] | "\\" [%\\] | UCHAR)* "%" "}"         
[72]&nbsp;&nbsp;&nbsp;  <b>&lt;REPEAT_RANGE&gt;</b>             : "{" INTEGER ( "," (INTEGER | "*")? )? "}"          
[73]&nbsp;&nbsp;&nbsp;  <b>&lt;RDF_TYPE&gt;</b>                 : "a"                                                
[18t]&nbsp;&nbsp;&nbsp; <b>&lt;IRIREF&gt;</b>                   : "&lt;" ([^#0000- &lt;&gt;\"{}|^`\\] | UCHAR)* "&gt;"           
[140s]&nbsp;&nbsp;&nbsp;<b>&lt;PNAME_NS&gt;</b>                 : PN_PREFIX? ":"                                     
[141s]&nbsp;&nbsp;&nbsp;<b>&lt;PNAME_LN&gt;</b>                 : PNAME_NS PN_LOCAL                                  
[74]&nbsp;&nbsp;&nbsp;  <b>&lt;ATPNAME_NS&gt;</b>               : "@" PNAME_NS                                       
[75]&nbsp;&nbsp;&nbsp;  <b>&lt;ATPNAME_LN&gt;</b>               : "@" PNAME_LN                                       
[76]&nbsp;&nbsp;&nbsp;  <b>&lt;REGEXP&gt;</b>                   : '/' ([^/\\\n\r]                                    
         <b></b>                             &nbsp;&nbsp;&nbsp;&nbsp; | '\\' [nrt\\|.?*+(){}$-\[\]^/]               
         <b></b>                             &nbsp;&nbsp;&nbsp;&nbsp; | UCHAR                                       
         <b></b>                             &nbsp;&nbsp;&nbsp;&nbsp;)+ '/' [smix]*                                 
[142s]&nbsp;&nbsp;&nbsp;<b>&lt;BLANK_NODE_LABEL&gt;</b>         : "_:"                                               
         <b></b>                             (PN_CHARS_U | [0-9])                               
         <b></b>                             ((PN_CHARS | ".")* PN_CHARS)?                      
[145s]&nbsp;&nbsp;&nbsp;<b>&lt;LANGTAG&gt;</b>                  : "@" ([a-zA-Z])+ ("-" ([a-zA-Z0-9])+)*              
[19t]&nbsp;&nbsp;&nbsp; <b>&lt;INTEGER&gt;</b>                  : [+-]? [0-9]+                                       
[20t]&nbsp;&nbsp;&nbsp; <b>&lt;DECIMAL&gt;</b>                  : [+-]? [0-9]* "." [0-9]+                            
[21t]&nbsp;&nbsp;&nbsp; <b>&lt;DOUBLE&gt;</b>                   : &nbsp;&nbsp;[+-]? ([0-9]+ "." [0-9]* EXPONENT                
         <b></b>                             | "."? [0-9]+ EXPONENT)                            
[155s]&nbsp;&nbsp;&nbsp;<b>&lt;EXPONENT&gt;</b>                 : [eE] [+-]? [0-9]+                                  
[156s]&nbsp;&nbsp;&nbsp;<b>&lt;STRING_LITERAL1&gt;</b>          : "'" ([^'\\\n\r] | ECHAR | UCHAR)* "'"              
[157s]&nbsp;&nbsp;&nbsp;<b>&lt;STRING_LITERAL2&gt;</b>          : '"' ([^\"\\\n\r] | ECHAR | UCHAR)* '"'             
[158s]&nbsp;&nbsp;&nbsp;<b>&lt;STRING_LITERAL_LONG1&gt;</b>     : "'''"                                              
         <b></b>                             ( ("'" | "''")? ([^\\'\\] | ECHAR | UCHAR) )*      
         <b></b>                             "'''"                                              
[159s]&nbsp;&nbsp;&nbsp;<b>&lt;STRING_LITERAL_LONG2&gt;</b>     : '"""'                                              
         <b></b>                             ( ('"' | '""')? ([^\"\\] | ECHAR | UCHAR) )*       
         <b></b>                             '"""'                                              
[77]&nbsp;&nbsp;&nbsp;  <b>&lt;LANG_STRING_LITERAL1&gt;</b>     : "'" ([^'\\\n\r] | ECHAR | UCHAR)* "'" LANGTAG      
[78]&nbsp;&nbsp;&nbsp;  <b>&lt;LANG_STRING_LITERAL2&gt;</b>     : '"' ([^\"\\\n\r] | ECHAR | UCHAR)* '"' LANGTAG     
[79]&nbsp;&nbsp;&nbsp;  <b>&lt;LANG_STRING_LITERAL_LONG1&gt;</b>: "'''"                                              
         <b></b>                             ( ("'" | "''")? ([^\\'\\] | ECHAR | UCHAR) )*      
         <b></b>                             "'''" LANGTAG                                      
[80]&nbsp;&nbsp;&nbsp;  <b>&lt;LANG_STRING_LITERAL_LONG2&gt;</b>: '"""'                                              
         <b></b>                             ( ('"' | '""')? ([^\"\\] | ECHAR | UCHAR) )*       
         <b></b>                             '"""' LANGTAG                                      
[26t]&nbsp;&nbsp;&nbsp; <b>&lt;UCHAR&gt;</b>                    : &nbsp;&nbsp;&nbsp;"\\u" HEX HEX HEX HEX                           
         <b></b>                             | "\\U" HEX HEX HEX HEX HEX HEX HEX HEX            
[160s]&nbsp;&nbsp;&nbsp;<b>&lt;ECHAR&gt;</b>                    : "\\" [tbnrf\\\"\\']                                
[164s]&nbsp;&nbsp;&nbsp;<b>&lt;PN_CHARS_BASE&gt;</b>            : &nbsp;&nbsp;&nbsp;[A-Z] | [a-z]                                   
         <b></b>                             | [#00C0-#00D6] | [#00D8-#00F6] | [#00F8-#02FF]    
         <b></b>                             | [#0370-#037D] | [#037F-#1FFF]                    
         <b></b>                             | [#200C-#200D] | [#2070-#218F] | [#2C00-#2FEF]    
         <b></b>                             | [#3001-#D7FF] | [#F900-#FDCF] | [#FDF0-#FFFD]    
         <b></b>                             | [#10000-#EFFFF]                                  
[165s]&nbsp;&nbsp;&nbsp;<b>&lt;PN_CHARS_U&gt;</b>               : PN_CHARS_BASE | "_"                                
[167s]&nbsp;&nbsp;&nbsp;<b>&lt;PN_CHARS&gt;</b>                 : &nbsp;&nbsp;&nbsp;PN_CHARS_U | "-" | [0-9]                        
         <b></b>                             | [#00B7] | [#0300-#036F] | [#203F-#2040]          
[168s]&nbsp;&nbsp;&nbsp;<b>&lt;PN_PREFIX&gt;</b>                : PN_CHARS_BASE ( (PN_CHARS | ".")* PN_CHARS )?      
[81]&nbsp;&nbsp;&nbsp;  <b>&lt;PN_LOCAL&gt;</b>                 : (PN_CHARS_U | ":" | [0-9] | PLX)                   
         <b></b>                             (                                                  
         <b></b>                             &nbsp;(PN_CHARS | "." | ":" | PLX)*                     
         <b></b>                             &nbsp;(PN_CHARS | ":" | PLX)                            
         <b></b>                             )?                                                 
[170s]&nbsp;&nbsp;&nbsp;<b>&lt;PLX&gt;</b>                      : PERCENT | PN_LOCAL_ESC                             
[171s]&nbsp;&nbsp;&nbsp;<b>&lt;PERCENT&gt;</b>                  : "%" HEX HEX                                        
[172s]&nbsp;&nbsp;&nbsp;<b>&lt;HEX&gt;</b>                      : [0-9] | [A-F] | [a-f]                              
[173s]&nbsp;&nbsp;&nbsp;<b>&lt;PN_LOCAL_ESC&gt;</b>             : &nbsp;&nbsp;"\\" ( "_" | "~" | "." | "-" | "!" | "$" | "&amp;"   
         <b></b>                             | "'" | "(" | ")" | "*" | "+" | "," | ";" | "="    
         <b></b>                             | "/" | "?" | "#" | "@" | "%" )                    
[82]&nbsp;&nbsp;&nbsp;  <b>PASSED TOKENS</b>              : &nbsp;&nbsp;&nbsp;[ \t\r\n]+                                      
         <b></b>                             | "#" [^\r\n]*                                     
         <b></b>                             | "/*" ([^*] | '*' ([^/] | '\\/'))* "*/"           </pre>
      </div>
    </div>

    <!-- Non-objects are typically not injected into the grammar as they
         are abstract — they don't manifest in a materializable object.

shapeExpr = ShapeOr | ShapeAnd | ShapeNot | NodeConstraint | Shape | ShapeExternal | shapeExprRef ;
shapeExprLabel = IRIREF | BNODE ;
numericLiteral = INTEGER | DECIMAL | DOUBLE ;
valueSetValue = objectValue | IriStem | IriStemRange | LiteralStem | LiteralStemRange | Language | LanguageStem | LanguageStemRange ;
objectValue = IRIREF | ObjectLiteral ;
ObjectLiteral { value:STRING language:LANGTAG? type:IRIREF? }
tripleExpr = EachOf | OneOf | TripleConstraint | tripleExprRef ;
tripleExprLabel = IRIREF | BNODE ;

         If we change our mind, the complement are rendered here:

  <tr class="nob"><td></td><td><a class="nob">shapeExpr</a></td>         <td>=</td> <td><a class="objref">ShapeOr</a> | <a class="objref">ShapeAnd</a> | <a class="objref">ShapeNot</a> | <a class="objref">NodeConstraint</a> | <a class="objref">Shape</a> | <a class="objref">ShapeExternal</a> | <a class="objref">shapeExprRef</a> ;</td></tr>
  <tr class="nob"><td></td><td><a class="nob">shapeExprLabel</a></td>       <td>=</td> <td><a>IRIREF</a> | <a>BNODE</a> ;</td></tr>
  <tr class="nob"><td></td><td><a class="nob">numericLiteral</a></td> <td>=</td><td><a>INTEGER</a> | <a>DECIMAL</a> | <a>DOUBLE</a> ;</td></tr>
  <tr class="nob"><td></td><td><a class="nob">valueSetValue</a></td><td>=</td><td><a class="nobref">objectValue</a> | <a class="objref">IriStem</a> | <a class="objref">IriStemRange</a> | <a class="objref">LiteralStem</a> | <a class="objref">LiteralStemRange</a> | <a class="objref">Language</a> | <a class="objref">LanguageStem</a> | <a class="objref">LanguageStemRange</a> ;</td></tr>
  <tr class="nob"><td></td><td><a class="nob">objectValue</a></td><td>=</td><td><a>IRIREF</a> | <a>ObjectLiteral</a> ;</td></tr>
  <tr class="nob"><td></td><td><a class="nob">ObjectLiteral</a></td><td>{</td><td><span class="param">value</span>:<a>STRING</a> <span class="param">language</span>:<a>STRING</a>? <span class="param">type</span>:<a>STRING</a>? }</td></tr>
  <tr class="nob"><td></td><td><a class="nob">tripleExpr</a></td>             <td>=</td><td><a class="objref">EachOf</a> | <a class="objref">OneOf</a> | <a class="objref">TripleConstraint</a> | <a class="objref">tripleExprRef</a> ;</td></tr>
  <tr class="nob"><td></td><td><a class="nob">tripleExprLabel</a></td>   <td>=</td><td><a>IRIREF</a> | <a>BNODE</a> ;</td></tr>
    -->

    </section>

    <section id="shexj" class="appendix"><!--OddPage--><div class="header-wrapper"><h2 id="a-shex-json-syntax-shexj">ShEx JSON Syntax (ShExJ)</h2></div>
      

      <p>
        This section aggregates the <a href="#dfn-json-grammar" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-json-grammar-1">JSON grammar</a> rules defined above and includes terminals referenced above.
      </p>

      <p>
        A ShExJ document is a JSON-LD [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD<!---0.294583%--></a></cite><!---0.294583%-->] document which uses a proscribed structure to define a <a href="#dfn-shapes-schema" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapes-schema-8">schema</a> containing <a href="#dfn-shape-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shape-expressions-15">shape expressions</a> and <a href="#dfn-triple-expressions" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-triple-expressions-16">triple expressions</a>.
        A ShExJ document <em class="rfc2119">MAY<!---0.294583%--></em> include an <code>@context</code> property referencing <code>http://www.w3.org/ns/shex.jsonld</code><!-- , and MAY include additional contexts and term definitions -->.
        In the absense of a top-level <code>@context</code>, ShEx Processors <em class="rfc2119">MUST<!---0.294583%--></em> act as if a <code>@context</code> property is present with the value <code>http://www.w3.org/ns/shex.jsonld</code>.
      </p>

      <p>
        A ShExJ document can also be thought of as the serialization of an <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">RDF Graph</a> using the Shape Expression Vocabulary [<cite><a class="bibref" data-link-type="biblio" href="#bib-shex-vocab" title="Shape Expression Vocabulary">shex-vocab<!---0.294583%--></a></cite><!---0.294583%-->] which conforms to the shape defined in <a href="#shexr" class="secionRef sec-ref">RDF Representation of ShEx (ShExR)</a>.
        Processors <em class="rfc2119">MAY<!---0.294583%--></em> interpret a ShExJ document as an RDF Graph.
        Processors may also transform arbitrary RDF Graphs conforming to <a href="#shexr" class="secionRef sec-ref">RDF Representation of ShEx (ShExR)</a> into ShExJ using a mechanism not described within this specification.
      </p>

      <p>In ShExJ, the unbounded cardinality constraint is <code>-1</code>, rather than <code>"*"</code>.</p>

      <p>
        This is the complete grammar for <dfn id="dfn-shexj" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">ShExJ</dfn>.
      </p>
      <div class="shexjTable">
<pre>           <b>Schema</b> { "@context":"http://www.w3.org/ns/shex.jsonld"?  imports:[IRIREF+]?      
                 <b></b> &nbsp; startActs:[SemAct+]? start:shapeExpr? shapes:[ShapeDecl+]? }            
        <b>ShapeDecl</b> { id:shapeExprLabel abstract:BOOL? shapeExpr:shapeExpr | ShapeExternal }  
        <b>shapeExpr</b> = ShapeOr | ShapeAnd | ShapeNot | NodeConstraint | Shape | ShapeExprRef ; 
          <b>ShapeOr</b> { shapeExprs:[shapeExpr{2,}] }                                            
         <b>ShapeAnd</b> { shapeExprs:[shapeExpr{2,}] }                                            
         <b>ShapeNot</b> { shapeExpr:shapeExpr }                                                   
    <b>ShapeExternal</b> { }                                                                       
     <b>ShapeExprRef</b> { label:shapeExprLabel exact:BOOL? }                                      
   <b>shapeExprLabel</b> = IRIREF | BNODE ;                                                        
   <b>NodeConstraint</b> { nodeKind:("iri" | "bnode" | "nonliteral" | "literal")?                  
                 <b></b> &nbsp; datatype:IRIREF? xsFacet* values:[valueSetValue+]? }                    
          <b>xsFacet</b> = stringFacet | numericFacet ;                                            
      <b>stringFacet</b> = (length|minlength|maxlength):INTEGER | pattern:STRING flags:STRING? ;   
     <b>numericFacet</b> = (mininclusive|minexclusive|maxinclusive|maxexclusive):numericLiteral    
                 <b></b> | (totaldigits|fractiondigits):INTEGER ;                                  
   <b>numericLiteral</b> = INTEGER | DECIMAL | DOUBLE ;                                            
    <b>valueSetValue</b> = objectValue | IriStem | IriStemRange | LiteralStem | LiteralStemRange   
                 <b></b> | Language | LanguageStem | LanguageStemRange ;                           
      <b>objectValue</b> = IRIREF | ObjectLiteral ;                                                
    <b>ObjectLiteral</b> { value:STRING language:STRING? type:STRING? }                            
          <b>IriStem</b> { stem:IRIREF }                                                           
     <b>IriStemRange</b> { stem:(IRIREF | Wildcard) exclusions:[IRIREF|IriStem+]? }                
      <b>LiteralStem</b> { stem:STRING }                                                           
 <b>LiteralStemRange</b> { stem:(STRING | Wildcard) exclusions:[STRING|LiteralStem+]? }            
         <b>Language</b> { languageTag:LANGTAG }                                                   
     <b>LanguageStem</b> { stem:(LANGTAG | EMPTY) }                                                
<b>LanguageStemRange</b> { stem:(LANGTAG | EMPTY) exclusions:[LANGTAG|LanguageStem+]? }            
         <b>Wildcard</b> { /* empty */ }                                                           
            <b>Shape</b> { extends:[shapeExprRef]? closed:BOOL?                                    
                 <b></b> &nbsp; extra:[IRIREF+]? expression:tripleExpr?                                 
                 <b></b> &nbsp; semActs:[SemAct+]? annotations:[Annotation+]? }                         
       <b>tripleExpr</b> = EachOf | OneOf | TripleConstraint | tripleExprRef ;                     
           <b>EachOf</b> { id:tripleExprLabel? expressions:[tripleExpr{2,}]                        
                 <b></b> &nbsp; min:INTEGER? max:INTEGER?                                               
                 <b></b> &nbsp; semActs:[SemAct+]? annotations:[Annotation+]? }                         
            <b>OneOf</b> { id:tripleExprLabel? expressions:[tripleExpr{2,}]                        
                 <b></b> &nbsp; min:INTEGER? max:INTEGER?                                               
                 <b></b> &nbsp; semActs:[SemAct+]? annotations:[Annotation+]? }                         
 <b>TripleConstraint</b> { id:tripleExprLabel? inverse:BOOL? predicate:IRIREF valueExpr:shapeExpr? 
                 <b></b> &nbsp; min:INTEGER? max:INTEGER?                                               
                 <b></b> &nbsp; semActs:[SemAct+]? annotations:[Annotation+]? }                         
    <b>tripleExprRef</b> = tripleExprLabel ;                                                       
  <b>tripleExprLabel</b> = IRIREF | BNODE ;                                                        
           <b>SemAct</b> { name:IRIREF code:STRING? }                                              
       <b>Annotation</b> { predicate:IRIREF object:objectValue }                                   
<b><i># Terminals:</i></b>      &nbsp; <i>These follow the rules for terminals in the XML 1.0 5th Edition</i>         
                  <i>#</i> <i>Turtle IRIREF without enclosing "&lt;&gt;"s</i>                                   
           <b>IRIREF</b> : (PN_CHARS | '.' | ':' | '/' | '\\' | '#' | '@' | '%' | '&amp;' | UCHAR)* ;  
                  <i>#</i> <i>Turtle BLANK_NODE_LABEL</i>                                                 
            <b>BNODE</b> : '_:' (PN_CHARS_U | [0-9]) ((PN_CHARS | '.')* PN_CHARS)? ;               
                  <i>#</i> <i>JSON boolean values</i>                                                     
             <b>BOOL</b> : "true" | "false" ;                                                      
                  <i>#</i> <i>Turtle INTEGER</i>                                                          
          <b>INTEGER</b> : [+-]? [0-9] + ;                                                         
                  <i>#</i> <i>Turtle DECIMAL</i>                                                          
          <b>DECIMAL</b> : [+-]? [0-9]* '.' [0-9] + ;                                              
                  <i>#</i> <i>Turtle DOUBLE</i>                                                           
           <b>DOUBLE</b> : [+-]?                                                                   
                 <b></b> &nbsp; (&nbsp;&nbsp;[0-9] + '.' [0-9]* EXPONENT                                          
                 <b></b> &nbsp; &nbsp;| '.' [0-9]+ EXPONENT                                                  
                 <b></b> &nbsp; &nbsp;| [0-9]+ EXPONENT                                                      
                 <b></b> &nbsp; ) ;                                                                     
                  <i>#</i> <i>BCP47 Language-Tag</i>                                                      
          <b>LANGTAG</b> : [a-zA-Z]+ ('-' [a-zA-Z0-9]+)* ;                                         
                  <i>#</i> <i>any JSON string</i>                                                         
           <b>STRING</b> : .* ;                                                                    
                  <i>#</i> <i>empty string</i>                                                            
            <b>EMPTY</b> : ^$ ;                                                                    
<b><i># Components:</i></b>     &nbsp; <i>Terminals referenced by other terminals but not by external productions:</i>
        <b>PN_PREFIX</b> : PN_CHARS_BASE ((PN_CHARS | '.')* PN_CHARS)? ;                           
    <b>PN_CHARS_BASE</b> : &nbsp;&nbsp;[A-Z] | [a-z] | [\u00C0-\u00D6] | [\u00D8-\u00F6]                     
                 <b></b> &nbsp; | [\u00F8-\u02FF] | [\u0370-\u037D] | [\u037F-\u1FFF]                   
                 <b></b> &nbsp; | [\u200C-\u200D] | [\u2070-\u218F] | [\u2C00-\u2FEF]                   
                 <b></b> &nbsp; | [\u3001-\uD7FF] | [\uF900-\uFDCF] | [\uFDF0-\uFFFD]                   
                 <b></b> &nbsp; | [\u10000-\uEFFFF] ;                                                   
         <b>PN_CHARS</b> : &nbsp;&nbsp;PN_CHARS_U | '-' | [0-9]                                              
                 <b></b> &nbsp; | '\u00B7' | [\u0300-\u036F] | [\u203F-\u2040] ;                        
       <b>PN_CHARS_U</b> : PN_CHARS_BASE | '_' ;                                                   
            <b>UCHAR</b> : &nbsp;&nbsp;'\\u' HEX HEX HEX HEX                                                 
                 <b></b> &nbsp; | '\\U' HEX HEX HEX HEX HEX HEX HEX HEX ;                               
              <b>HEX</b> : [0-9] | [A-F] | [a-f] ;                                                 
         <b>EXPONENT</b> : [eE] [+-]? [0-9]+ ;                                                     </pre>

</div>

    </section>


<section id="shexr" class="appendix"><!--OddPage--><div class="header-wrapper"><h2 id="b-rdf-representation-of-shex-shexr">RDF Representation of ShEx (ShExR)</h2></div>
  

  <p>
    A <dfn id="dfn-shexr" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">ShExR</dfn> graph is any <a data-cite="rdf11-concepts#dfn-rdf-graph" data-link-type="dfn" href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">RDF Graph</a> which conforms to the following <a href="#dfn-shapes-schema" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shapes-schema-10">shapes schema</a> and meets the <a href="#schema-requirements">Schema Requirements</a>.
    Every <a href="#dfn-shexr" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexr-1">ShExR</a> document is <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-graph-isomorphism">graph isomorphic</a>[<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">rdf11-concepts<!---0.294583%--></a></cite><!---0.294583%-->] to the <a href="https://www.w3.org/TR/json-ld11-api/#deserialize-json-ld-to-rdf-algorithm">RDF serialization</a>[<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">json-ld<!---0.294583%--></a></cite><!---0.294583%-->] of some <a href="#dfn-shexj" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexj-14">ShExJ</a> document.
  </p>

  <pre class="addition nohighlight" title="ShExR Shape Expression Schema" data-oninclude="highlightShExC"><span class="keyword">PREFIX</span> sx: <span class="relativeIRI">&lt;http://www.w3.org/ns/shex#&gt;</span>
<span class="keyword">PREFIX</span> xsd: <span class="relativeIRI">&lt;http://www.w3.org/2001/XMLSchema#&gt;</span>
<span class="keyword">PREFIX</span> rdf: <span class="relativeIRI">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>
<span class="keyword">BASE</span> <span class="relativeIRI">&lt;http://www.w3.org/ns/shex&gt;</span>
<span class="keyword">start=</span>@<span class="relativeIRI">&lt;#Schema&gt;</span>

<span class="relativeIRI">&lt;#Schema&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:Schema]</span> ;
  sx:imports @<span class="relativeIRI">&lt;#IriList1Plus&gt;</span> ? ;
  sx:startActs @<span class="relativeIRI">&lt;#SemActList1Plus&gt;</span> ? ;
  sx:start @<span class="relativeIRI">&lt;#shapeDeclOrExpr&gt;</span> ? ;
  sx:shapes @<span class="relativeIRI">&lt;#ShapeDeclList1Plus&gt;</span> ?
}

<span class="relativeIRI">&lt;#shapeDeclOrExpr&gt;</span> @<span class="relativeIRI">&lt;#ShapeDecl&gt;</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#shapeExpr&gt;</span>

<span class="relativeIRI">&lt;#ShapeDecl&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:ShapeDecl]</span> ;
  sx:abstract <span class="valueSet">[true false]</span> ? ;
  sx:shapeExpr @<span class="relativeIRI">&lt;#shapeExpr&gt;</span>
}

<span class="relativeIRI">&lt;#shapeExpr&gt;</span> @<span class="relativeIRI">&lt;#ShapeOr&gt;</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#ShapeAnd&gt;</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#ShapeNot&gt;</span>
    <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#NodeConstraint&gt;</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#Shape&gt;</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#ShapeExternal&gt;</span>

<span class="relativeIRI">&lt;#ShapeOr&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:ShapeOr]</span> ;
  sx:shapeExprs @<span class="relativeIRI">&lt;#shapeDeclOrExprList2Plus&gt;</span>
}

<span class="relativeIRI">&lt;#ShapeAnd&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:ShapeAnd]</span> ;
  sx:shapeExprs @<span class="relativeIRI">&lt;#shapeDeclOrExprList2Plus&gt;</span>
}

<span class="relativeIRI">&lt;#ShapeNot&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:ShapeNot]</span> ;
  sx:shapeExpr @<span class="relativeIRI">&lt;#shapeDeclOrExpr&gt;</span>
}

<span class="relativeIRI">&lt;#NodeConstraint&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:NodeConstraint]</span> ;
  sx:nodeKind <span class="valueSet">[sx:iri sx:bnode sx:literal sx:nonliteral]</span> ? ;
  sx:datatype <span class="keyword">IRI</span> ? ;
  &amp;<span class="relativeIRI">&lt;#xsFacets&gt;</span> ;
  sx:values @<span class="relativeIRI">&lt;#valueSetValueList1Plus&gt;</span> ? ;
  sx:semActs @<span class="relativeIRI">&lt;#SemActList1Plus&gt;</span> ? ;
  sx:annotation @<span class="relativeIRI">&lt;#AnnotationList1Plus&gt;</span> ?
}

<span class="relativeIRI">&lt;#Shape&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:Shape]</span> ;
  sx:extends @<span class="relativeIRI">&lt;#shapeDeclOrExprList1Plus&gt;</span>? ;
  sx:closed <span class="valueSet">[true false]</span> ? ;
  sx:extra <span class="keyword">IRI</span> * ;
  sx:expression @<span class="relativeIRI">&lt;#tripleExpression&gt;</span> ? ;
  sx:semActs @<span class="relativeIRI">&lt;#SemActList1Plus&gt;</span> ? ;
  sx:annotation @<span class="relativeIRI">&lt;#AnnotationList1Plus&gt;</span> ?
}

<span class="relativeIRI">&lt;#ShapeExternal&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:ShapeExternal]</span>
}

<span class="relativeIRI">&lt;#SemAct&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:SemAct]</span> ;
  sx:name <span class="keyword">IRI</span> ;
  sx:code xsd:string ?
}

<span class="relativeIRI">&lt;#Annotation&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:Annotation]</span> ;
  sx:predicate <span class="keyword">IRI</span> ;
  sx:object @<span class="relativeIRI">&lt;#objectValue&gt;</span>
}

<span class="relativeIRI">&lt;#facet_holder&gt;</span> { <span class="comment"># hold labeled productions</span>
  $<span class="relativeIRI">&lt;#xsFacets&gt;</span> ( &amp;<span class="relativeIRI">&lt;#stringFacet&gt;</span> | &amp;<span class="relativeIRI">&lt;#numericFacet&gt;</span> ) * ;
  $<span class="relativeIRI">&lt;#stringFacet&gt;</span> (
      sx:length xsd:integer
    | sx:minlength xsd:integer
    | sx:maxlength xsd:integer
    | sx:pattern xsd:string ; sx:flags xsd:string ?
  ) ;
  $<span class="relativeIRI">&lt;#numericFacet&gt;</span> (
      sx:mininclusive   @<span class="relativeIRI">&lt;#numericLiteral&gt;</span>
    | sx:minexclusive   @<span class="relativeIRI">&lt;#numericLiteral&gt;</span>
    | sx:maxinclusive   @<span class="relativeIRI">&lt;#numericLiteral&gt;</span>
    | sx:maxexclusive   @<span class="relativeIRI">&lt;#numericLiteral&gt;</span>
    | sx:totaldigits    xsd:integer
    | sx:fractiondigits xsd:integer
  )
}
<span class="relativeIRI">&lt;#numericLiteral&gt;</span> xsd:integer <span class="keyword">OR</span> xsd:decimal <span class="keyword">OR</span> xsd:double

<span class="relativeIRI">&lt;#valueSetValue&gt;</span> @<span class="relativeIRI">&lt;#objectValue&gt;</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#IriStem&gt;</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#IriStemRange&gt;</span>
                               <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#LiteralStem&gt;</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#LiteralStemRange&gt;</span>
                <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#Language&gt;</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#LanguageStem&gt;</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#LanguageStemRange&gt;</span>
<span class="relativeIRI">&lt;#objectValue&gt;</span> <span class="keyword">IRI</span> <span class="keyword">OR</span> <span class="keyword">LITERAL</span>

<span class="relativeIRI">&lt;#IriStem&gt;</span> <span class="keyword">CLOSED</span> { a <span class="valueSet">[sx:IriStem]</span> ; sx:stem xsd:string }
<span class="relativeIRI">&lt;#IriStemRange&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:IriStemRange]</span> ;
  sx:stem xsd:string <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#Wildcard&gt;</span> ;
  sx:exclusion @<span class="relativeIRI">&lt;#IriStemExclusionList1Plus&gt;</span>
}

<span class="relativeIRI">&lt;#LiteralStem&gt;</span> <span class="keyword">CLOSED</span> { a <span class="valueSet">[sx:LiteralStem]</span> ; sx:stem xsd:string }
<span class="relativeIRI">&lt;#LiteralStemRange&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:LiteralStemRange]</span> ;
  sx:stem xsd:string <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#Wildcard&gt;</span> ;
  sx:exclusion @<span class="relativeIRI">&lt;#LiteralStemExclusionList1Plus&gt;</span>
}

<span class="relativeIRI">&lt;#Language&gt;</span> <span class="keyword">CLOSED</span> { a <span class="valueSet">[sx:Language]</span> ; sx:languageTag xsd:string }
<span class="relativeIRI">&lt;#LanguageStem&gt;</span> <span class="keyword">CLOSED</span> { a <span class="valueSet">[sx:LanguageStem]</span> ; sx:stem xsd:string }
<span class="relativeIRI">&lt;#LanguageStemRange&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:LanguageStemRange]</span> ;
  sx:stem xsd:string <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#Wildcard&gt;</span> ;
  sx:exclusion @<span class="relativeIRI">&lt;#LanguageStemExclusionList1Plus&gt;</span>
}

<span class="relativeIRI">&lt;#Wildcard&gt;</span> <span class="keyword">BNODE</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:Wildcard]</span>
}

<span class="relativeIRI">&lt;#tripleExpression&gt;</span>
     @<span class="relativeIRI">&lt;#NotYetResolvedInclusion&gt;</span>
  <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#TripleConstraint&gt;</span>
  <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#OneOf&gt;</span>
  <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#EachOf&gt;</span>

<span class="relativeIRI">&lt;#NotYetResolvedInclusion&gt;</span> <span class="keyword">CLOSED</span> {} <span class="comment"># will have 1 incoming, 0 outgoing arcs</span>

<span class="relativeIRI">&lt;#OneOf&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:OneOf]</span> ;
  sx:min xsd:integer ? ;
  sx:max xsd:integer ? ;
  sx:expressions @<span class="relativeIRI">&lt;#tripleExpressionList2Plus&gt;</span> ;
  sx:semActs @<span class="relativeIRI">&lt;#SemActList1Plus&gt;</span> ? ;
  sx:annotation @<span class="relativeIRI">&lt;#AnnotationList1Plus&gt;</span> ?
}

<span class="relativeIRI">&lt;#EachOf&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:EachOf]</span> ;
  sx:min xsd:integer ? ;
  sx:max xsd:integer ? ;
  sx:expressions @<span class="relativeIRI">&lt;#tripleExpressionList2Plus&gt;</span> ;
  sx:semActs @<span class="relativeIRI">&lt;#SemActList1Plus&gt;</span> ? ;
  sx:annotation @<span class="relativeIRI">&lt;#AnnotationList1Plus&gt;</span> ?
}

<span class="relativeIRI">&lt;#TripleConstraint&gt;</span> <span class="keyword">CLOSED</span> {
  a <span class="valueSet">[sx:TripleConstraint]</span> ;
  sx:inverse <span class="valueSet">[true false]</span> ? ;
  sx:negated <span class="valueSet">[true false]</span> ? ;
  sx:min xsd:integer ? ;
  sx:max xsd:integer ? ;
  sx:predicate <span class="keyword">IRI</span> ;
  sx:valueExpr @<span class="relativeIRI">&lt;#shapeDeclOrExpr&gt;</span> ? ;
  sx:semActs @<span class="relativeIRI">&lt;#SemActList1Plus&gt;</span> ? ;
  sx:annotation @<span class="relativeIRI">&lt;#AnnotationList1Plus&gt;</span> ?
}

<span class="comment"># RDF Lists</span>

<span class="relativeIRI">&lt;#tripleExpressionList2Plus&gt;</span> <span class="keyword">CLOSED</span> {
  rdf:first @<span class="relativeIRI">&lt;#tripleExpression&gt;</span> ;
  rdf:rest @<span class="relativeIRI">&lt;#tripleExpressionList1Plus&gt;</span>
}
<span class="relativeIRI">&lt;#tripleExpressionList1Plus&gt;</span> <span class="keyword">CLOSED</span> {
  rdf:first @<span class="relativeIRI">&lt;#tripleExpression&gt;</span> ;
  rdf:rest  <span class="valueSet">[rdf:nil]</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#tripleExpressionList1Plus&gt;</span>
}

<span class="relativeIRI">&lt;#IriList1Plus&gt;</span> <span class="keyword">CLOSED</span> {
  rdf:first <span class="keyword">IRI</span> ;
  rdf:rest  <span class="valueSet">[rdf:nil]</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#IriList1Plus&gt;</span>
}

<span class="relativeIRI">&lt;#SemActList1Plus&gt;</span> <span class="keyword">CLOSED</span> {
  rdf:first @<span class="relativeIRI">&lt;#SemAct&gt;</span> ;
  rdf:rest  <span class="valueSet">[rdf:nil]</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#SemActList1Plus&gt;</span>
}

<span class="relativeIRI">&lt;#ShapeDeclList1Plus&gt;</span> <span class="keyword">CLOSED</span> {
  rdf:first @<span class="relativeIRI">&lt;#ShapeDecl&gt;</span> ;
  rdf:rest  <span class="valueSet">[rdf:nil]</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#ShapeDeclList1Plus&gt;</span>
}

<span class="relativeIRI">&lt;#shapeDeclOrExprList2Plus&gt;</span> <span class="keyword">CLOSED</span> {
  rdf:first @<span class="relativeIRI">&lt;#shapeDeclOrExpr&gt;</span> ;
  rdf:rest  @<span class="relativeIRI">&lt;#shapeDeclOrExprList1Plus&gt;</span>
}
<span class="relativeIRI">&lt;#shapeDeclOrExprList1Plus&gt;</span> <span class="keyword">CLOSED</span> {
  rdf:first @<span class="relativeIRI">&lt;#shapeDeclOrExpr&gt;</span> ;
  rdf:rest  <span class="valueSet">[rdf:nil]</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#shapeDeclOrExprList1Plus&gt;</span>
}

<span class="relativeIRI">&lt;#valueSetValueList1Plus&gt;</span> <span class="keyword">CLOSED</span> {
  rdf:first @<span class="relativeIRI">&lt;#valueSetValue&gt;</span> ;
  rdf:rest  <span class="valueSet">[rdf:nil]</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#valueSetValueList1Plus&gt;</span>
}

<span class="relativeIRI">&lt;#AnnotationList1Plus&gt;</span> <span class="keyword">CLOSED</span> {
  rdf:first @<span class="relativeIRI">&lt;#Annotation&gt;</span> ;
  rdf:rest  <span class="valueSet">[rdf:nil]</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#AnnotationList1Plus&gt;</span>
}

<span class="relativeIRI">&lt;#IriStemExclusionList1Plus&gt;</span> <span class="keyword">CLOSED</span> {
  rdf:first <span class="keyword">IRI</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#IriStem&gt;</span> ;
  rdf:rest  <span class="valueSet">[rdf:nil]</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#IriStemExclusionList1Plus&gt;</span>
}

<span class="relativeIRI">&lt;#LiteralStemExclusionList1Plus&gt;</span> <span class="keyword">CLOSED</span> {
  rdf:first xsd:string <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#LiteralStem&gt;</span> ;
  rdf:rest  <span class="valueSet">[rdf:nil]</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#LiteralStemExclusionList1Plus&gt;</span>
}

<span class="relativeIRI">&lt;#LanguageStemExclusionList1Plus&gt;</span> <span class="keyword">CLOSED</span> {
  rdf:first xsd:string <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#LanguageStem&gt;</span> ;
  rdf:rest  <span class="valueSet">[rdf:nil]</span> <span class="keyword">OR</span> @<span class="relativeIRI">&lt;#LanguageStemExclusionList1Plus&gt;</span>
}</pre>
</section>

<section class="appendix normative" id="iana-considerations"><!--OddPage--><div class="header-wrapper"><h2 id="c-iana-considerations">IANA Considerations</h2></div>
  

  <p>This section has been submitted to the Internet Engineering Steering
    Group (IESG) for review, approval, and registration with IANA.</p>

  <section id="text-shex"><div class="header-wrapper"><h3 id="c-1-text-shex">text/shex</h3></div>
  <dl>
    <dt>Type name:</dt>
    <dd>text</dd>
    <dt>Subtype name:</dt>
    <dd>shex</dd>
    <dt>Required parameters:</dt>
    <dd>None</dd>
    <dt>Optional parameters:</dt>
    <dd>None</dd>
    <dt>Encoding considerations:</dt>
    <dd>8-bit text</dd>
    <dd>ShEx Compact Syntax (ShExC) is a text language which is encoded in UTF-8.</dd>
    <dt>Security considerations:</dt>
    <dd>Given that <a href="#dfn-shexc" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexc-6">ShExC</a> allows the substitution of long IRIs with short terms,
      <a href="#dfn-shexc" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-shexc-7">ShExC</a> documents may expand considerably when processed and, in the worst case,
      the resulting data might consume all of the recipient's resources. Applications
      should treat any data with due skepticism.</dd>
    <dt>Interoperability considerations:</dt>
    <dd>Not Applicable</dd>
    <dt>Published specification:</dt>
    <dd><a href="http://shex.io/shex-semantics/">http://shex.io/shex-semantics/</a></dd>
    <dt>Applications that use this media type:</dt>
    <dd>Any programming environment that requires the exchange of
      directed graphs. Implementations of ShEx have been created for
      JavaScript, Python, Ruby, and Java.
    </dd>
    <dt>Fragment Identifier Considerations:</dt>
    <dd>
      The structure of a ShEx schema is defined by its representation in JSON per <a href="#shexj">ShEx JSON Syntax (ShExJ)</a>.
      The JSON-LD context &lt;<a href="http://www.w3.org/ns/shex.jsonld">http://www.w3.org/ns/shex.jsonld</a>&gt; defines the RDF representation (ShExR) for every ShEx schema.
      A ShEx fragment identifies an instance of either the <a href="#dfn-shapeexpr" id="ref-for-dfn-shapeexpr-35">shapeExpr</a> or <a href="#dfn-tripleexpr" id="ref-for-dfn-tripleexpr-15">tripleExpr</a> ShExJ productions, as well as the RDF resource (see <a data-cite="RDF11-CONCEPTS#section-fragID" href="https://www.w3.org/TR/rdf11-concepts/#section-fragID">RDF 1.1 Concepts and Abstract Syntax</a> §6 [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">RDF11-CONCEPTS<!---0.294583%--></a></cite><!---0.294583%-->]) in the corresponding ShExR.</dd>
    <dt>Restrictions on Usage:</dt>
    <dd>None</dd>
    <dt>Provisional Registrations:</dt>
    <dd>Not Applicable</dd>
    <dt>Additional information:</dt>
    <dd><dl>
      <dt>Deprecated alias names for this type:</dt>
      <dd>None</dd>
      <dt>Magic number(s):</dt>
      <dd></dd>
      <dt>File extension(s):</dt>
      <dd>.shex</dd>
      <dt>Macintosh file type code(s):</dt>
      <dd>TEXT</dd>
    </dl></dd>
    <dt>Intended usage:</dt>
    <dd>Common</dd>
    <dt>Other Information &amp; Comments:</dt>
    <dd>None</dd>
    <dt>Contact Person:</dt>
    <dd><dl>
      <dt>Contact Name:</dt>
      <dd>Eric Prud'hommeaux</dd>
      <dt>Contact Email Address:</dt>
      <dd>eric@w3.org</dd>
      <dt>Change controller:</dt>
      <dd>W3C</dd>
    </dl></dd>
  </dl>
</section></section>

    </body></html>